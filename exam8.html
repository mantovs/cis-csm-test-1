<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="light">
<head>
<meta charset="UTF-8" />
<title>CIS-CSM Exam 8</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
  body { background:#fff; }
  .option-card { cursor:pointer; transition:.15s; }
  .option-card:not(.disabled):hover { border-color:#6f42c1; box-shadow:0 0 0 .15rem rgba(111,66,193,.15); }
  .option-card.selected { border-width:2px; border-color:#6f42c1; background:#f9f5ff; }
  .option-card.correct-user, .option-card.correct { border-color:#198754!important; background:#d1e7dd; }
  .option-card.incorrect-user { border-color:#dc3545!important; background:#f8d7da; }
  .badge-label { font-size:.65rem; letter-spacing:.5px; text-transform:uppercase; font-weight:600; }
  .feedback-area { animation:fadeIn .35s; }
  @keyframes fadeIn { from {opacity:0;transform:translateY(4px)} to {opacity:1;transform:translateY(0)} }
  .donut-wrapper { position:relative; width:160px; height:160px; margin:auto; }
  .donut-wrapper canvas { width:100%; height:100%; }
  .donut-center { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:1.3rem; }
  .question-header-mini { font-size:.8rem; color:#6c757d; text-transform:uppercase; letter-spacing:.5px; }
  .toggle-theme { position:fixed; bottom:1rem; right:1rem; z-index:1000; }
  .question-status-alert { font-size:.8rem; }

  /* Matching */
  .matching-row {
    display:flex;
    gap:1rem;
    align-items:flex-start;
    padding:.75rem .9rem;
    border:1px solid #dee2e6;
    border-radius:.5rem;
    margin-bottom:.6rem;
    background:#fff;
  }
  .matching-row select { min-width:150px; }
  .matching-row.correct { border-color:#198754; background:#d1e7dd; }
  .matching-row.incorrect { border-color:#dc3545; background:#f8d7da; }
  .matching-left-text { flex:1; }
  .matching-badge {
    font-size:.6rem;
    letter-spacing:.5px;
    font-weight:600;
    text-transform:uppercase;
  }
  @media (max-width: 576px){
    .matching-row { flex-direction:column; }
    .matching-row select { width:100%; }
  }

  #themeBtn{
    display: none;
  }
</style>
</head>
<body>
<div class="container py-4" id="appRoot"></div>
<button class="btn btn-outline-secondary btn-sm toggle-theme" id="themeBtn" title="Alternar Tema">ðŸŒ“</button>

<script>
/* ==============================
 * CONFIG
 * ============================== */
const HIDE_OPTION_IDS = true; // Se quiser voltar a mostrar IDs (A., B., 1-, etc.) mude para false.

/* ==============================
 * QUESTÃ•ES (JSON BASE) - exemplo incluindo matching
 * ============================== */
const QUESTIONS_BANK_RAW = [
    {
        "id": 51,
        "type": "multiple",
        "question": "What features are included with the Customer Service Portal? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Header with links for different customer activities such as creating a case",
                "correct": true
            },
            {
                "id": "B",
                "text": "Search feature to get information from several repositories",
                "correct": true
            },
            {
                "id": "C",
                "text": "Links to information sources such as the knowledge base, community and customer support",
                "correct": true
            },
            {
                "id": "D",
                "text": "Links to marketing promotions and product coupons",
                "correct": false
            },
            {
                "id": "E",
                "text": "The ability to create new accounts",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 52,
        "type": "multiple",
        "question": "The case digests feature includes which types of case communication? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Case Lifecycle Reports",
                "correct": false
            },
            {
                "id": "B",
                "text": "Case Action Summaries",
                "correct": true
            },
            {
                "id": "C",
                "text": "Post Case Reviews",
                "correct": true
            },
            {
                "id": "D",
                "text": "Case Post Mortem",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 53,
        "type": "multiple",
        "question": "By default what can customers with the customer (sn_customerservice.customer) role see on the customer service portal? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Assets",
                "correct": true
            },
            {
                "id": "B",
                "text": "Publications",
                "correct": true
            },
            {
                "id": "C",
                "text": "Products",
                "correct": true
            },
            {
                "id": "D",
                "text": "Contacts",
                "correct": false
            },
            {
                "id": "E",
                "text": "Contracts",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 54,
        "type": "multiple",
        "question": "Which capabilities does the integration with Microsoft Outlook add-in offer? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Escalate a case on the add-m panel of Outlook",
                "correct": false
            },
            {
                "id": "B",
                "text": "Register the sender of an email as contact",
                "correct": true
            },
            {
                "id": "C",
                "text": "As the Microsoft Outlook user, register yourself as self-contributor",
                "correct": false
            },
            {
                "id": "D",
                "text": "Create cases using email content in Outlook for the customer contact",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 55,
        "type": "multiple",
        "question": "Which service catalogs are available out-of-the-box in the customer portals? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Partner Service",
                "correct": false
            },
            {
                "id": "B",
                "text": "Customer Service",
                "correct": true
            },
            {
                "id": "C",
                "text": "Consumer Service",
                "correct": true
            },
            {
                "id": "D",
                "text": "Product Service",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 56,
        "type": "multiple",
        "question": "From a security perspective, scoping brings several benefits: (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Improves instance security by limiting accessibility to other applications on the instance",
                "correct": true
            },
            {
                "id": "B",
                "text": "Provides CSM teams the autonomy and control needed to configure and manage the CSM application, but not the CSM Service Portals",
                "correct": false
            },
            {
                "id": "C",
                "text": "IT can manage and control the pace of the CSM teams because dependencies have been put in place",
                "correct": false
            },
            {
                "id": "D",
                "text": "The scope holds the records and acts as a container for the desired Customer Service Management Applications",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 57,
        "type": "multiple",
        "question": "Assignment workbench enables customer service managers to assign tasks to agents via configurable criteria known as Matching Rules. Which out-of-the-box configurable criteria can be used? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Assigned Cases",
                "correct": true
            },
            {
                "id": "B",
                "text": "Agent Affinity",
                "correct": false
            },
            {
                "id": "C",
                "text": "Availability Today",
                "correct": true
            },
            {
                "id": "D",
                "text": "Matching Skills",
                "correct": true
            },
            {
                "id": "E",
                "text": "Agent History",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 58,
        "type": "multiple",
        "question": "Which of the following roles can update a consumer's record? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Consumer Support Agent {sn_customerservice.consumer_agent)",
                "correct": true
            },
            {
                "id": "B",
                "text": "Customer Service Manager (sn_customerservice_manager)",
                "correct": true
            },
            {
                "id": "C",
                "text": "Customer Service Agent (sn_customerservice_agent)",
                "correct": false
            },
            {
                "id": "D",
                "text": "Customer (sn_customerservice.customer)",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 59,
        "type": "multiple",
        "question": "In the 'Action Status' column on a case list what could a red indicator dot mean? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Blocked by approval",
                "correct": false
            },
            {
                "id": "B",
                "text": "Blocked by case task",
                "correct": false
            },
            {
                "id": "C",
                "text": "Blocked internally and by customer",
                "correct": true
            },
            {
                "id": "D",
                "text": "Blocked by internally",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 60,
        "type": "multiple",
        "question": "Which of the following are correct for parent/child synchronization? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Multiple child cases can be managed from a parent case as in Major Issue Management",
                "correct": true
            },
            {
                "id": "B",
                "text": "The Administrator can choose which fields to synchronize from parent to child cases",
                "correct": true
            },
            {
                "id": "C",
                "text": "Parent to child cases can be synchronized regardless of which state the case is in",
                "correct": false
            },
            {
                "id": "D",
                "text": "The property to synchronize parent to child cases is automatically enabled",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 61,
        "type": "multiple",
        "question": "What are the types of units used to measure entitlements? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Hours",
                "correct": true
            },
            {
                "id": "B",
                "text": "Contract",
                "correct": false
            },
            {
                "id": "C",
                "text": "Cost",
                "correct": false
            },
            {
                "id": "D",
                "text": "Case",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 62,
        "type": "multiple",
        "question": "How are ServiceNow's out-of-the-box Customer Service Management applications packaged? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Store Apps",
                "correct": true
            },
            {
                "id": "B",
                "text": "Update Sets",
                "correct": false
            },
            {
                "id": "C",
                "text": "Through private scopes",
                "correct": false
            },
            {
                "id": "D",
                "text": "Plugins",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 63,
        "type": "multiple",
        "question": "What are the three main components that make up Proactive Customer Service Operations? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Service Monitoring",
                "correct": true
            },
            {
                "id": "B",
                "text": "Service Reporting",
                "correct": false
            },
            {
                "id": "C",
                "text": "Service-Aware CMDB",
                "correct": false
            },
            {
                "id": "D",
                "text": "Service-Aware Install Base",
                "correct": true
            },
            {
                "id": "E",
                "text": "Proactive Case",
                "correct": true
            },
            {
                "id": "F",
                "text": "Proactive Prevention",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 64,
        "type": "multiple",
        "question": "What are the three out-of-the-box playbooks for CSM? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Case playbook for Onboarding",
                "correct": true
            },
            {
                "id": "B",
                "text": "Case playbook for Billing",
                "correct": false
            },
            {
                "id": "C",
                "text": "Case playbook for Accounts",
                "correct": false
            },
            {
                "id": "D",
                "text": "Case playbook for Product Support",
                "correct": true
            },
            {
                "id": "E",
                "text": "Case playbook for Complaints",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 65,
        "type": "multiple",
        "question": "Which of the following allows you to install out-of-the-box Customer Service Management applications within your ServiceNow instance? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "XML unloads",
                "correct": false
            },
            {
                "id": "B",
                "text": "Plugins",
                "correct": true
            },
            {
                "id": "C",
                "text": "Store Apps",
                "correct": true
            },
            {
                "id": "D",
                "text": "Update Sets",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 66,
        "type": "multiple",
        "question": "What are available matching criteria for case assignment in Customer Service Management? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Partner Hours",
                "correct": false
            },
            {
                "id": "B",
                "text": "Matching Skills",
                "correct": true
            },
            {
                "id": "C",
                "text": "Distance",
                "correct": false
            },
            {
                "id": "D",
                "text": "Certifications",
                "correct": false
            },
            {
                "id": "E",
                "text": "Assigned Cases",
                "correct": true
            },
            {
                "id": "F",
                "text": "Availability Today",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 67,
        "type": "multiple",
        "question": "Depending on the CSM application configurations, cases can be assigned to agents manually or by using auto-assignment. Which routing and assignment features leverage matching rules? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "State Flows",
                "correct": false
            },
            {
                "id": "B",
                "text": "Assignment Workbench",
                "correct": true
            },
            {
                "id": "C",
                "text": "Assignment Rules",
                "correct": true
            },
            {
                "id": "D",
                "text": "CSM Workspace",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 68,
        "type": "multiple",
        "question": "Which of the following features are specific to CSM Workspaces and will not be found in the Platform UI view? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Special handing notes",
                "correct": false
            },
            {
                "id": "B",
                "text": "Lookup and verify",
                "correct": true
            },
            {
                "id": "C",
                "text": "Related search",
                "correct": false
            },
            {
                "id": "D",
                "text": "Agent assist",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 69,
        "type": "multiple",
        "question": "Customer service agents can use Agent Assist to search for information from an interaction. BY DEFAULT, what are the available search sources? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Knowledge articles",
                "correct": true
            },
            {
                "id": "B",
                "text": "Service catalog",
                "correct": true
            },
            {
                "id": "C",
                "text": "Communities",
                "correct": true
            },
            {
                "id": "D",
                "text": "Consumer service portal",
                "correct": false
            },
            {
                "id": "E",
                "text": "Customer service portal",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 70,
        "type": "multiple",
        "question": "Service-aware Install Base consists of which entities? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Installed Products",
                "correct": true
            },
            {
                "id": "B",
                "text": "Install Base Items",
                "correct": true
            },
            {
                "id": "C",
                "text": "Assets",
                "correct": false
            },
            {
                "id": "D",
                "text": "Sold Products",
                "correct": true
            },
            {
                "id": "E",
                "text": "Configuration Items",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 71,
        "type": "multiple",
        "question": "Which roles can propose a case as a Major Case candidate? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Proxy contact (sn_customerservice.proxy_contact)",
                "correct": false
            },
            {
                "id": "B",
                "text": "Customer case manager (sn_customerservice.customer_case_manager)",
                "correct": false
            },
            {
                "id": "C",
                "text": "Customer service manager (sn_customerservice_manager)",
                "correct": true
            },
            {
                "id": "D",
                "text": "Customer service agent (sn_customerservice_agent)",
                "correct": true
            },
            {
                "id": "E",
                "text": "Major issue manager (sn_majorissue_mgt.major_issue_manager)",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 72,
        "type": "multiple",
        "question": "What benefits does scoping an application bring? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "CSM teams can move at their desired pace, independent of IT",
                "correct": true
            },
            {
                "id": "B",
                "text": "Provides CSM teams autonomy and control",
                "correct": true
            },
            {
                "id": "C",
                "text": "CSM application data and business logic is protected from changes by other applications",
                "correct": true
            },
            {
                "id": "D",
                "text": "Account records can be changed only while in the CSM scope",
                "correct": false
            },
            {
                "id": "E",
                "text": "Changes in different scopes can be addressed in a single update set",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 73,
        "type": "multiple",
        "question": "A customer service agent wants to escalate an account but is unable to use the Escalate Account related link on the Account form. What could be the reasons why the customer service agent is not able to use it? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "No escalation approval flow is configured",
                "correct": false
            },
            {
                "id": "B",
                "text": "The parent account of the account to be escalated is not active",
                "correct": false
            },
            {
                "id": "C",
                "text": "The customer service agent is not assigned with the escalation requester role",
                "correct": true
            },
            {
                "id": "D",
                "text": "The account already has an open escalation record",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 74,
        "type": "multiple",
        "question": "When working with communication channels, what inbound email flows are available by default? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Create case for product",
                "correct": false
            },
            {
                "id": "B",
                "text": "Create case for asset",
                "correct": false
            },
            {
                "id": "C",
                "text": "Update case from forward email",
                "correct": false
            },
            {
                "id": "D",
                "text": "Create case from email",
                "correct": true
            },
            {
                "id": "E",
                "text": "Update case using reply",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 75,
        "type": "multiple",
        "question": "A customer service manager would like to limit the reading and creation of knowledge articles within a specific Knowledge Base to the Customer Support group only. Which features should be used to accomplish this? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Can Read user criteria",
                "correct": true
            },
            {
                "id": "B",
                "text": "Whitelist all other groups from the Knowledge Base",
                "correct": false
            },
            {
                "id": "C",
                "text": "Hide the Knowledge Base from the Knowledge Base Portal",
                "correct": false
            },
            {
                "id": "D",
                "text": "Cannot Contribute user criteria",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 76,
        "type": "multiple",
        "question": "Which predefined conversations are available for Customer Service Virtual Agent? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Create Contact",
                "correct": false
            },
            {
                "id": "B",
                "text": "Check Case Status",
                "correct": true
            },
            {
                "id": "C",
                "text": "Close Case",
                "correct": false
            },
            {
                "id": "D",
                "text": "Get Help with an Order",
                "correct": true
            },
            {
                "id": "E",
                "text": "Get Help with an Asset",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 77,
        "type": "multiple",
        "question": "Which of the following statements is correct with regards to partners vs. third-parties in ServiceNow's CSM application? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "A partner will own the relationship with their customer",
                "correct": false
            },
            {
                "id": "B",
                "text": "A partner and a third party are the same in ServiceNow's CSM application",
                "correct": false
            },
            {
                "id": "C",
                "text": "A partner does not own the relationship with a customer. This relationship is owned by the organization they are partnering",
                "correct": true
            },
            {
                "id": "D",
                "text": "A partner is an organization that has been contracted to sell products and services they have actually purchased from another organization",
                "correct": false
            },
            {
                "id": "E",
                "text": "A partner does not own any of the products or services provided by their partnering organization, instead they help to sell, deliver and support them on their behalf",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 78,
        "type": "multiple",
        "question": "Advanced Work Assignment (AWA) automatically routes and assigns work items to agents based on which of the following rules? (Choose four.)",
        "options": [
            {
                "id": "A",
                "text": "Experience",
                "correct": false
            },
            {
                "id": "B",
                "text": "Skills",
                "correct": true
            },
            {
                "id": "C",
                "text": "Availability",
                "correct": true
            },
            {
                "id": "D",
                "text": "Shifts",
                "correct": true
            },
            {
                "id": "E",
                "text": "Capacity",
                "correct": true
            },
            {
                "id": "F",
                "text": "Products",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 79,
        "type": "multiple",
        "question": "From which places in ServiceNow can a customer service agent [sn_customerservice_agent] create a case? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Account",
                "correct": true
            },
            {
                "id": "B",
                "text": "Incident",
                "correct": false
            },
            {
                "id": "C",
                "text": "Customer Service Application",
                "correct": true
            },
            {
                "id": "D",
                "text": "Special Handling Note",
                "correct": false
            },
            {
                "id": "E",
                "text": "Chat",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 80,
        "type": "multiple",
        "question": "What are benefits of the Conversation History feature? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Shorter calls for agents by reducing the time to search for information",
                "correct": true
            },
            {
                "id": "B",
                "text": "A customized admin chat toolbar with emojis for agents to use in chat messages",
                "correct": false
            },
            {
                "id": "C",
                "text": "Improved customer satisfaction as agents can respond to and resolve customer issues faster",
                "correct": true
            },
            {
                "id": "D",
                "text": "Better language management by flagging key words and alerting chat managers when agents use one or more of those words",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 81,
        "type": "multiple",
        "question": "On the Customer Service Portal which personas can see work orders from their company hierarchy? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Partner admin",
                "correct": true
            },
            {
                "id": "B",
                "text": "Partner contact",
                "correct": false
            },
            {
                "id": "C",
                "text": "Customer admin",
                "correct": true
            },
            {
                "id": "D",
                "text": "Customer contact",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 82,
        "type": "multiple",
        "question": "Which roles can specify both skills and mandatory skills for cases and tasks? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Customer service manager (sn_customerservice_manager)",
                "correct": true
            },
            {
                "id": "B",
                "text": "Customer service agent (sn_customerservice_agent)",
                "correct": true
            },
            {
                "id": "C",
                "text": "Customer administrator (sn_customerservice.customer_admin)",
                "correct": false
            },
            {
                "id": "D",
                "text": "Partner (sn_customerservice.partner)",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 83,
        "type": "multiple",
        "question": "A contact can submit a self-registration request from the customer portal with a registration code. Which of the following roles can approve the request? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Customer service manager (sn_customerservice_manager)",
                "correct": false
            },
            {
                "id": "B",
                "text": "System administrator (admin)",
                "correct": true
            },
            {
                "id": "C",
                "text": "Customer administrator (sn_customerservice.customer_admin)",
                "correct": true
            },
            {
                "id": "D",
                "text": "Partner administrator [sn_customerservice.partner_admon]",
                "correct": true
            },
            {
                "id": "E",
                "text": "Service organization administrator (sn_customerservice.service_organization_admin)",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 84,
        "type": "multiple",
        "question": "What benefits can be gained by integrating CSM with Field Service Management? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Reduces agent workload",
                "correct": false
            },
            {
                "id": "B",
                "text": "Reduces monthly case volume",
                "correct": false
            },
            {
                "id": "C",
                "text": "Work orders can be created from a case",
                "correct": true
            },
            {
                "id": "D",
                "text": "Customer can access work order details and tasks created for their case",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 85,
        "type": "multiple",
        "question": "Customer service personnel who are allocated the customer service agent (sn_customerservice_agent) role are responsible for which of the following tasks? (Choose four.)",
        "options": [
            {
                "id": "A",
                "text": "Assist customers with questions, issues and problems",
                "correct": true
            },
            {
                "id": "B",
                "text": "Create cases",
                "correct": true
            },
            {
                "id": "C",
                "text": "Propose major cases",
                "correct": true
            },
            {
                "id": "D",
                "text": "View, edit, and work on cases",
                "correct": true
            },
            {
                "id": "E",
                "text": "Approve customer contacts",
                "correct": false
            },
            {
                "id": "F",
                "text": "Manage customer entitlements",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 86,
        "type": "multiple",
        "question": "Which services does a Customer (sn_customerservice.customer) have access to? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Can research questions issues, or problems, and create view and edit cases for only their own accounts",
                "correct": true
            },
            {
                "id": "B",
                "text": "Can assign the roles to other contacts in the same account",
                "correct": false
            },
            {
                "id": "C",
                "text": "Can view assets belonging to their account",
                "correct": true
            },
            {
                "id": "D",
                "text": "Can edit information or roles for existing contacts",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 87,
        "type": "multiple",
        "question": "To which recipient types can targeted communications (publications) be sent? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Outsourced Service Providers",
                "correct": false
            },
            {
                "id": "B",
                "text": "Contacts",
                "correct": true
            },
            {
                "id": "C",
                "text": "Internal users",
                "correct": true
            },
            {
                "id": "D",
                "text": "Households",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 88,
        "type": "multiple",
        "question": "What does viewing a customer's install base enable customer service agents to do? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "See the detailed configurations of the products and services deployed for a customer to determine the action needed",
                "correct": true
            },
            {
                "id": "B",
                "text": "Monitor alerts for operational services and configuration items that affect service health",
                "correct": false
            },
            {
                "id": "C",
                "text": "Trace information provided in a case to the right product or service to which it relates",
                "correct": true
            },
            {
                "id": "D",
                "text": "Close an upsell of related products and services not yet purchased by a customer",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 89,
        "type": "multiple",
        "question": "Which roles are responsible for maintaining account team membership? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Customer Admin [sn_customerservice.customer.admin]",
                "correct": false
            },
            {
                "id": "B",
                "text": "Customer Case Manager [sn_customerservice.customer_case_manager]",
                "correct": false
            },
            {
                "id": "C",
                "text": "System Administrator [admin]",
                "correct": true
            },
            {
                "id": "D",
                "text": "Customer Service Manager [sn_customerservice_manager]",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 90,
        "type": "multiple",
        "question": "What can a person assigned with the customer role access on the customer service portal by default? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Cases",
                "correct": true
            },
            {
                "id": "B",
                "text": "Related parties",
                "correct": false
            },
            {
                "id": "C",
                "text": "Assets",
                "correct": true
            },
            {
                "id": "D",
                "text": "Social profiles",
                "correct": false
            },
            {
                "id": "E",
                "text": "Sold products",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 91,
        "type": "multiple",
        "question": "Which of the following are benefits of customer access management? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "It increases security by automatically granting access to cases based on access to sold product.",
                "correct": true
            },
            {
                "id": "B",
                "text": "It defaults the responsibility for access management to the customer.",
                "correct": false
            },
            {
                "id": "C",
                "text": "It defaults the responsibility for access management to the customer service agent.",
                "correct": false
            },
            {
                "id": "D",
                "text": "It improves the customer experience by enabling related parties to track and collaborate on cases.",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 92,
        "type": "multiple",
        "question": "Which ServiceNow products can be integrated out-of-the-box with CSM? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "ITOM Event Management",
                "correct": true
            },
            {
                "id": "B",
                "text": "Risk Management",
                "correct": false
            },
            {
                "id": "C",
                "text": "Strategic Portfolio Management",
                "correct": true
            },
            {
                "id": "D",
                "text": "DevOps",
                "correct": false
            },
            {
                "id": "E",
                "text": "Financial Management",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 93,
        "type": "multiple",
        "question": "What are the different resource matching methods on the Matching Rule form? (Choose four.)",
        "options": [
            {
                "id": "A",
                "text": "Simple",
                "correct": true
            },
            {
                "id": "B",
                "text": "Advanced",
                "correct": true
            },
            {
                "id": "C",
                "text": "Selection Criteria",
                "correct": true
            },
            {
                "id": "D",
                "text": "Skill",
                "correct": false
            },
            {
                "id": "E",
                "text": "Affinity",
                "correct": false
            },
            {
                "id": "F",
                "text": "Scripted",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 94,
        "type": "multiple",
        "question": "What are the ways the Customer Portal Locale feature can be used? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Restrict access to a customer service portal based on where a user is physically located",
                "correct": false
            },
            {
                "id": "B",
                "text": "Ensure only authenticated users can choose a language/locale on a customer service portal",
                "correct": false
            },
            {
                "id": "C",
                "text": "Allow authenticated and guest users to choose a language/locale on a customer service portal",
                "correct": true
            },
            {
                "id": "D",
                "text": "Forward authenticated and guest users to a translated customer service portal",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 95,
        "type": "multiple",
        "question": "Advanced Work Assignment (AWA) automatically routes and assigns work items to agents based on which of the following rules? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Experience",
                "correct": false
            },
            {
                "id": "B",
                "text": "Skills",
                "correct": true
            },
            {
                "id": "C",
                "text": "Products",
                "correct": false
            },
            {
                "id": "D",
                "text": "Schedule",
                "correct": true
            },
            {
                "id": "E",
                "text": "Workload",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 96,
        "type": "multiple",
        "question": "Which decisions does Predictive Intelligence support? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Case Escalation",
                "correct": false
            },
            {
                "id": "B",
                "text": "Case Prioritization",
                "correct": true
            },
            {
                "id": "C",
                "text": "Case Categorization",
                "correct": true
            },
            {
                "id": "D",
                "text": "Case Resolution",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 97,
        "type": "multiple",
        "question": "What benefits can be gained by integrating CSM with Field Service Management? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Reduces agent workload",
                "correct": false
            },
            {
                "id": "B",
                "text": "Reduces monthly case volume",
                "correct": false
            },
            {
                "id": "C",
                "text": "Work orders can be created from a case",
                "correct": true
            },
            {
                "id": "D",
                "text": "Customer can access work order details and tasks created for their case",
                "correct": true
            }
        ],
        "explanation": ""
    }
];

function normalizeType(t){ return t === 'multiple' ? 'multi' : t; }
const QUESTIONS_BANK = QUESTIONS_BANK_RAW.map(q => ({ ...q, type: normalizeType(q.type) }));

/* ==============================
 * ESTADO / PERSISTÃŠNCIA
 * ============================== */
const QUIZ_SESSION_KEY = 'quizActiveSession_v3';
let quizState = {
  startTime: null,
  endTime: null,
  currentIndex: 0,
  sequence: [],
  answers: {}, // single/multi: { selected:Set }, matching: { pairs:{} }
  locked: {},
  reviewMode: false
};
const appRoot = document.getElementById("appRoot");

/* PersistÃªncia */
function saveSession() {
  if (quizState.endTime) return;
  try {
    const serializable = {
      startTime: quizState.startTime,
      currentIndex: quizState.currentIndex,
      sequence: quizState.sequence,
      answers: Object.fromEntries(
        Object.entries(quizState.answers).map(([qid, val]) => {
          if (val.selected instanceof Set) return [qid, { selected: Array.from(val.selected) }];
          return [qid, { pairs: val.pairs || {} }];
        })
      ),
      locked: quizState.locked
    };
    localStorage.setItem(QUIZ_SESSION_KEY, JSON.stringify(serializable));
  } catch(e){ console.warn("Falha salvar sessÃ£o", e); }
}
function restoreSessionIfAny() {
  try {
    const raw = localStorage.getItem(QUIZ_SESSION_KEY);
    if(!raw) return false;
    const data = JSON.parse(raw);
    if(!Array.isArray(data.sequence)) return false;
    quizState.startTime = data.startTime || Date.now();
    quizState.currentIndex = data.currentIndex || 0;
    quizState.sequence = data.sequence;
    quizState.answers = {};
    if (data.answers) {
      Object.entries(data.answers).forEach(([qid,val])=>{
        if(val.selected) quizState.answers[qid]={selected:new Set(val.selected)};
        else if(val.pairs) quizState.answers[qid]={pairs:{...val.pairs}};
      });
    }
    quizState.locked = data.locked || {};
    return true;
  } catch(e){ console.warn("Falha restaurar sessÃ£o", e); return false; }
}
function clearSession(){ localStorage.removeItem(QUIZ_SESSION_KEY); }

/* Utilidades */
function shuffle(a){ const arr=a.slice(); for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
function formatDuration(ms){ const s=Math.floor(ms/1000); const m=Math.floor(s/60); const r=s%60; return `${m}m ${r.toString().padStart(2,'0')}s`; }
function getCurrentQuestion(){ return quizState.sequence[quizState.currentIndex]; }

function initQuiz(){
  clearSession();
  quizState.startTime = Date.now();
  quizState.endTime = null;
  quizState.currentIndex = 0;
  quizState.answers = {};
  quizState.locked = {};
  quizState.reviewMode = false;
  quizState.sequence = shuffle(QUESTIONS_BANK.map(q=>{
    if(q.type==='matching'){
      return {
        ...q,
        left: shuffle(q.left.map(l=>({...l}))),
        right: shuffle(q.right.map(r=>({...r})))
      };
    }
    return { ...q, options: shuffle(q.options.map(o=>({...o}))) };
  }));
  renderLayout();
  renderQuestion();
  saveSession();
}

function countStats(){
  let correct=0, incorrect=0, skipped=0;
  quizState.sequence.forEach(q=>{
    const ans=quizState.answers[q.id];
    if(!ans || !quizState.locked[q.id]) { skipped++; return; }
    let isCorrect=false;
    if(q.type==='matching'){
      const pairs = ans.pairs || {};
      isCorrect = q.left.every(l=> pairs[l.id] === q.answerMap[l.id]);
    } else {
      const selected=ans.selected;
      const correctSet=new Set(q.options.filter(o=>o.correct).map(o=>o.id));
      isCorrect = selected.size===correctSet.size && Array.from(selected).every(id=>correctSet.has(id));
    }
    if(isCorrect) correct++; else incorrect++;
  });
  return {correct, incorrect, skipped, total:quizState.sequence.length};
}

/* Layout / Timer */
let timerInterval=null;
function renderLayout(){
  appRoot.innerHTML=`
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Servicenow CIS-CSM Exam 8</h5>
      <div>
  <a href="./home.html" class="btn btn-sm btn-outline-primary me-2">Home</a>
  <button class="btn btn-sm btn-outline-danger me-2" onclick="finishQuiz()">Finalizar Teste</button>
        <span class="small text-muted" id="timerSpan">00:00</span>
      </div>
    </div>
    <div class="progress mb-3">
      <div class="progress-bar" id="progressBar" style="width:0%"></div>
    </div>
    <div id="questionContainer"></div>
  `;
  startTimer();
}
function startTimer(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(quizState.endTime){ clearInterval(timerInterval); return; }
    const diff=Date.now()-quizState.startTime;
    const s=Math.floor(diff/1000);
    const m=Math.floor(s/60);
    const r=s%60;
    const el=document.getElementById('timerSpan');
    if(el) el.textContent=`${m.toString().padStart(2,'0')}:${r.toString().padStart(2,'0')}`;
  },1000);
}

/* Render questÃ£o */
function renderQuestion(){
  const q=getCurrentQuestion();
  const container=document.getElementById("questionContainer");
  if(!q || !container) return;
  const idx=quizState.currentIndex+1;
  const total=quizState.sequence.length;
  const isLocked=!!quizState.locked[q.id];
  const progressBar=document.getElementById("progressBar");
  if(progressBar) progressBar.style.width = `${((idx-1)/total)*100}%`;

  let answeredSet, pairs;
  if(q.type==='matching'){
    pairs = quizState.answers[q.id]?.pairs || {};
  } else {
    answeredSet = quizState.answers[q.id]?.selected || new Set();
  }

  // status geral
  let statusAlertHTML='';
  if(isLocked){
    let isCorrect=false;
    if(q.type==='matching'){
      isCorrect = q.left.every(l=> (pairs||{})[l.id] === q.answerMap[l.id]);
    } else {
      const correctSet=new Set(q.options.filter(o=>o.correct).map(o=>o.id));
      isCorrect = answeredSet.size===correctSet.size && Array.from(answeredSet).every(id=>correctSet.has(id));
    }
    statusAlertHTML = `
      <div class="mb-3">
        <div class="alert ${isCorrect?'alert-success':'alert-danger'} question-status-alert mb-0 py-2 px-3">
          <strong>${isCorrect?'Correta':'Incorreta'}:</strong>
          ${isCorrect?'VocÃª acertou esta questÃ£o.':'Esta questÃ£o foi respondida incorretamente.'}
        </div>
      </div>
    `;
  }

  let bodyHTML='';
  if(q.type==='matching'){
    bodyHTML = `
      <h6 class="mb-3">${q.question}</h6>
      ${statusAlertHTML}
      ${renderMatchingQuestion(q, pairs, isLocked)}
    `;
  } else {
    const correctNeeded = q.type==='multi' ? q.options.filter(o=>o.correct).length : 1;
    bodyHTML = `
      <h6 class="mb-3">${q.question} ${q.type==='multi'?`<span class="text-muted small">(Escolha ${correctNeeded})</span>`:''}</h6>
      ${statusAlertHTML}
      <div id="optionsWrapper">
        ${q.options.map(opt=>{
          const selected=answeredSet.has(opt.id);
            const classes=["p-3","mb-2","border","rounded","option-card","d-flex","align-items-start"];
            if(selected) classes.push("selected");
            if(isLocked){
              if(selected && opt.correct) classes.push("correct-user");
              else if(!selected && opt.correct) classes.push("correct");
              else if(selected && !opt.correct) classes.push("incorrect-user");
            }
            return `
              <div class="${classes.join(' ')}" onclick="toggleSelect('${q.id}','${opt.id}')">
                <div class="me-3 mt-1">
                  ${q.type==='single'
                    ? `<input type="radio" name="q_${q.id}" ${selected?'checked':''} ${isLocked?'disabled':''}/>`
                    : `<input type="checkbox" ${selected?'checked':''} ${isLocked?'disabled':''}/>`}
                </div>
                <div class="flex-grow-1">
                  <div class="fw-semibold">${HIDE_OPTION_IDS ? opt.text : `${opt.id}. ${opt.text}`}</div>
                  ${isLocked ? renderOptionBadge(q,opt,selected):''}
                </div>
              </div>
            `;
        }).join('')}
      </div>
    `;
  }

  container.innerHTML = `
    <div class="mb-2 question-header-mini">QuestÃ£o ${idx} de ${total}</div>
    ${bodyHTML}
    <div id="feedbackZone"></div>
    <div class="mt-3 d-flex justify-content-end gap-2 flex-wrap">
      ${!isLocked
        ? `${idx>1?'<button class="btn btn-outline-secondary" onclick="goPrev()">Voltar</button>':''}
           <button class="btn btn-success" id="submitBtn" disabled onclick="evaluateCurrent()">Confirmar Resposta</button>`
        : `${idx>1?'<button class="btn btn-outline-secondary" onclick="goPrev()">Voltar</button>':''}
           <button class="btn btn-primary" onclick="goNextAfterLocked()">${idx===total?'Resultados':'PrÃ³xima >'}</button>`
      }
    </div>
  `;

  if(isLocked && q.explanation){
    document.getElementById('feedbackZone').innerHTML = `
      <div class="feedback-area mt-3 small text-muted">
        <strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}
      </div>
    `;
  }

  updateSubmitButtonState();
}

/* Matching render */
function renderMatchingQuestion(q, pairs, isLocked){
  return `
    <div class="mb-2 small text-muted">Associe cada definiÃ§Ã£o ao papel correto.</div>
    <div id="matchingWrapper">
      ${q.left.map(l=>{
        const chosen = pairs[l.id] || '';
        let rowClass='matching-row';
        let badgeHTML='';
        if(isLocked){
          const correctId=q.answerMap[l.id];
          const isCorrect = chosen === correctId;
          rowClass += isCorrect ? ' correct' : ' incorrect';
          badgeHTML = `<span class="badge ${isCorrect?'bg-success-subtle text-success border border-success':'bg-danger-subtle text-danger border border-danger'} matching-badge ms-2">
            ${isCorrect?'Correto':'Incorreto'}${!isCorrect ? ' (Correto: '+ rightTextById(q, correctId) +')':''}
          </span>`;
        }
        return `
          <div class="${rowClass}" data-left="${l.id}">
            <div class="matching-left-text">${l.text}</div>
            <div>
              <select class="form-select form-select-sm" ${isLocked?'disabled':''}
                onchange="setMatchPair('${q.id}','${l.id}', this.value)">
                <option value="">-- Selecione --</option>
                ${q.right.map(r=>{
                  const selected = r.id === chosen ? 'selected':'';
                  let disable = '';
                  if(!isLocked && chosen !== r.id && Object.values(pairs).includes(r.id)) disable='disabled';
                  return `<option value="${r.id}" ${selected} ${disable}>${HIDE_OPTION_IDS ? r.text : (r.id + ' - ' + r.text)}</option>`;
                }).join('')}
              </select>
              ${badgeHTML}
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

/* Badges single/multi */
function renderOptionBadge(q,opt,userSelected){
  if(q.type==='multi'){
    if(userSelected && opt.correct) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Sua seleÃ§Ã£o estÃ¡ correta</span>`;
    if(!userSelected && opt.correct) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">SeleÃ§Ã£o correta</span>`;
    if(userSelected && !opt.correct) return `<span class="badge bg-danger-subtle text-danger border border-danger badge-label mt-1">Sua seleÃ§Ã£o estÃ¡ incorreta</span>`;
    return '';
  } else {
    if(opt.correct && userSelected) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Resposta correta</span>`;
    if(opt.correct && !userSelected) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Resposta correta</span>`;
    if(userSelected && !opt.correct) return `<span class="badge bg-danger-subtle text-danger border border-danger badge-label mt-1">Incorreta</span>`;
    return '';
  }
}

/* Estado botÃ£o confirmar */
function updateSubmitButtonState(){
  const q=getCurrentQuestion();
  const btn=document.getElementById("submitBtn");
  if(!btn) return;
  if(q.type==='matching'){
    const ans=quizState.answers[q.id];
    const filled = ans && ans.pairs ? Object.values(ans.pairs).filter(v=>v).length : 0;
    btn.disabled = filled !== q.left.length;
  } else {
    const ans=quizState.answers[q.id];
    btn.disabled = !(ans && ans.selected.size>0);
  }
}

/* InteraÃ§Ã£o single/multi */
function toggleSelect(qid, optId){
  const q=quizState.sequence.find(q=>q.id==qid);
  if(!q || q.type==='matching' || quizState.locked[q.id]) return;
  if(!quizState.answers[q.id]) quizState.answers[q.id]={selected:new Set()};
  const sel=quizState.answers[q.id].selected;
  if(q.type==='single'){ sel.clear(); sel.add(optId); }
  else {
    if(sel.has(optId)) sel.delete(optId); else sel.add(optId);
  }
  renderQuestion(); saveSession();
}

/* InteraÃ§Ã£o matching */
function setMatchPair(qid,leftId,rightId){
  const q=quizState.sequence.find(q=>q.id==qid);
  if(!q || q.type!=='matching' || quizState.locked[q.id]) return;
  if(!quizState.answers[q.id]) quizState.answers[q.id]={pairs:{}};
  const pairs=quizState.answers[q.id].pairs;
  if(rightId==='') delete pairs[leftId];
  else {
    Object.entries(pairs).forEach(([l,r])=>{
      if(r===rightId && l!==leftId) delete pairs[l];
    });
    pairs[leftId]=rightId;
  }
  renderQuestion(); saveSession();
}

/* Avaliar */
function evaluateCurrent(){
  const q=getCurrentQuestion();
  if(q.type==='matching'){
    const ans=quizState.answers[q.id];
    if(!ans || Object.keys(ans.pairs).length < q.left.length) return;
    quizState.locked[q.id]=true;
  } else {
    const ans=quizState.answers[q.id];
    if(!ans || ans.selected.size===0) return;
    quizState.locked[q.id]=true;
  }
  if(q.explanation){
    document.getElementById("feedbackZone").innerHTML=`
      <div class="feedback-area mt-3 small text-muted">
        <strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}
      </div>
    `;
  }
  renderQuestion(); saveSession();
}

function goNextAfterLocked(){
  if(quizState.currentIndex === quizState.sequence.length-1) finishQuiz();
  else { quizState.currentIndex++; renderQuestion(); saveSession(); }
}
function goPrev(){
  if(quizState.currentIndex===0) return;
  quizState.currentIndex--; renderQuestion(); saveSession();
}

/* Resultados */
function finishQuiz(){
  quizState.endTime=Date.now();
  const stats=countStats();
  const duration=formatDuration(quizState.endTime-quizState.startTime);
  clearSession();
  const attemptsKey='quizAttempts';
  let attempts=parseInt(localStorage.getItem(attemptsKey)||'0',10);
  attempts++; localStorage.setItem(attemptsKey,attempts);
  const percent = stats.total? Math.round((stats.correct/stats.total)*100) : 0;

  appRoot.innerHTML=`
    <div class="mb-4">
      <h4 class="mb-0">Resultados do Quiz</h4>
      <div class="text-muted small">Tentativa ${attempts} â€¢ ${new Date().toLocaleString('pt-BR')}</div>
    </div>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-body d-flex flex-column justify-content-center">
            <div class="donut-wrapper mb-3">
              <canvas id="resultDonut" width="160" height="160"></canvas>
              <div class="donut-center">${percent}%</div>
            </div>
            <div class="text-center small">
              <span class="me-2"><span class="badge bg-success">&nbsp;</span> Corretas: ${stats.correct}</span>
              <span class="me-2"><span class="badge bg-danger">&nbsp;</span> Incorretas: ${stats.incorrect}</span>
              <span><span class="badge bg-secondary">&nbsp;</span> Puladas: ${stats.skipped}</span>
            </div>
          </div>
          <div class="card-footer text-center">
            <strong>${stats.correct}/${stats.total}</strong> corretas<br/>Tempo: ${duration}
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card h-100">
          <div class="card-body">
            <p class="mb-3">VocÃª concluiu o quiz. Revise ou refaÃ§a para praticar novamente.</p>
            <ul class="list-group mb-3 small">
              <li class="list-group-item d-flex justify-content-between"><span>Total de questÃµes</span><strong>${stats.total}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Corretas</span><strong class="text-success">${stats.correct}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Incorretas</span><strong class="text-danger">${stats.incorrect}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Puladas</span><strong class="text-secondary">${stats.skipped}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Percentual</span><strong>${percent}%</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>DuraÃ§Ã£o</span><strong>${duration}</strong></li>
            </ul>
            <div class="d-flex flex-wrap gap-2">
              <a href="./home.html" class="btn btn-outline-primary">Home</a>
              <button class="btn btn-primary" onclick="reviewQuestions()">Rever Questes</button>
              <button class="btn btn-success" onclick="initQuiz()">Refazer (Randomizar)</button>
              <button class="btn btn-outline-secondary" onclick="toggleTheme()">Alternar Tema</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
  drawDonut(stats.correct, stats.incorrect, stats.skipped);
}

/* Donut */
function drawDonut(correct, incorrect, skipped){
  const canvas=document.getElementById("resultDonut");
  if(!canvas) return;
  const ctx=canvas.getContext('2d');
  const total=correct+incorrect+skipped||1;
  const data=[
    {value:correct,color:'#198754'},
    {value:incorrect,color:'#dc3545'},
    {value:skipped,color:'#6c757d'}
  ].filter(d=>d.value>0);
  let start=-Math.PI/2;
  data.forEach(d=>{
    const slice=(d.value/total)*Math.PI*2;
    ctx.beginPath();
    ctx.moveTo(80,80);
    ctx.arc(80,80,80,start,start+slice);
    ctx.closePath();
    ctx.fillStyle=d.color;
    ctx.fill();
    start+=slice;
  });
  ctx.globalCompositeOperation='destination-out';
  ctx.beginPath(); ctx.arc(80,80,48,0,Math.PI*2); ctx.fill();
  ctx.globalCompositeOperation='source-over';
}

/* RevisÃ£o */
function reviewQuestions(){
  const stats=countStats();
  const blocks=quizState.sequence.map((q,i)=>{
    const ans=quizState.answers[q.id];
    let userCorrect=false;

    if(q.type==='matching'){
      const pairs = ans ? ans.pairs || {} : {};
      userCorrect = ans && q.left.every(l=> pairs[l.id] === q.answerMap[l.id]);
      return `
        <div class="card mb-3">
          <div class="card-header d-flex justify-content-between">
            <span><strong>QuestÃ£o ${i+1}:</strong> (Matching)</span>
            <span class="badge ${userCorrect?'bg-success':'bg-danger'}">${userCorrect?'Correta':'Incorreta'}</span>
          </div>
          <div class="card-body">
            <p class="mb-3">${q.question}</p>
            ${q.left.map(l=>{
              const chosen = (ans && ans.pairs)? ans.pairs[l.id] : '';
              const correctId = q.answerMap[l.id];
              const isRowCorrect = chosen === correctId;
              return `
                <div class="matching-row ${isRowCorrect?'correct':'incorrect'}">
                  <div class="matching-left-text">${l.text}</div>
                  <div class="small">
                    <div><strong>Selecionado:</strong> ${chosen ? rightTextById(q, chosen) : '(vazio)'}</div>
                    <div><strong>Correto:</strong> ${rightTextById(q, correctId)}</div>
                  </div>
                </div>
              `;
            }).join('')}
            ${q.explanation?`<div class="small text-muted"><strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}</div>`:''}
          </div>
        </div>
      `;
    } else {
      const selected=ans ? ans.selected : new Set();
      const correctSet=new Set(q.options.filter(o=>o.correct).map(o=>o.id));
      userCorrect = ans && selected.size===correctSet.size && Array.from(selected).every(id=>correctSet.has(id));
      return `
        <div class="card mb-3">
          <div class="card-header d-flex justify-content-between">
            <span><strong>QuestÃ£o ${i+1}:</strong> ${q.type==='multi'?'(Multi)':'(Ãšnica)'}</span>
            <span class="badge ${userCorrect?'bg-success':'bg-danger'}">${userCorrect?'Correta':'Incorreta'}</span>
          </div>
          <div class="card-body">
            <p class="mb-3">${q.question}</p>
            ${q.options.map(o=>{
              let classes="p-2 px-3 mb-2 border rounded small";
              let badge='';
              const userSel=selected.has(o.id);
              if(o.correct && userSel){ classes+=" border-success bg-success-subtle"; badge='<span class="badge bg-success-subtle text-success border border-success badge-label">Sua seleÃ§Ã£o correta</span>'; }
              else if(o.correct && !userSel){ classes+=" border-success bg-success-subtle"; badge='<span class="badge bg-success-subtle text-success border border-success badge-label">Resposta correta</span>'; }
              else if(!o.correct && userSel){ classes+=" border-danger bg-danger-subtle"; badge='<span class="badge bg-danger-subtle text-danger border border-danger badge-label">Selecionada (Incorreta)</span>'; }
              else { classes+=" border-light"; }
              return `<div class="${classes}">${HIDE_OPTION_IDS?o.text:`<strong>${o.id}.</strong> ${o.text}`}<br/>${badge}</div>`;
            }).join('')}
            ${q.explanation?`<div class="small text-muted"><strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}</div>`:''}
          </div>
        </div>
      `;
    }
  }).join('');

  appRoot.innerHTML=`
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0">RevisÃ£o das QuestÃµes</h4>
      <div class="d-flex gap-2">
        <button class="btn btn-success btn-sm" onclick="initQuiz()">Refazer</button>
        <button class="btn btn-outline-secondary btn-sm" onclick="finishQuiz()">Voltar aos Resultados</button>
      </div>
    </div>
    <div class="mb-3 small">
      <span class="me-3"><span class="badge bg-success">&nbsp;</span> Corretas: ${stats.correct}</span>
      <span class="me-3"><span class="badge bg-danger">&nbsp;</span> Incorretas: ${stats.incorrect}</span>
      <span><span class="badge bg-secondary">&nbsp;</span> Puladas: ${stats.skipped}</span>
    </div>
    ${blocks}
  `;
}

/* Helpers right text */
function rightTextById(q, id){ const it=(q.right||[]).find(r=>r.id===id); return it?it.text:''; }

/* Tema */
const themeBtn=document.getElementById("themeBtn");
function toggleTheme(){
  const html=document.documentElement;
  const cur=html.getAttribute('data-bs-theme')||'light';
  const next=cur==='light'?'dark':'light';
  html.setAttribute('data-bs-theme',next);
  localStorage.setItem('quizTheme',next);
}
themeBtn.addEventListener('click',toggleTheme);
(function(){ const saved=localStorage.getItem('quizTheme'); if(saved) document.documentElement.setAttribute('data-bs-theme',saved); })();

/* NavegaÃ§Ã£o & exposiÃ§Ã£o */
function goNextAfterLocked(){ if(quizState.currentIndex===quizState.sequence.length-1) finishQuiz(); else {quizState.currentIndex++; renderQuestion(); saveSession();} }
function goPrev(){ if(quizState.currentIndex===0) return; quizState.currentIndex--; renderQuestion(); saveSession(); }

window.toggleSelect=toggleSelect;
window.evaluateCurrent=evaluateCurrent;
window.finishQuiz=finishQuiz;
window.reviewQuestions=reviewQuestions;
window.goNextAfterLocked=goNextAfterLocked;
window.goPrev=goPrev;
window.toggleTheme=toggleTheme;
window.initQuiz=initQuiz;
window.setMatchPair=setMatchPair;

/* Start */
(function start(){
  if(restoreSessionIfAny()){ renderLayout(); renderQuestion(); startTimer(); }
  else initQuiz();
})();
</script>
</body>
</html>