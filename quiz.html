<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="light">
<head>
<meta charset="UTF-8" />
<title>Quiz - Perguntas e Respostas</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<style>
  body { background:#fff; }
  .option-card {
    cursor:pointer;
    transition:.15s;
  }
  .option-card:not(.disabled):hover {
    border-color:#6f42c1;
    box-shadow:0 0 0 .15rem rgba(111,66,193,.15);
  }
  .option-card.selected {
    border-width:2px;
    border-color:#6f42c1;
    background:#f9f5ff;
  }
  .option-card.correct-user, .option-card.correct {
    border-color: #198754 !important;
    background: #d1e7dd;
  }
  .option-card.incorrect-user {
    border-color:#dc3545 !important;
    background:#f8d7da;
  }
  .badge-label {
    font-size:.65rem;
    letter-spacing:.5px;
    text-transform:uppercase;
    font-weight:600;
  }
  .feedback-area {
    animation:fadeIn .35s;
  }
  @keyframes fadeIn {
    from {opacity:0;transform:translateY(4px)}
    to {opacity:1;transform:translateY(0)}
  }
  .progress-question {
    height:6px;
  }
  .donut-wrapper {
    position:relative;
    width:160px;
    height:160px;
    margin:auto;
  }
  .donut-wrapper canvas {
    width:100%;
    height:100%;
  }
  .donut-center {
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
    font-size:1.3rem;
  }
  .link-like { background:none;border:0;padding:0;color:#6f42c1;text-decoration:underline;cursor:pointer;font-size:.85rem; }
  .question-index { font-weight:600;}
  .question-header-mini {
    font-size:.8rem;
    color:#6c757d;
    text-transform:uppercase;
    letter-spacing:.5px;
  }
  .toggle-theme {
    position:fixed;
    bottom:1rem;
    right:1rem;
    z-index:1000;
  }
  .sr-only { 
    position:absolute;
    width:1px;
    height:1px;
    padding:0;
    margin:-1px;
    overflow:hidden;
    clip:rect(0,0,0,0);
    white-space:nowrap;
    border:0;
  }
</style>
</head>
<body>
<div class="container py-4" id="appRoot">
  <!-- Conteúdo gerado via JS -->
</div>

<button class="btn btn-outline-secondary btn-sm toggle-theme" id="themeBtn" title="Alternar tema">
  🌓
</button>

<script>
/**
 * ==============================
 * CONFIGURAÇÃO DO QUIZ (JSON)
 * ==============================
 * Estrutura:
 * id: identificador único (string | number)
 * type: 'single' ou 'multi'
 * question: texto
 * options: [{ id, text, correct, explanation? }]
 * explanation: (opcional) texto global sobre a questão
 */
const QUESTIONS_BANK = [
  {
    "id": 1,
    "type": "multi",
    "question": "From what places in SN can an agent create a case? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Customer Service Application",
        "correct": true
      },
      {
        "id": "B",
        "text": "Contact",
        "correct": true
      },
      {
        "id": "C",
        "text": "Account",
        "correct": true
      },
      {
        "id": "D",
        "text": "Chat",
        "correct": false
      }
    ],
    "explanation": "According to the official materials:\n- Agents can create Cases from:\nCustomer Service application\nRelated entities – Account, Contact, Consumer\nAn Interaction\nBusiness Location Service Portal\nEmail\n- Customers, on the other hand, can create cases through:\nCustomer Service Portal\nConsumer Service Portal\nVirtual Agent Chat\nSo while chat (Virtual Agent) is a channel for customers to initiate a\ncase, it's not a direct place where agents create cases. Instead,\nagents typically receive those cases after they're created by the\nsystem.\nReference:\n- CSM Fundamentals Course - Lesson 1 \"Case and Case Types\" -\nYokohama Textbook\n- Create a customer service case (ServiceNow Docs)"
  },
  {
    "id": 2,
    "type": "multi",
    "question": "What are the conditions that matching rules are based on? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Agent resources best suited to work on a case",
        "correct": true
      },
      {
        "id": "B",
        "text": "Specific routing rules",
        "correct": false
      },
      {
        "id": "C",
        "text": "Filters set up in advanced work assignment",
        "correct": false
      },
      {
        "id": "D",
        "text": "Specific case attributes",
        "correct": true
      }
    ],
    "explanation": "Matching Rules\nMatching rules are based on two defined sets of conditions, one\nthat identifies specific case attributes and another that\nidentifies the agent resources best suited to handle cases with\nthese attributes. Matching rules are created using the Matching\nRule form.\n-> A. and D. are correct\nReference: Routing and assigning customer service cases\n(ServiceNow Docs)"
  },
  {
    "id": 3,
    "type": "single",
    "question": "Matching rules enhance assignment capability by __________.",
    "options": [
      {
        "id": "A",
        "text": "Matching best agent by availability",
        "correct": true
      },
      {
        "id": "B",
        "text": "Providing dynamic matching of cases to groups or individuals",
        "correct": false
      },
      {
        "id": "C",
        "text": "Determining if account is a customer or partner",
        "correct": false
      },
      {
        "id": "D",
        "text": "Matching best agent by skill",
        "correct": false
      }
    ],
    "explanation": "From the System:\nIf you open 'Availability Today' and 'Matching Skills' criteria, the\ndescription suggests 'Availability based on the schedule, overlap\ntimezone and current time..' and 'Availability based on the\nskill.' and also script mentions 'This scripted dimension will return\na list of agents with the availability data as below'\nMoreover, from the Document:\nThe assignment workbench configuration is stored in a matching rule\nthat is based on the Selection criteria matching type.\nThe default configuration uses the Recommendation for Case\nAssignment matching rule, which uses three of the four default\nmatching criteria:\nAvailability Today\nMatching Skills\nAssigned Cases\nReference:\n- Matching rules for case assignment (ServiceNow Docs)\n- Configure case routing and assignment (ServiceNow Docs)"
  },
  {
    "id": 4,
    "type": "single",
    "question": "Special Handling Notes can apply to which one of the following based on",
    "options": [
      {
        "id": "A",
        "text": "Domain",
        "correct": false
      },
      {
        "id": "B",
        "text": "Contact",
        "correct": true
      },
      {
        "id": "C",
        "text": "Holiday",
        "correct": false
      },
      {
        "id": "D",
        "text": "VIP",
        "correct": false
      }
    ],
    "explanation": "Use the Special Handling Notes application to create notes that\nbring important information about individual records to an agent’s\nattention. Special Handling Notes can apply to any of the following\nentities, based on specific attributes:\n- Case\n- Account\n- Contact\n- Product\n- Model\n- Asset\nReference: Special handling notes overview (ServiceNow Docs)"
  },
  {
    "id": 5,
    "type": "single",
    "question": "Predictive Intelligence improves Case management by:",
    "options": [
      {
        "id": "A",
        "text": "Predicting what values should have gone into empty fields in historical records",
        "correct": false
      },
      {
        "id": "B",
        "text": "Reducing the number of records needed to accurately predict a value",
        "correct": false
      },
      {
        "id": "C",
        "text": "Replacing legacy routing rules",
        "correct": false
      },
      {
        "id": "D",
        "text": "Predicting Case values without manual intervention",
        "correct": true
      }
    ],
    "explanation": "Predictive Intelligence for case management:\nAssist agents with case creation by requiring a minimum of\ninformation, such as the short description, and predicting values\nfor the category, priority, and assignment group.\nFrom either Agent Workspace or the platform interface, agents\ncan use this feature when creating cases by providing the short\ndescription. Based on the information entered in the Short\ndescription field, the Predictive Intelligence feature predicts the\ncategory, priority, and assignment group, and routes the case to\nthe correct queue.\n-> Predictive Intelligence improves Case management by predicting\ncase values without manual intervention\nReference: Use Predictive Intelligence for case management\n(ServiceNow Docs)"
  },
  {
    "id": 6,
    "type": "single",
    "question": "Which of the following is a condition for matching rules?",
    "options": [
      {
        "id": "A",
        "text": "Agent domain",
        "correct": false
      },
      {
        "id": "B",
        "text": "Assignment",
        "correct": false
      },
      {
        "id": "C",
        "text": "Switching",
        "correct": false
      },
      {
        "id": "D",
        "text": "Specific case attributes",
        "correct": true
      }
    ],
    "explanation": "Configure case routing and assignment\nMatching rules are based on two defined sets of conditions: one\nthat identifies specific case attributes and another that\nidentifies the agent resources best suited to handle cases with\nthese attributes.\n-> D. is correct\nReference: Configure case routing and assignment (ServiceNow\nDocs)"
  },
  {
    "id": 7,
    "type": "multi",
    "question": "Predictive Intelligence improves triage quality by eliminating the",
    "options": [
      {
        "id": "A",
        "text": "Case Escalation",
        "correct": false
      },
      {
        "id": "B",
        "text": "Case State",
        "correct": false
      },
      {
        "id": "C",
        "text": "Case Categorization",
        "correct": true
      },
      {
        "id": "D",
        "text": "Case Prioritization",
        "correct": true
      }
    ],
    "explanation": "ServiceNow Predictive Intelligence can improve case triage quality by\neliminating guesswork from these case management decisions:\nCase Categorization\nCase Assignment\nCase Prioritization\nReference:\n- Predictive Intelligence for CSM solution definitions (ServiceNow\nDocs)\n- ServiceNow Predictive Intelligence"
  },
  {
    "id": 8,
    "type": "multi",
    "question": "Which Business Rules are part of the Customer Service Management",
    "options": [
      {
        "id": "A",
        "text": "Apply Role by Customer",
        "correct": false
      },
      {
        "id": "B",
        "text": "Auto Assessment",
        "correct": true
      },
      {
        "id": "C",
        "text": "Change Update to Close",
        "correct": false
      },
      {
        "id": "D",
        "text": "Update Case Entitlement",
        "correct": true
      }
    ],
    "explanation": "According to ServiceNow Doc, Auto Assessment and Update Case\nEntitlement are the Business Rules that are part of the Customer\nService Management baseline configuration:\nFor more details about Business Rules that are part of the Customer\nService Management baseline configuration please check on the\nreference link below\nReference: Business rules installed with Customer Service\nManagement (ServiceNow Docs)"
  },
  {
    "id": 9,
    "type": "multi",
    "question": "What are the Critical Success Factors that are related to CSM Suite",
    "options": [
      {
        "id": "A",
        "text": "Define the Business Pain Points",
        "correct": true
      },
      {
        "id": "B",
        "text": "Provide consistent service to customers",
        "correct": true
      },
      {
        "id": "C",
        "text": "Have a clear understanding of the use cases",
        "correct": true
      },
      {
        "id": "D",
        "text": "Define the number of hours needed to develop the associated requirements",
        "correct": false
      },
      {
        "id": "E",
        "text": "Implementation is only as good as the underlying process",
        "correct": true
      }
    ],
    "explanation": "***Critical Success Factors that are related to CSM Suite\nImplementations are:\nDefine the Business Pain Points\nProvide consistent service to customers\nHave a clear understanding of the use cases\nImplementation is only as good as the underlying process\nReference: ServiceNow Strategy"
  },
  {
    "id": 10,
    "type": "multi",
    "question": "What should be emphasized when designing solutions? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Minimize customizations",
        "correct": true
      },
      {
        "id": "B",
        "text": "Focus Out-of-the-box functionality",
        "correct": true
      },
      {
        "id": "C",
        "text": "Design for Scalability",
        "correct": true
      },
      {
        "id": "D",
        "text": "Mobile friendly functionality",
        "correct": false
      }
    ],
    "explanation": "-> A. and B. are correct as both of them are the same when you are\nfocused on OOB functionality, it minimizes customization.\n>< D. with the Mobile functionality cannot be ignored as it is usually\noptional\n-> C. is correct as Design for Scalability is the priority when\ndesigning solutions\nReference: ServiceNow Design an optimal agent and rep experience"
  },
  {
    "id": 11,
    "type": "multi",
    "question": "What role does the Engagement Manager play before the Workshop?",
    "options": [
      {
        "id": "A",
        "text": "Project Manager",
        "correct": true
      },
      {
        "id": "B",
        "text": "Acts as intermediary",
        "correct": false
      },
      {
        "id": "C",
        "text": "Provides answers to technical problems",
        "correct": false
      },
      {
        "id": "D",
        "text": "Assists with technical requirements",
        "correct": true
      }
    ],
    "explanation": "Refer to ServiceNow Engagement Manager doc, Engagement\nmanagers are seasoned leaders who build high-performing teams,\naccelerate time to value, and drive rapid and effective program\ndecision-making. Engagement managers deliver program\nmanagement expertise based on experience, continuous learning,\nand in-depth knowledge of ServiceNow methodologies.\n-> Project Manager and Assists with technical requirements roles are\nthe role that the Engagement Manager play before the Workshop\nReference: ServiceNow engagement manager"
  },
  {
    "id": 12,
    "type": "single",
    "question": "What should be part of the pre-engagement collateral?",
    "options": [
      {
        "id": "A",
        "text": "Frequently Asked Questions (FAQ)",
        "correct": false
      },
      {
        "id": "B",
        "text": "Scoping Guide",
        "correct": true
      },
      {
        "id": "C",
        "text": "Customer Service roles template",
        "correct": false
      },
      {
        "id": "D",
        "text": "Stock Keeping Unit (SKU) and pricing sheet",
        "correct": false
      }
    ],
    "explanation": "Pre-engagement collateral refers to the materials shared before a\nformal engagement (like workshops or implementation planning) to\nhelp align stakeholders, set expectations, and prepare for productive\ndiscussions.\n✅ The Scoping Guide is a key part of pre-engagement collateral\nbecause it:\nHelps assess the customer’s requirements and readiness\nOutlines implementation scope and business objectives\nGuides the discovery phase and planning\n❌ Other options:\nA. FAQ – Helpful for post-engagement or user adoption, but not\nessential pre-engagement material.\nC. Customer Service roles template – Useful for\nimplementation and configuration, not typically shared pre-\nengagement.\nD. SKU and pricing sheet – Sales-focused, more relevant during\nprocurement, not part of technical/implementation scoping.\nReference:\n- ServiceNow pre-engagement collateral\n- ServiceNow Scoping Guide"
  },
  {
    "id": 13,
    "type": "multi",
    "question": "Articles can provide the following: (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Document current and known issues",
        "correct": true
      },
      {
        "id": "B",
        "text": "Provide answers and responses to common issues or questions",
        "correct": true
      },
      {
        "id": "C",
        "text": "Information about customer's service contract Explanation This is not typically stored in knowledge articles. Service contract info is tied to the Contracts module or related records in CSM (like Entitlements or Service Level Agreements), not general knowledge base content.",
        "correct": false
      },
      {
        "id": "D",
        "text": "Share product information",
        "correct": true
      }
    ],
    "explanation": "Knowledge Articles in ServiceNow Customer Service Management\n(CSM) are designed to help both customers and agents quickly find\nrelevant information to resolve issues or understand\nservices/products better. Here's how each correct option applies:\n✅ A. Document current and known issues\nArticles can record known issues and their workarounds or\nstatus updates to reduce support load and improve\ntransparency.\n✅ B. Provide answers and responses to common issues or questions\nThis is a core use case for knowledge articles—deflecting cases\nby offering self-service solutions to frequently asked questions.\n✅ D. Share product information\nKnowledge articles can also be used to publish product\ndocumentation, updates, or specifications that assist\ncustomers and agents alike.\n❌ C. Information about customer’s service contract\nThis is not typically stored in knowledge articles. Service\ncontract info is tied to the Contracts module or related records\nin CSM (like Entitlements or Service Level Agreements), not\ngeneral knowledge base content.\nReference: Create a knowledge article (ServiceNow Docs)"
  },
  {
    "id": 14,
    "type": "single",
    "question": "Contextual Search framework is used for providing Knowledge search",
    "options": [
      {
        "id": "A",
        "text": "Entering question in portal only",
        "correct": false
      },
      {
        "id": "B",
        "text": "Record Producer only",
        "correct": false
      },
      {
        "id": "C",
        "text": "Both portal question entry and Record Producer",
        "correct": true
      },
      {
        "id": "D",
        "text": "None of the above",
        "correct": false
      }
    ],
    "explanation": "Contextual search:\nContextual search displays related results within a form or\nrecord producer based on the text you enter in a field.\" feels like\nboth the portal question entry and the record producer.\nReference: Contextual search (ServiceNow Docs)"
  },
  {
    "id": 15,
    "type": "multi",
    "question": "Which of the following are true regarding integrating a ServiceNow",
    "options": [
      {
        "id": "A",
        "text": "Imported external articles appear as attachments in ServiceNow",
        "correct": true
      },
      {
        "id": "B",
        "text": "Only applications that allow WebDAV connections can be integrated",
        "correct": true
      },
      {
        "id": "C",
        "text": "The imported article will have the same category it had in the source knowledge base",
        "correct": false
      },
      {
        "id": "D",
        "text": "SharePoint blocks this integration",
        "correct": false
      }
    ],
    "explanation": "- \"The acquire handler uses a WebDAV client to acquire external\ncontent to create articles.\" - B. is correct\n- \"Blank knowledge article is created and the external file is added as\nan attachment to the article.\" - A. is correct\n- \"The short description of the article is derived from the file name of\nthe external content source.\"\nReference: Import content from an external knowledge source\n(ServiceNow Docs)"
  },
  {
    "id": 16,
    "type": "multi",
    "question": "Access to a Knowledge base or Article can be restricted based on a",
    "options": [
      {
        "id": "A",
        "text": "Knowledge Product Entitlements",
        "correct": true
      },
      {
        "id": "B",
        "text": "Data Policy",
        "correct": false
      },
      {
        "id": "C",
        "text": "ACL",
        "correct": false
      },
      {
        "id": "D",
        "text": "User Criteria",
        "correct": true
      }
    ],
    "explanation": "From the CSM Implementation book (Lab 2.03): KPE restricts access\nto knowledge bases and articles based on products owned by the\ncustomer or consumer. Once verified, user criteria are the second\nlevel of security being applied, as both work in conjunction.\nAlso:\n\"You specify user criteria for a knowledge article to control which\nusers are granted read access to the knowledge article.\"\n\"The Knowledge Product Entitlements application enables\nadministrators to designate the knowledge bases and knowledge\narticles that customers can view from the Customer Service Portal.\"\nReference:\n- ServiceNow Control access at the knowledge article level through\nuser criteria\n- ServiceNow Knowledge product entitlements."
  },
  {
    "id": 17,
    "type": "multi",
    "question": "What are some benefits that Knowledge Product Entitlement provide?",
    "options": [
      {
        "id": "A",
        "text": "Reduces call volume",
        "correct": true
      },
      {
        "id": "B",
        "text": "Makes it easier for Agents to manage case volume",
        "correct": true
      },
      {
        "id": "C",
        "text": "Allows access to Knowledge Articles that are related to products owned by a customer",
        "correct": true
      },
      {
        "id": "D",
        "text": "Information about customer's service contract",
        "correct": false
      },
      {
        "id": "E",
        "text": "Focused product marketing",
        "correct": false
      }
    ],
    "explanation": "Some benefits that Knowledge Product Entitlement provides:\nReduces call volume\nMakes it easier for Agents to manage case volume\nAllows access to Knowledge Articles that are related to products\nowned by a customer\nReference: Knowledge product entitlements (ServiceNow Docs)"
  },
  {
    "id": 18,
    "type": "single",
    "question": "What are the characteristics of Knowledge Categories?",
    "options": [
      {
        "id": "A",
        "text": "Shareable across KBs: Yes ; Multi- Level: No",
        "correct": false
      },
      {
        "id": "B",
        "text": "Shareable across KBs: No ; Multi- Level: Yes",
        "correct": true
      },
      {
        "id": "C",
        "text": "Shareable across KBs: No ; Multi- Level: No",
        "correct": false
      },
      {
        "id": "D",
        "text": "Shareable across KBs: Yes ; Multi- Level: Yes",
        "correct": false
      }
    ],
    "explanation": "Shareable across KBs as No and the Multi-Level is Yes due to:\nEach knowledge base has a hierarchy of categories that\norganizes the articles.\nDefine a hierarchy for categories by creating parent-child\nrelationships. Each hierarchy consists of a top-level category and\na structure of subcategories, which are also named the child\ncategories. The category hierarchy is saved in the Full category\nfield in the Knowledge Category  [kb_category]  table.\nYou can create and edit categories separately for each knowledge\nbase.\nReference: Define a knowledge article category (ServiceNow Docs)"
  },
  {
    "id": 19,
    "type": "multi",
    "question": "Users with the",
    "options": [
      {
        "id": "A",
        "text": "Manage cases on behalf of customer service agents",
        "correct": false
      },
      {
        "id": "B",
        "text": "Create cases on behalf of customers",
        "correct": true
      },
      {
        "id": "C",
        "text": "Manage requests on behalf of customer service agents",
        "correct": false
      },
      {
        "id": "D",
        "text": "Create requests on behalf of customers",
        "correct": true
      },
      {
        "id": "E",
        "text": "Manage major incident communication on behalf of a customer service manager",
        "correct": false
      }
    ],
    "explanation": "The proxy contact role enables employees to create cases for\ncustomer accounts and contacts. Employees can also be proxy case\ncontacts on behalf of customers.\" which includes\n- Create cases on behalf of customers by email, phone, chat, Virtual\nAgent, and from the Customer Service Portal. (B.)\n- Create requests on behalf of customers from the Customer Service\nPortal. (D.)\nReference: Create cases as a proxy contact (ServiceNow Docs)"
  },
  {
    "id": 20,
    "type": "single",
    "question": "What is the purpose of a Catalog Item variable?",
    "options": [
      {
        "id": "A",
        "text": "Grants the customer the opportunity to ask a question",
        "correct": false
      },
      {
        "id": "B",
        "text": "Opens a wizard to help a customer fill in a case form",
        "correct": false
      },
      {
        "id": "C",
        "text": "Guides a customer by providing hints on case forms",
        "correct": false
      },
      {
        "id": "D",
        "text": "Allows the customer or consumer to qualify their answer",
        "correct": true
      }
    ],
    "explanation": "Service catalog variables\nService catalog variables capture and pass on information about\nchoices a customer makes when ordering a catalog item.\nVariables help define the structure of a catalog item form that is\ndisplayed to the customer.\n-> D. is correct\nReference: Service catalog variables (ServiceNow Docs)"
  },
  {
    "id": 21,
    "type": "single",
    "question": "What one of the following is optional when creating a Catalog workflow?",
    "options": [
      {
        "id": "A",
        "text": "Publishing the workflow",
        "correct": false
      },
      {
        "id": "B",
        "text": "Defining workflow activities",
        "correct": false
      },
      {
        "id": "C",
        "text": "Approving the workflow",
        "correct": true
      },
      {
        "id": "D",
        "text": "Managing workflow versions",
        "correct": false
      }
    ],
    "explanation": "When creating a Catalog workflow in ServiceNow, the following\nelements are typically part of the design and implementation\nprocess:\nA. Publishing the workflow – Required to make the workflow\navailable for use.\nB. Defining workflow activities – Mandatory to determine\nwhat actions the workflow performs.\nD. Managing workflow versions – Important for maintenance\nand improvement over time, especially in a production\nenvironment.\n🔸 C. Approving the workflow, however, is not required by\ndefault. While you can include approval steps within the workflow\n(like manager or group approvals), the act of “approving the\nworkflow itself” before it can be published or used is not\nmandatory.\nReference:\nCreate a catalog workflow (ServiceNow Docs)"
  },
  {
    "id": 22,
    "type": "single",
    "question": "What module is used to create Case Record Producers?",
    "options": [
      {
        "id": "A",
        "text": "Case Record Producers",
        "correct": false
      },
      {
        "id": "B",
        "text": "Edit Records",
        "correct": false
      },
      {
        "id": "C",
        "text": "Record Producers",
        "correct": true
      },
      {
        "id": "D",
        "text": "Maintain Records",
        "correct": false
      }
    ],
    "explanation": "Create a record producer\nYou can create a record producer for tables and database views\nthat are in the same scope as the record producer. Also for\ntables that allow create access from applications in other scopes.\nBefore you begin\nRole required:  catalog_admin  or  admin\nReference: Create a record producer (ServiceNow Docs)"
  },
  {
    "id": 23,
    "type": "single",
    "question": "Which one is NOT a dependency for the Customer Service Plugin?",
    "options": [
      {
        "id": "A",
        "text": "Task Activities",
        "correct": false
      },
      {
        "id": "B",
        "text": "Skills Management",
        "correct": false
      },
      {
        "id": "C",
        "text": "Openframe",
        "correct": false
      },
      {
        "id": "D",
        "text": "Communities",
        "correct": true
      }
    ],
    "explanation": "You can find all the dependencies for the Customer Service Plugin\n(Also for A. B. and C.) as reference links below and can check\nif Community is one of them\n-> D. is correct\nReference: Activate Customer Service Management (ServiceNow\nDocs)"
  },
  {
    "id": 24,
    "type": "single",
    "question": "ACME corporation wants to use ServiceNow CSM for supporting their",
    "options": [
      {
        "id": "A",
        "text": "Account",
        "correct": false
      },
      {
        "id": "B",
        "text": "Not supported",
        "correct": false
      },
      {
        "id": "C",
        "text": "Consumer",
        "correct": false
      },
      {
        "id": "D",
        "text": "Social Profile",
        "correct": true
      },
      {
        "id": "E",
        "text": "Personnel File",
        "correct": false
      }
    ],
    "explanation": "In ServiceNow Customer Service Management (CSM), when a\ncustomer interacts with your support team through social media\nplatforms such as Twitter, their profile details should be stored in\nthe Social Profile entity.\nSocial Profile is designed to store social media\nidentifiers and profile information.\nThis enables linking social media interactions (like tweets or\nDMs) to a Consumer, Contact, or Case, depending on how your\nCSM environment is configured.\nExample: If a customer reaches out via Twitter DM, ServiceNow can\ncapture the user’s Twitter handle and associate it with their Social\nProfile, which is then linked to a Consumer record for a complete\ncustomer 360° view.\n❌ Why not the other options?\nA. Account – Used for B2B customer organizations, not for\nstoring individual social profiles.\nB. Not supported – Twitter is supported via Social\nMessaging in ServiceNow (integration required).\nC. Consumer – Represents an individual customer, but not the\nplace to store social media info directly.\nE. Personnel File – Used in HRSD, not CSM.\nReference: Create a social media profile (ServicveNow Docs)"
  },
  {
    "id": 25,
    "type": "single",
    "question": "Which social media channels are NOT available out-of-box?",
    "options": [
      {
        "id": "A",
        "text": "Facebook",
        "correct": false
      },
      {
        "id": "B",
        "text": "Twitter",
        "correct": false
      },
      {
        "id": "C",
        "text": "LinkedIn",
        "correct": true
      },
      {
        "id": "D",
        "text": "All of the above",
        "correct": false
      },
      {
        "id": "E",
        "text": "None of the above",
        "correct": false
      }
    ],
    "explanation": "Social media integration:\nSupport case resolution through social media communication\nchannels.\nWhen working with customers or consumers to create and\nresolve cases, agents can select Social as the communication\nchannel and add a social profile to the Case form. Any\ncommunication with customers or consumers that takes place\nthrough social media is recorded on the Case form in the Social\nLogs related list.\nCustomer service managers can create one or more social\nprofiles for a user by recording a user's social profile\ninformation on a specific social media channel such as\nTwitter or Facebook. Managers can create social profiles for\naccounts, contacts, and consumers from the Social\nProfiles related list on the entity form. Agents have read-only\naccess to these profiles.\n-> C. is correct\nReference: Social media integration (ServiceNow Docs)"
  },
  {
    "id": 26,
    "type": "single",
    "question": "What is the equivalent of NOT selecting any group, when configuring",
    "options": [
      {
        "id": "A",
        "text": "Selecting all the groups",
        "correct": true
      },
      {
        "id": "B",
        "text": "Selecting none of the groups",
        "correct": false
      },
      {
        "id": "C",
        "text": "Missing configuration",
        "correct": false
      },
      {
        "id": "D",
        "text": "Misconfigured",
        "correct": false
      }
    ],
    "explanation": "User group:\nThe user groups selected for this configuration. Access to this\nconfiguration is limited to the users that have the openframe\nuser role and that belong to the selected groups.\nNote: If you do not select any groups, the configuration is\navailable to all users with the openframe user role.\nReference: Create an OpenFrame configuration (ServiceNow Docs)"
  },
  {
    "id": 27,
    "type": "single",
    "question": "How many outbound email accounts are supported in Customer Service",
    "options": [
      {
        "id": "A",
        "text": "One",
        "correct": true
      },
      {
        "id": "B",
        "text": "Unlimited",
        "correct": false
      },
      {
        "id": "C",
        "text": "Two",
        "correct": false
      },
      {
        "id": "D",
        "text": "One per business service",
        "correct": false
      }
    ],
    "explanation": "Email to case:\nThe system administrator can create multiple incoming email\naddresses that customers can use to communicate with\ncustomer service agents. The system administrator can\nalso create one outgoing email address.\n-> A. is correct\nSource: Email to case (ServiceNow Docs)"
  },
  {
    "id": 28,
    "type": "multi",
    "question": "What are features of Customer Service Management? (Choose four.)",
    "options": [
      {
        "id": "A",
        "text": "Timed Audits",
        "correct": false
      },
      {
        "id": "B",
        "text": "Service Entitlements",
        "correct": true
      },
      {
        "id": "C",
        "text": "Demand Management",
        "correct": false
      },
      {
        "id": "D",
        "text": "Service Prospecting",
        "correct": false
      },
      {
        "id": "E",
        "text": "Real-time SLAs",
        "correct": true
      }
    ],
    "explanation": "The features of Customer Service Management (CSM) are:\nSkills-based routing: This feature allows incoming service requests\nor incidents to be automatically routed to the most appropriate\nagent or team based on their skills, capacity, and availability.\nReal-time SLAs: This feature enables service level agreements (SLAs)\nto be defined and monitored in real-time, allowing service agents to\nproactively manage and resolve issues before they breach the SLA.\nService Entitlements: This feature enables organizations to define\nand manage service entitlements, which specify the type and level of\nsupport that customers are entitled to based on their contract or\nsubscription.\nService Contracts: This feature enables organizations to define and\nmanage service contracts, which outline the terms and conditions of\nthe service provided to customers.\nReference:\n- ServiceNow Doc\n- ServiceNow Advanced Work Assignment - Skill based Routing -\nCSM"
  },
  {
    "id": 29,
    "type": "multi",
    "question": "What are the Forum User Types? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Admin",
        "correct": false
      },
      {
        "id": "B",
        "text": "Registered",
        "correct": true
      },
      {
        "id": "C",
        "text": "Public",
        "correct": true
      },
      {
        "id": "D",
        "text": "Custom",
        "correct": true
      },
      {
        "id": "E",
        "text": "Moderator",
        "correct": false
      }
    ],
    "explanation": "Types of forum users are:\n- Public: Public users can view the community without logging in. By\ndefault, public users have content_read access to questions and\nanswers in public forums.\n- Registered: Users who have signed up to the community and\naccepted the Terms & Conditions. Once logged in, their access to\nforum content depends on the permissions set up for each specific\nforum.\n- Custom: Specific users and user groups that are added as members\nto the current forum user.\n- Membership: A group of members who have joined a specific\nforum. Once logged in, their access to forums depends on the\npermissions set up for each specific forum.\nReference: Create a forum user (ServiceNow Docs)"
  },
  {
    "id": 30,
    "type": "multi",
    "question": "Which of the following are true regarding the Community Portal",
    "options": [
      {
        "id": "A",
        "text": "It is available to any customer with a Community license",
        "correct": true
      },
      {
        "id": "B",
        "text": "It is available by default with the Support and Service portals",
        "correct": false
      },
      {
        "id": "C",
        "text": "It is only available to CSM license holders",
        "correct": false
      },
      {
        "id": "D",
        "text": "Most of the configuration does not require System Administrator role",
        "correct": true
      }
    ],
    "explanation": "- Licensed for the Customer Service Management application &\nlicensed for HR Service Delivery, so c. is wrong, which makes A. a\nlogical choice\n- The roles required to define requirements and set up forums\ninclude  sn_communities.admin  or  sn_communities.forum_admin . (D. is correct)\nReference:\n- Activate Communities plugins (ServiceNow Docs) - related\nto Licensing\n- Community setup guide for admins (ServiceNow Docs)  - related\nto Roles"
  },
  {
    "id": 31,
    "type": "multi",
    "question": "The available case types are: (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Product Support",
        "correct": false
      },
      {
        "id": "B",
        "text": "Order",
        "correct": true
      },
      {
        "id": "C",
        "text": "Product",
        "correct": true
      },
      {
        "id": "D",
        "text": "Support",
        "correct": false
      }
    ],
    "explanation": "The case types are: Product, Order, & Custom\nReference: ServiceNow CSM fundamentals course - Xanadu\nTextbook - \"Case and Case Types\" section\n***If any public sources are discovered later, they will be updated\naccordingly"
  },
  {
    "id": 32,
    "type": "single",
    "question": "What is required to enable the Follow the sun field on the Customer",
    "options": [
      {
        "id": "A",
        "text": "Nothing, it is a standard field",
        "correct": false
      },
      {
        "id": "B",
        "text": "The value property on the form must be set to true",
        "correct": false
      },
      {
        "id": "C",
        "text": "The plugin 'com.snc.csm_time_recording' needs to be activated",
        "correct": false
      },
      {
        "id": "D",
        "text": "The value property on the form must be set to true and the field added to the case form",
        "correct": true
      }
    ],
    "explanation": "Enable the Follow the sun check box on the Customer Service case\nform by setting the value of the\nproperty  sn_customerservice.FTS_flag_enabled  to true. Configure the form\nlayout to add this field to the Case form.\nReference: ServiceNow Case Form"
  },
  {
    "id": 33,
    "type": "single",
    "question": "In the Customer Service Management space, what does the term asset",
    "options": [
      {
        "id": "A",
        "text": "Financial, contractual and inventory information of assets",
        "correct": false
      },
      {
        "id": "B",
        "text": "A set of business activities and processes used to track assets",
        "correct": false
      },
      {
        "id": "C",
        "text": "Tables in the Asset application Correct answer",
        "correct": false
      },
      {
        "id": "D",
        "text": "Tracking products or services customers are using",
        "correct": false
      }
    ],
    "explanation": "To Customer Service Management, asset management has different\nuse cases for tracking products or services customers uses, or the\nassets the company uses to support customer-facing services.\nReference: ServiceNow Customer Service Management (CSM)\nFundamentals course - \"Asset Management and CMDB\" section\n***If any public sources are discovered later, they will be updated\naccordingly"
  },
  {
    "id": 34,
    "type": "single",
    "question": "Which of the following roles cannot update a consumer's record?",
    "options": [
      {
        "id": "A",
        "text": "sn_customerservice_agent",
        "correct": true
      },
      {
        "id": "B",
        "text": "sn_customerservice_manager C. sn_customerservice.consumer_agent",
        "correct": false
      },
      {
        "id": "D",
        "text": "admin",
        "correct": false
      }
    ],
    "explanation": "-> A. is correct\nReference: ServiceNow Roles installed with Customer Service\nManagement"
  },
  {
    "id": 35,
    "type": "single",
    "question": "Major Issue Management uses which one of the following capabilities?",
    "options": [
      {
        "id": "A",
        "text": "Governance Risk and Control",
        "correct": false
      },
      {
        "id": "B",
        "text": "Targeted Communications",
        "correct": true
      },
      {
        "id": "C",
        "text": "Asset management",
        "correct": false
      },
      {
        "id": "D",
        "text": "Record producers",
        "correct": false
      }
    ],
    "explanation": "Targeted Communications - This is a key feature of Major Issue\nManagement. When a major issue arises, effective communication\nabout the problem and its resolution to affected customers is crucial.\nP/s: \"Major issue management enables customer communication for\nissues that impact a wider audience. Use this feature to proactively\nidentify impacted customers, provide information to these customers,\nand manage the resolution process.\"\nReference:\n- ServiceNow Configure major issue management\n- ServiceNow Targeted Communications"
  },
  {
    "id": 36,
    "type": "single",
    "question": "What is required to synchronize fields from a parent to a child case(s)?",
    "options": [
      {
        "id": "A",
        "text": "The advanced plugin (com.sns.pa.customer_service_advanced) needs to be activated",
        "correct": false
      },
      {
        "id": "B",
        "text": "Major Issue Management needs to be installed and certain properties enabled",
        "correct": true
      },
      {
        "id": "C",
        "text": "No action required, this is a standard Customer Service Management feature",
        "correct": false
      },
      {
        "id": "D",
        "text": "The role of sn_customerservice.customer_case_manager must be assigned",
        "correct": false
      }
    ],
    "explanation": "Configure case synchronization:\n- Configure the major issue management system properties to\nenable synchronization between major cases and associated child\ncases.\nReference: ServiceNow Configure case synchronization"
  },
  {
    "id": 37,
    "type": "multi",
    "question": "Which of the following functions can be completed when using the Field",
    "options": [
      {
        "id": "A",
        "text": "Manage requests",
        "correct": false
      },
      {
        "id": "B",
        "text": "Execute assigned tasks",
        "correct": true
      },
      {
        "id": "C",
        "text": "Close work orders",
        "correct": true
      },
      {
        "id": "D",
        "text": "Manage cases",
        "correct": false
      },
      {
        "id": "E",
        "text": "Manage assets",
        "correct": true
      }
    ],
    "explanation": "Working with tasks when your mobile device is offline\n- Accept or reject tasks, record travel or work start time, track\ninventory, pause tasks, complete tasks, close work orders, and view\nknowledge articles using your mobile device when you are not\nconnected to the internet.\nWith your Field Service instance on your mobile device in offline\nmode, you can:\n- Execute tasks assigned to you at the task location.\n- View knowledge articles\n- Track asset usage.\n....\nReference: ServiceNow Field Service mobile offline application"
  },
  {
    "id": 38,
    "type": "single",
    "question": "Information in the Case Field 'Contact' is copied to which Incident Field?",
    "options": [
      {
        "id": "A",
        "text": "Contact",
        "correct": false
      },
      {
        "id": "B",
        "text": "User",
        "correct": false
      },
      {
        "id": "C",
        "text": "Customer",
        "correct": false
      },
      {
        "id": "D",
        "text": "Caller",
        "correct": true
      }
    ],
    "explanation": "-> D. is correct\nReference: ServiceNow How to map or copy field values from Case to\nIncident when using CSM Integration with Incident Management"
  },
  {
    "id": 39,
    "type": "single",
    "question": "How many active OpenFrame configurations can you have on an",
    "options": [
      {
        "id": "A",
        "text": "2",
        "correct": false
      },
      {
        "id": "B",
        "text": "Unlimited",
        "correct": true
      },
      {
        "id": "C",
        "text": "1",
        "correct": false
      },
      {
        "id": "D",
        "text": "3",
        "correct": false
      }
    ],
    "explanation": "Users can have Unlimited active OpenFrame configurations on an\ninstance\nReference: ServiceNow Create an OpenFrame configuration"
  },
  {
    "id": 40,
    "type": "multi",
    "question": "What are common types of application record data that are imported",
    "options": [
      {
        "id": "A",
        "text": "Knowledge Article",
        "correct": true
      },
      {
        "id": "B",
        "text": "Accounts",
        "correct": true
      },
      {
        "id": "C",
        "text": "Chat",
        "correct": false
      },
      {
        "id": "D",
        "text": "Case",
        "correct": false
      }
    ],
    "explanation": "According to ServiceNow Doc, The specific types of data that are\nimported will depend on the specific needs of the business and the\nCSM team.\nHere are some examples of why these two types of data are so\nimportant for CSM:\nAccounts: Accounts store information about the customer\norganizations the CSM team supports, such as their name,\naddress, contact information, and subscription status. This\ninformation is essential for the CSM team to provide effective\nsupport.\nKnowledge Articles: Knowledge articles contain information\nabout products, services, and troubleshooting procedures. This\ninformation is essential for the CSM team to quickly and\naccurately answer customer questions.\nImporting these two types of data allows the CSM team to quickly\nget up and running on the new system and start providing support\nto customers.\nReference: ServiceNow CSM Fundamental course - Xanadu\ntextbook\n***If any public sources are discovered later, they will be updated\naccordingly"
  },
  {
    "id": 41,
    "type": "multi",
    "question": "Which are the key self-service functions of the Customer Support Portal?",
    "options": [
      {
        "id": "A",
        "text": "Community",
        "correct": true
      },
      {
        "id": "B",
        "text": "Knowledge Base",
        "correct": true
      },
      {
        "id": "C",
        "text": "Open An Incident",
        "correct": false
      },
      {
        "id": "D",
        "text": "Service Catalog",
        "correct": true
      }
    ],
    "explanation": "The key self-service functions of the Customer Support Portal:\n- Service Portal\n- Knowledge Management and Community\n- Engagement Messenger\n- Virtual Agent\n- Service Catalog\nReference:\n- ServiceNow What is a Customer Portal?\n- ServiceNow Self-service for Customer Service Management"
  },
  {
    "id": 42,
    "type": "multi",
    "question": "The Customer Support Portal default configuration provides the following",
    "options": [
      {
        "id": "A",
        "text": "Web",
        "correct": false
      },
      {
        "id": "B",
        "text": "Social",
        "correct": false
      },
      {
        "id": "C",
        "text": "Chat",
        "correct": true
      },
      {
        "id": "D",
        "text": "Email",
        "correct": true
      }
    ],
    "explanation": "Omnichannel for communicating with customers:\n- Chat channel\nFrom the Customer Service Portal and Consumer Service Portal,\ncustomers can start a chat with a virtual or live agent for help directly\nfrom the website.\n- Email channel\nWith an email channel, customers can send emails to create new\ncases and update current cases. They can also receive email updates\nfrom customer service agents as cases progress.\n- Phone channel\nExternal customers can reach out to customer service agents by\nphone. The Customer Service Management application uses both\nComputer Telephony Integration (CTI) and OpenFrame to provide\nphone support for customers.\n-> C. and D. are correct\nReference: ServiceNow Omnichannels for communicating with\ncustomers"
  },
  {
    "id": 43,
    "type": "single",
    "question": "Out-of-the-box, the consumer support portal CANNOT be used for which",
    "options": [
      {
        "id": "A",
        "text": "Open an incident",
        "correct": true
      },
      {
        "id": "B",
        "text": "Viewing knowledge articles",
        "correct": false
      },
      {
        "id": "C",
        "text": "Live chat",
        "correct": false
      },
      {
        "id": "D",
        "text": "Consumer self-registration",
        "correct": false
      }
    ],
    "explanation": "From the Consumer Service Portal, consumers can:\nSearch for information, browse knowledge articles, and engage\nwith the community.\nStart a chat session with a customer service agent\nRegister, create a login, and create a user profile.\n-> Consumers cannot Open an incident -> A is correct\nReference: ServiceNow Using the Consumer Service Portal"
  },
  {
    "id": 44,
    "type": "single",
    "question": "Read the use case below to determine if the customer service relationship",
    "options": [
      {
        "id": "A",
        "text": "B2C",
        "correct": true
      },
      {
        "id": "B",
        "text": "B2B",
        "correct": false
      }
    ],
    "explanation": "It's a B2C as the above scenarios describe the process of selling\nproducts and services directly between a business and\nconsumers/customers"
  },
  {
    "id": 45,
    "type": "multi",
    "question": "Which of the following are channels? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Contacts",
        "correct": false
      },
      {
        "id": "B",
        "text": "Web",
        "correct": true
      },
      {
        "id": "C",
        "text": "Chat",
        "correct": true
      },
      {
        "id": "D",
        "text": "Article",
        "correct": false
      }
    ],
    "explanation": "Provide customer support by automatically routing incoming work to\nagents through service channels such as Web and Chat\nReference: ServiceNow Service channels"
  },
  {
    "id": 46,
    "type": "multi",
    "question": "If the CSM Demo Data Plugin has been installed what are two options",
    "options": [
      {
        "id": "A",
        "text": "Zboot the instance",
        "correct": false
      },
      {
        "id": "B",
        "text": "Disable the Case Interceptor",
        "correct": false
      },
      {
        "id": "C",
        "text": "Remove the Demo Data via a HI Request",
        "correct": true
      },
      {
        "id": "D",
        "text": "Clone back to this instance from a valid instance",
        "correct": true
      }
    ],
    "explanation": "If the CSM Demo Data Plugin has been installed, you need to remove\nthe Demo Data via a HI Request and clone back to this instance from\na valid instance to prepare for that instance to be used as part of the\nrelease path to production\nReference: ServiceNow Additional plugins for Customer Service\nManagement"
  },
  {
    "id": 47,
    "type": "single",
    "question": "What criteria can be used to determine when a new inbound case should",
    "options": [
      {
        "id": "A",
        "text": "When a new customer is created",
        "correct": false
      },
      {
        "id": "B",
        "text": "When an internal problem occurs",
        "correct": false
      },
      {
        "id": "C",
        "text": "When a customer has a question or issue to resolve",
        "correct": true
      },
      {
        "id": "D",
        "text": "When we have new marketing material for a customer",
        "correct": false
      }
    ],
    "explanation": "When a customer has a question or issue to resolve the best match\nanswers for the scenario that new inbound case should be opened\nOther answers belong to the internal work and not usually working\nthrough Inbound email\n-> B is correct\nReference: ServiceNow Creating rules for incoming emails that create\nand assign cases"
  },
  {
    "id": 48,
    "type": "multi",
    "question": "Which of the following are best practice with regard to data imports?",
    "options": [
      {
        "id": "A",
        "text": "When importing to multiple instances import to each instance separately.",
        "correct": false
      },
      {
        "id": "B",
        "text": "Use ServiceNow automatic functionality to clean the data after it is in ServiceNow tables rather than in the legacy repository.",
        "correct": false
      },
      {
        "id": "C",
        "text": "Ensure the field data lengths in ServiceNow are adequate for the imported data because ServiceNow does not automatically adjust the length.",
        "correct": true
      },
      {
        "id": "D",
        "text": "Images embedded in Knowledge Articles should be uploaded separately.",
        "correct": true
      }
    ],
    "explanation": "The best practices with regard to data imports are:\n- Ensure the field data lengths in ServiceNow are adequate for the\nimported data because ServiceNow does not automatically adjust\nthe length.\n- Images embedded in Knowledge Articles should be uploaded\nseparately.\nReference: ServiceNow Importing Data"
  },
  {
    "id": 49,
    "type": "single",
    "question": "What is the purpose of the Guided Decisions capability?",
    "options": [
      {
        "id": "A",
        "text": "Provide agents with an escalation guide",
        "correct": false
      },
      {
        "id": "B",
        "text": "Guide agents through account management",
        "correct": false
      },
      {
        "id": "C",
        "text": "Dynamically guide agents to help resolve complex cases",
        "correct": true
      },
      {
        "id": "D",
        "text": "Provide agents with a knowledge guide",
        "correct": false
      }
    ],
    "explanation": "Using Guided Decisions has the following benefits:\nImprove first contact resolution: Dynamically guide customer\nservice agents along the optimal path to resolve complex\ncases.\nShift to digital faster: Author decision trees and guide customer\nservice agents to take the next optimal action.\nImprove customer service agent productivity: Surface contextual\nrecommendations in the CSM workspace.\nReference:\n- ServiceNow Guided Decisions for Customer Service Management\n- ServiceNow Configuring Guided Decisions"
  },
  {
    "id": 50,
    "type": "single",
    "question": "Which feature enables you to quickly identify high-priority tasks based on",
    "options": [
      {
        "id": "A",
        "text": "Case Performance",
        "correct": false
      },
      {
        "id": "B",
        "text": "Case Analytics",
        "correct": false
      },
      {
        "id": "C",
        "text": "Case Digest",
        "correct": false
      },
      {
        "id": "D",
        "text": "Case Spotlight",
        "correct": true
      }
    ],
    "explanation": "Put a Spotlight on records\nSpotlight enables you to define weighted criteria for important\nwork and quickly identify the most important tasks based on\nthese criteria, such as when triaging cases or performing lead\nscoring. You can prioritize tasks based on multiple dimensions\ninstead of a single field value, like priority\nReference: ServiceNow Put a Spotlight on records"
  }
];

/**
 * ==============================
 * ESTADO DO APLICATIVO
 * ==============================
 */
let quizState = {
  startTime: null,
  endTime: null,
  currentIndex: 0,
  sequence: [],           // ordem randomizada de questões
  answers: {},            // answers[questionId] = { selected: Set([...]) , evaluated: bool }
  locked: {},             // locked[questionId] = true após avaliar
  reviewMode: false
};

const appRoot = document.getElementById("appRoot");

/**
 * ==============================
 * FUNÇÕES UTILITÁRIAS
 * ==============================
 */
function shuffle(array) {
  const arr = array.slice();
  for (let i = arr.length -1; i > 0; i--) {
    const j = Math.floor(Math.random()* (i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function initQuiz() {
  quizState.startTime = Date.now();
  quizState.endTime = null;
  quizState.currentIndex = 0;
  quizState.reviewMode = false;
  quizState.answers = {};
  quizState.locked = {};
  // criamos uma cópia profunda das questões + randomização de alternativas
  quizState.sequence = shuffle(QUESTIONS_BANK.map(q => {
    return {
      ...q,
      options: shuffle(q.options.map(o => ({...o})))
    };
  }));
  renderLayout();
  renderQuestion();
}

function formatDuration(ms) {
  const totalSec = Math.floor(ms/1000);
  const m = Math.floor(totalSec / 60);
  const s = totalSec % 60;
  return `${m}m ${s.toString().padStart(2,'0')}s`;
}

function getCurrentQuestion() {
  return quizState.sequence[quizState.currentIndex];
}

function countStats() {
  let correct = 0, incorrect = 0, skipped = 0;
  quizState.sequence.forEach(q => {
    const ans = quizState.answers[q.id];
    if (!ans || !quizState.locked[q.id]) {
      skipped++;
      return;
    }
    const selected = ans.selected;
    const correctSet = new Set(q.options.filter(o => o.correct).map(o => o.id));
    const isCorrect = selected.size === correctSet.size && Array.from(selected).every(id => correctSet.has(id));
    if (isCorrect) correct++; else incorrect++;
  });
  return { correct, incorrect, skipped, total: quizState.sequence.length };
}

/**
 * ==============================
 * RENDERIZAÇÃO PRINCIPAL
 * ==============================
 */
function renderLayout() {
  appRoot.innerHTML = `
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Quiz de Prática</h5>
      <div>
        <button class="btn btn-sm btn-outline-danger me-2" onclick="finishQuiz()">Finalizar Teste</button>
        <span class="small text-muted" id="timerSpan">00:00</span>
      </div>
    </div>
    <div class="progress mb-3">
      <div class="progress-bar" id="progressBar" style="width:0%"></div>
    </div>
    <div id="questionContainer"></div>
    <div class="mt-4 d-flex justify-content-between" id="navButtons">
      <button class="btn btn-outline-secondary" id="prevBtn" onclick="prevQuestion()" disabled>&lt;</button>
      <button class="btn btn-primary" id="nextBtn" onclick="nextOrSubmit()">Próxima &gt;</button>
    </div>
  `;
  startTimer();
}

let timerInterval = null;
function startTimer() {
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if (quizState.endTime) {
      clearInterval(timerInterval);
      return;
    }
    const diff = Date.now() - quizState.startTime;
    const totalSec = Math.floor(diff/1000);
    const m = Math.floor(totalSec / 60);
    const s = totalSec % 60;
    document.getElementById("timerSpan").textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  }, 1000);
}

function renderQuestion() {
  const q = getCurrentQuestion();
  const container = document.getElementById("questionContainer");
  const idx = quizState.currentIndex + 1;
  const total = quizState.sequence.length;
  const correctNeeded = q.type === 'multi' ? q.options.filter(o=>o.correct).length : 1;
  const answered = quizState.answers[q.id]?.selected || new Set();

  const progressPercent = ((idx-1)/total)*100;
  document.getElementById("progressBar").style.width = `${progressPercent}%`;

  const isLocked = !!quizState.locked[q.id];

  container.innerHTML = `
    <div class="mb-2 question-header-mini">Questão ${idx} de ${total}</div>
    <h6>${q.question} ${q.type === 'multi' ? `<span class="text-muted small">(Escolha ${correctNeeded})</span>` : ''}</h6>
    <div class="mt-3" id="optionsWrapper">
      ${q.options.map(opt => {
        const selected = answered.has(opt.id);
        const baseClasses = ["p-3","mb-2","border","rounded","option-card","d-flex","align-items-start"];
        if (selected) baseClasses.push("selected");
        if (isLocked) {
          const isCorrect = opt.correct;
            const userSelected = selected;
            if (userSelected && isCorrect) baseClasses.push("correct-user");
            else if (!userSelected && isCorrect) baseClasses.push("correct");
            else if (userSelected && !isCorrect) baseClasses.push("incorrect-user");
        }
        return `
          <div class="${baseClasses.join(' ')}" data-option="${opt.id}" onclick="toggleSelect('${q.id}','${opt.id}')">
            <div class="me-3 mt-1">
              ${q.type === 'single' 
                ? `<input type="radio" name="q_${q.id}" ${selected?'checked':''} ${isLocked?'disabled':''} />`
                : `<input type="checkbox" ${selected?'checked':''} ${isLocked?'disabled':''} />`
              }
            </div>
            <div class="flex-grow-1">
              
              <div class="fw-semibold">${opt.text}</div>
              ${ isLocked ? renderOptionBadge(q, opt, selected) : '' }
            </div>
          </div>
        `;
      }).join('')}
    </div>
    <div id="feedbackZone"></div>
    <div class="mt-3">
      ${ !isLocked ? `<button class="btn btn-success" id="submitBtn" disabled onclick="evaluateCurrent()">Confirmar Resposta</button>` : `
        <button class="btn btn-primary" onclick="goNextAfterLocked()">${ idx === total ? 'Resultados' : 'Próxima &gt;'}</button>
        <button class="btn btn-outline-secondary ms-2" onclick="previousAfterLocked()" ${idx===1?'disabled':''}>&lt; Voltar</button>
      `}
    </div>
  `;

  document.getElementById("prevBtn").disabled = idx === 1;
  document.getElementById("nextBtn").textContent = isLocked ? (idx === total ? "Resultados >" : "Próxima >") : "Próxima >";
  document.getElementById("nextBtn").disabled = !isLocked; // só navega depois de travar
  updateSubmitButtonState();
}

function renderOptionBadge(q, opt, userSelected) {
  // Multi: três casos (selecionou e está correto; não selecionou mas era correto; selecionou errado)
  if (q.type === 'multi') {
    if (userSelected && opt.correct) {
      return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Sua seleção está correta</span>`;
    }
    if (!userSelected && opt.correct) {
      return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Seleção correta</span>`;
    }
    if (userSelected && !opt.correct) {
      return `<span class="badge bg-danger-subtle text-danger border border-danger badge-label mt-1">Sua seleção está incorreta</span>`;
    }
    return '';
  } else {
    // Single
    if (opt.correct && userSelected) {
      return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Resposta correta</span>`;
    }
    if (opt.correct && !userSelected) {
      return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Resposta correta</span>`;
    }
    if (userSelected && !opt.correct) {
      return `<span class="badge bg-danger-subtle text-danger border border-danger badge-label mt-1">Incorreta</span>`;
    }
    return '';
  }
}

function updateSubmitButtonState() {
  const q = getCurrentQuestion();
  const ans = quizState.answers[q.id];
  const btn = document.getElementById("submitBtn");
  if (!btn) return;
  if (!ans || ans.selected.size === 0) {
    btn.disabled = true;
  } else {
    // Para multi, opcionalmente exigir no máximo número de corretas?
    // Aqui permitimos qualquer combinação, avaliaremos no momento da confirmação.
    btn.disabled = false;
  }
}

function toggleSelect(questionId, optionId) {
  const q = quizState.sequence.find(q => q.id == questionId);
  if (quizState.locked[q.id]) return; // já avaliada
  if (!quizState.answers[q.id]) quizState.answers[q.id] = { selected: new Set() };
  const selected = quizState.answers[q.id].selected;
  if (q.type === 'single') {
    selected.clear();
    selected.add(optionId);
  } else {
    if (selected.has(optionId)) selected.delete(optionId);
    else selected.add(optionId);
  }
  renderQuestion(); // re-render para atualizar UI (mais simples)
}

function evaluateCurrent() {
  const q = getCurrentQuestion();
  const ans = quizState.answers[q.id];
  if (!ans || ans.selected.size === 0) return;
  quizState.locked[q.id] = true;

  // Calcular correto ou não
  const correctSet = new Set(q.options.filter(o => o.correct).map(o => o.id));
  const isCorrect = ans.selected.size === correctSet.size && Array.from(ans.selected).every(id => correctSet.has(id));

  const feedbackZone = document.getElementById("feedbackZone");
  feedbackZone.innerHTML = `
    <div class="feedback-area mt-3">
      <div class="alert ${isCorrect? 'alert-success' : 'alert-danger'} mb-2">
        ${isCorrect ? 'Resposta correta! Bom trabalho.' : 'Resposta incorreta.'}
      </div>
      ${ q.explanation ? `<div class="small text-muted"><strong>Explicação:</strong> ${q.explanation}</div>` : '' }
    </div>
  `;
  renderQuestion(); // re-render para aplicar classes
}

function goNextAfterLocked() {
  const idx = quizState.currentIndex;
  if (idx === quizState.sequence.length -1) {
    finishQuiz();
  } else {
    quizState.currentIndex++;
    renderQuestion();
  }
}

function previousAfterLocked() {
  if (quizState.currentIndex > 0) {
    quizState.currentIndex--;
    renderQuestion();
  }
}

function nextOrSubmit() {
  const q = getCurrentQuestion();
  if (!quizState.locked[q.id]) {
    evaluateCurrent();
  } else {
    goNextAfterLocked();
  }
}

function prevQuestion() {
  if (quizState.currentIndex === 0) return;
  quizState.currentIndex--;
  renderQuestion();
}

/**
 * ==============================
 * TELA DE RESULTADOS
 * ==============================
 */
function finishQuiz() {
  quizState.endTime = Date.now();
  const stats = countStats();
  const duration = formatDuration(quizState.endTime - quizState.startTime);
  // registrar tentativa no localStorage
  const attemptsKey = 'quizAttempts';
  let attempts = parseInt(localStorage.getItem(attemptsKey) || '0', 10);
  attempts++;
  localStorage.setItem(attemptsKey, attempts);

  const percent = stats.total === 0 ? 0 : Math.round((stats.correct / stats.total)*100);

  appRoot.innerHTML = `
    <div class="mb-4">
      <h4 class="mb-0">Resultados do Quiz</h4>
      <div class="text-muted small">Tentativa ${attempts} • ${new Date().toLocaleString('pt-BR')}</div>
    </div>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-body d-flex flex-column justify-content-center">
            <div class="donut-wrapper mb-3">
              <canvas id="resultDonut" width="160" height="160" aria-label="Gráfico de resultados"></canvas>
              <div class="donut-center">${percent}%</div>
            </div>
            <div class="text-center small">
              <span class="me-2"><span class="badge bg-success">&nbsp;</span> Corretas: ${stats.correct}</span>
              <span class="me-2"><span class="badge bg-danger">&nbsp;</span> Incorretas: ${stats.incorrect}</span>
              <span><span class="badge bg-secondary">&nbsp;</span> Puladas: ${stats.skipped}</span>
            </div>
          </div>
          <div class="card-footer text-center">
            <strong>${stats.correct}/${stats.total}</strong> corretas<br/>
            Tempo: ${duration}
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card h-100">
          <div class="card-body">
            <p class="mb-3">Você concluiu o quiz. Use os botões abaixo para revisar cada questão ou refazer o teste com nova randomização.</p>
            <ul class="list-group mb-3 small">
              <li class="list-group-item d-flex justify-content-between"><span>Total de questões</span><strong>${stats.total}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Corretas</span><strong class="text-success">${stats.correct}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Incorretas</span><strong class="text-danger">${stats.incorrect}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Puladas / Não respondidas</span><strong class="text-secondary">${stats.skipped}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Percentual</span><strong>${percent}%</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Duração</span><strong>${duration}</strong></li>
            </ul>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-primary" onclick="reviewQuestions()">Rever Questões</button>
              <button class="btn btn-success" onclick="initQuiz()">Refazer (Randomizar)</button>
              <button class="btn btn-outline-secondary" onclick="toggleTheme()">Alternar Tema</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
  drawDonut(stats.correct, stats.incorrect, stats.skipped);
}

function drawDonut(correct, incorrect, skipped) {
  const canvas = document.getElementById("resultDonut");
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const total = correct + incorrect + skipped || 1;
  const data = [
    { value: correct, color: '#198754' },
    { value: incorrect, color: '#dc3545' },
    { value: skipped, color: '#6c757d' }
  ].filter(d => d.value > 0);

  let startAngle = -Math.PI/2;
  data.forEach(d => {
    const slice = (d.value / total) * Math.PI * 2;
    ctx.beginPath();
    ctx.moveTo(80,80);
    ctx.arc(80,80,80,startAngle,startAngle+slice);
    ctx.closePath();
    ctx.fillStyle = d.color;
    ctx.fill();
    startAngle += slice;
  });
  // buraco
  ctx.globalCompositeOperation = 'destination-out';
  ctx.beginPath();
  ctx.arc(80,80,48,0,Math.PI*2);
  ctx.fill();
  ctx.globalCompositeOperation = 'source-over';
  ctx.lineWidth = 2;
  ctx.strokeStyle = '#fff';
  ctx.beginPath();
  ctx.arc(80,80,80,0,Math.PI*2);
  ctx.stroke();
}

function reviewQuestions() {
  quizState.reviewMode = true;
  const stats = countStats();

  const questionBlocks = quizState.sequence.map((q,i) => {
    const ans = quizState.answers[q.id];
    const selected = ans ? ans.selected : new Set();
    const correctSet = new Set(q.options.filter(o => o.correct).map(o => o.id));
    const userCorrect = selected.size === correctSet.size && Array.from(selected).every(id => correctSet.has(id));
    return `
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span><strong>Questão ${i+1}:</strong> ${q.type === 'multi' ? '(Multi)' : '(Única)'}</span>
          <span class="badge ${userCorrect? 'bg-success' : 'bg-danger'}">${userCorrect? 'Correta' : 'Incorreta'}</span>
        </div>
        <div class="card-body">
          <p class="mb-3">${q.question}</p>
          ${q.options.map(o => {
            let classes = "p-2 px-3 mb-2 border rounded small";
            let badges = '';
            const userSel = selected.has(o.id);
            if (o.correct && userSel) {
              classes += " border-success bg-success-subtle";
              badges = '<span class="badge bg-success-subtle text-success border border-success badge-label">Sua seleção correta</span>';
            } else if (o.correct && !userSel) {
              classes += " border-success bg-success-subtle";
              badges = '<span class="badge bg-success-subtle text-success border border-success badge-label">Resposta correta</span>';
            } else if (!o.correct && userSel) {
              classes += " border-danger bg-danger-subtle";
              badges = '<span class="badge bg-danger-subtle text-danger border border-danger badge-label">Selecionada (Incorreta)</span>';
            } else {
              classes += " border-light";
            }
            return `<div class="${classes}">
              <strong>${o.id}.</strong> ${o.text}<br/>${badges}
            </div>`;
          }).join('')}
          ${ q.explanation ? `<div class="mt-2 small text-muted"><strong>Explicação:</strong> ${q.explanation}</div>` : '' }
        </div>
      </div>
    `;
  }).join('');

  appRoot.innerHTML = `
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0">Revisão das Questões</h4>
      <div class="d-flex gap-2">
        <button class="btn btn-success btn-sm" onclick="initQuiz()">Refazer</button>
        <button class="btn btn-outline-secondary btn-sm" onclick="finishQuiz()">Voltar aos Resultados</button>
      </div>
    </div>
    <div class="mb-3 small">
      <span class="me-3"><span class="badge bg-success">&nbsp;</span> Corretas: ${stats.correct}</span>
      <span class="me-3"><span class="badge bg-danger">&nbsp;</span> Incorretas: ${stats.incorrect}</span>
      <span><span class="badge bg-secondary">&nbsp;</span> Puladas: ${stats.skipped}</span>
    </div>
    ${questionBlocks}
  `;
  drawDonut(stats.correct, stats.incorrect, stats.skipped); // se quiser reutilizar (não tem canvas agora)
}

/**
 * ==============================
 * TEMA (CLARO / ESCURO)
 * ==============================
 */
const themeBtn = document.getElementById("themeBtn");
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-bs-theme') || 'light';
  const next = current === 'light' ? 'dark' : 'light';
  html.setAttribute('data-bs-theme', next);
  localStorage.setItem('quizTheme', next);
}
themeBtn.addEventListener('click', toggleTheme);
(function initThemeFromStorage(){
  const saved = localStorage.getItem('quizTheme');
  if (saved) document.documentElement.setAttribute('data-bs-theme', saved);
})();

/**
 * ==============================
 * INICIAR
 * ==============================
 */
initQuiz();

window.toggleSelect = toggleSelect;
window.evaluateCurrent = evaluateCurrent;
window.nextOrSubmit = nextOrSubmit;
window.prevQuestion = prevQuestion;
window.finishQuiz = finishQuiz;
window.reviewQuestions = reviewQuestions;
window.goNextAfterLocked = goNextAfterLocked;
window.previousAfterLocked = previousAfterLocked;
window.toggleTheme = toggleTheme;
</script>
</body>
</html>