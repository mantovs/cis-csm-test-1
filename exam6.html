<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="light">
<head>
<meta charset="UTF-8" />
<title>CIS-CSM Quiz 6</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
  body { background:#fff; }
  .option-card { cursor:pointer; transition:.15s; }
  .option-card:not(.disabled):hover { border-color:#6f42c1; box-shadow:0 0 0 .15rem rgba(111,66,193,.15); }
  .option-card.selected { border-width:2px; border-color:#6f42c1; background:#f9f5ff; }
  .option-card.correct-user, .option-card.correct { border-color:#198754!important; background:#d1e7dd; }
  .option-card.incorrect-user { border-color:#dc3545!important; background:#f8d7da; }
  .badge-label { font-size:.65rem; letter-spacing:.5px; text-transform:uppercase; font-weight:600; }
  .feedback-area { animation:fadeIn .35s; }
  @keyframes fadeIn { from {opacity:0;transform:translateY(4px)} to {opacity:1;transform:translateY(0)} }
  .donut-wrapper { position:relative; width:160px; height:160px; margin:auto; }
  .donut-wrapper canvas { width:100%; height:100%; }
  .donut-center { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:1.3rem; }
  .question-header-mini { font-size:.8rem; color:#6c757d; text-transform:uppercase; letter-spacing:.5px; }
  .toggle-theme { position:fixed; bottom:1rem; right:1rem; z-index:1000; }
  .question-status-alert { font-size:.8rem; }

  /* Matching */
  .matching-row {
    display:flex;
    gap:1rem;
    align-items:flex-start;
    padding:.75rem .9rem;
    border:1px solid #dee2e6;
    border-radius:.5rem;
    margin-bottom:.6rem;
    background:#fff;
  }
  .matching-row select { min-width:150px; }
  .matching-row.correct { border-color:#198754; background:#d1e7dd; }
  .matching-row.incorrect { border-color:#dc3545; background:#f8d7da; }
  .matching-left-text { flex:1; }
  .matching-badge {
    font-size:.6rem;
    letter-spacing:.5px;
    font-weight:600;
    text-transform:uppercase;
  }
  @media (max-width: 576px){
    .matching-row { flex-direction:column; }
    .matching-row select { width:100%; }
  }

  #themeBtn{
    display: none;
  }
</style>
</head>
<body>
<div class="container py-4" id="appRoot"></div>
<button class="btn btn-outline-secondary btn-sm toggle-theme" id="themeBtn" title="Alternar Tema">ðŸŒ“</button>

<script>
/* ==============================
 * CONFIG
 * ============================== */
const HIDE_OPTION_IDS = true; // Se quiser voltar a mostrar IDs (A., B., 1-, etc.) mude para false.

/* ==============================
 * QUESTÃ•ES (JSON BASE) - exemplo incluindo matching
 * ============================== */
const QUESTIONS_BANK_RAW = [
    {
        "id": 1,
        "type": "multiple",
        "question": "From what places in SN can an agent create a case? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Customer Service Application",
                "correct": true
            },
            {
                "id": "B",
                "text": "Contact",
                "correct": false
            },
            {
                "id": "C",
                "text": "Account",
                "correct": true
            },
            {
                "id": "D",
                "text": "Chat",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 2,
        "type": "multiple",
        "question": "What are the conditions that matching rules are based on? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Agent resources best suited to work on a case",
                "correct": true
            },
            {
                "id": "B",
                "text": "Specific routing rules",
                "correct": false
            },
            {
                "id": "C",
                "text": "Filters set up in advanced work assignment",
                "correct": false
            },
            {
                "id": "D",
                "text": "Specific case attributes",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 3,
        "type": "multiple",
        "question": "Predictive Intelligence improves triage quality by eliminating the guesswork. Predictive Intelligence supports which of the following decisions? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Case Escalation",
                "correct": false
            },
            {
                "id": "B",
                "text": "Case State",
                "correct": false
            },
            {
                "id": "C",
                "text": "Case Categorization",
                "correct": true
            },
            {
                "id": "D",
                "text": "Case Prioritization",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 4,
        "type": "multiple",
        "question": "Which Business Rules are part of the Customer Service Management baseline configuration? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Apply Role by Customer",
                "correct": false
            },
            {
                "id": "B",
                "text": "Auto Assessment",
                "correct": true
            },
            {
                "id": "C",
                "text": "Change Update to Close",
                "correct": false
            },
            {
                "id": "D",
                "text": "Update Case Entitlement",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 5,
        "type": "multiple",
        "question": "What are the Critical Success Factors that are related to CSM Suite Implementations? (Choose four.)",
        "options": [
            {
                "id": "A",
                "text": "Define the Business Pain Points",
                "correct": true
            },
            {
                "id": "B",
                "text": "Provide consistent service to customers",
                "correct": true
            },
            {
                "id": "C",
                "text": "Have a clear understanding of the use cases",
                "correct": true
            },
            {
                "id": "D",
                "text": "Define the number of hours needed to develop the associated requirements",
                "correct": false
            },
            {
                "id": "E",
                "text": "Implementation is only as good as the underlying process",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 6,
        "type": "multiple",
        "question": "What should be emphasized when designing solutions? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Minimize customizations",
                "correct": true
            },
            {
                "id": "B",
                "text": "Focus Out-of-the-box functionality",
                "correct": true
            },
            {
                "id": "C",
                "text": "Design for Scalability",
                "correct": true
            },
            {
                "id": "D",
                "text": "Mobile friendly functionality",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 7,
        "type": "multiple",
        "question": "What role does the Engagement Manager play before the Workshop? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Project Manager",
                "correct": true
            },
            {
                "id": "B",
                "text": "Acts as intermediary",
                "correct": false
            },
            {
                "id": "C",
                "text": "Provides answers to technical problems",
                "correct": false
            },
            {
                "id": "D",
                "text": "Assists with technical requirements",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 8,
        "type": "multiple",
        "question": "Articles can provide the following: (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Document current and known issues",
                "correct": true
            },
            {
                "id": "B",
                "text": "Provide answers and responses to common issues or questions",
                "correct": true
            },
            {
                "id": "C",
                "text": "Information about customer's service contract",
                "correct": false
            },
            {
                "id": "D",
                "text": "Share product information",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 9,
        "type": "multiple",
        "question": "Which of the following are true regarding integrating a ServiceNow Knowledge base with external content? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Imported external articles appear as attachments in ServiceNow",
                "correct": true
            },
            {
                "id": "B",
                "text": "Only applications that allow WebDAV connections can be integrated",
                "correct": true
            },
            {
                "id": "C",
                "text": "The imported article will have the same category it had in the source knowledge base",
                "correct": false
            },
            {
                "id": "D",
                "text": "SharePoint blocks this integration",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 10,
        "type": "multiple",
        "question": "Access to a Knowledge base or Article can be restricted based on a customer's assets and the product models using which of the following? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Knowledge Product Entitlements",
                "correct": true
            },
            {
                "id": "B",
                "text": "Data Policy",
                "correct": false
            },
            {
                "id": "C",
                "text": "ACL",
                "correct": false
            },
            {
                "id": "D",
                "text": "User Criteria",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 11,
        "type": "multiple",
        "question": "What are some benefits that Knowledge Product Entitlement provide? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Reduces call volume",
                "correct": true
            },
            {
                "id": "B",
                "text": "Makes it easier for Agents to manage case volume",
                "correct": true
            },
            {
                "id": "C",
                "text": "Allows access to Knowledge Articles that are related to products owned by a customer",
                "correct": true
            },
            {
                "id": "D",
                "text": "Information about customer's service contract",
                "correct": false
            },
            {
                "id": "E",
                "text": "Focused product marketing",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 12,
        "type": "multiple",
        "question": "Users with the sn_customerservice.proxy_contact role can do which of the following? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Manage cases on behalf of customer service agents",
                "correct": false
            },
            {
                "id": "B",
                "text": "Create cases on behalf of customers",
                "correct": true
            },
            {
                "id": "C",
                "text": "Manage requests on behalf of customer service agents",
                "correct": false
            },
            {
                "id": "D",
                "text": "Create requests on behalf of customers",
                "correct": true
            },
            {
                "id": "E",
                "text": "Manage major incident communication on behalf of a customer service manager",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 13,
        "type": "multiple",
        "question": "What are features of Customer Service Management? (Choose four.)",
        "options": [
            {
                "id": "A",
                "text": "Timed Audits",
                "correct": false
            },
            {
                "id": "B",
                "text": "Service Entitlements",
                "correct": true
            },
            {
                "id": "C",
                "text": "Demand Management",
                "correct": false
            },
            {
                "id": "D",
                "text": "Service Prospecting",
                "correct": false
            },
            {
                "id": "E",
                "text": "Real-time SLAs",
                "correct": true
            },
            {
                "id": "F",
                "text": "Service Contracts",
                "correct": true
            },
            {
                "id": "G",
                "text": "Skills-based routing",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 14,
        "type": "multiple",
        "question": "What are the Forum User Types? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Admin",
                "correct": false
            },
            {
                "id": "B",
                "text": "Registered",
                "correct": true
            },
            {
                "id": "C",
                "text": "Public",
                "correct": true
            },
            {
                "id": "D",
                "text": "Custom",
                "correct": true
            },
            {
                "id": "E",
                "text": "Moderator",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 15,
        "type": "multiple",
        "question": "Which of the following are true regarding the Community Portal application? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "It is available to any customer with a Community license",
                "correct": true
            },
            {
                "id": "B",
                "text": "It is available by default with the Support and Service portals",
                "correct": false
            },
            {
                "id": "C",
                "text": "It is only available to CSM license holders",
                "correct": false
            },
            {
                "id": "D",
                "text": "Most of the configuration does not require System Administrator role",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 16,
        "type": "multiple",
        "question": "The available case types are: (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Product Support",
                "correct": false
            },
            {
                "id": "B",
                "text": "Order",
                "correct": true
            },
            {
                "id": "C",
                "text": "Product",
                "correct": true
            },
            {
                "id": "D",
                "text": "Support",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 17,
        "type": "multiple",
        "question": "Which of the following functions can be completed when using the Field Service Management Application on a mobile device offline? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Manage requests",
                "correct": false
            },
            {
                "id": "B",
                "text": "Execute assigned tasks",
                "correct": true
            },
            {
                "id": "C",
                "text": "Close work orders",
                "correct": true
            },
            {
                "id": "D",
                "text": "Manage cases",
                "correct": false
            },
            {
                "id": "E",
                "text": "Manage assets",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 18,
        "type": "multiple",
        "question": "What are common types of application record data that are imported during a CSM data migration? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Knowledge Article",
                "correct": true
            },
            {
                "id": "B",
                "text": "Accounts",
                "correct": true
            },
            {
                "id": "C",
                "text": "Chat",
                "correct": false
            },
            {
                "id": "D",
                "text": "Case",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 19,
        "type": "multiple",
        "question": "Which are the key self-service functions of the Customer Support Portal? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Community",
                "correct": true
            },
            {
                "id": "B",
                "text": "Knowledge Base",
                "correct": true
            },
            {
                "id": "C",
                "text": "Open An Incident",
                "correct": false
            },
            {
                "id": "D",
                "text": "Service Catalog",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 20,
        "type": "multiple",
        "question": "Which of the following are channels? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Contacts",
                "correct": false
            },
            {
                "id": "B",
                "text": "Web",
                "correct": true
            },
            {
                "id": "C",
                "text": "Chat",
                "correct": true
            },
            {
                "id": "D",
                "text": "Article",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 21,
        "type": "multiple",
        "question": "The Customer Support Portal default configuration provides the following channels to interact with customers? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Web",
                "correct": false
            },
            {
                "id": "B",
                "text": "Social",
                "correct": false
            },
            {
                "id": "C",
                "text": "Chat",
                "correct": true
            },
            {
                "id": "D",
                "text": "Email",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 22,
        "type": "multiple",
        "question": "If the CSM Demo Data Plugin has been installed what are two options either of which will prepare that instance to be used as part of the release path to production? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Zboot the instance",
                "correct": false
            },
            {
                "id": "B",
                "text": "Disable the Case Interceptor",
                "correct": false
            },
            {
                "id": "C",
                "text": "Remove the Demo Data via a HI Request",
                "correct": true
            },
            {
                "id": "D",
                "text": "Clone back to this instance from a valid instance",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 23,
        "type": "multiple",
        "question": "Which of the following are best practice with regard to data imports? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "When importing to multiple instances import to each instance separately.",
                "correct": false
            },
            {
                "id": "B",
                "text": "Use ServiceNow automatic functionality to clean the data after it is in ServiceNow tables rather than in the legacy repository.",
                "correct": false
            },
            {
                "id": "C",
                "text": "Ensure the field data lengths in ServiceNow are adequate for the imported data because ServiceNow does not automatically adjust the length.",
                "correct": true
            },
            {
                "id": "D",
                "text": "Images embedded in Knowledge Articles should be uploaded separately.",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 24,
        "type": "multiple",
        "question": "What are some of the influencing factors that will help determine the type of customer support desk structure required? (Choose four.)",
        "options": [
            {
                "id": "A",
                "text": "Knowledge and skills required for agents",
                "correct": true
            },
            {
                "id": "B",
                "text": "Geographical location of customer",
                "correct": true
            },
            {
                "id": "C",
                "text": "Languages spoken by agents",
                "correct": true
            },
            {
                "id": "D",
                "text": "Number and type of support tools available",
                "correct": false
            },
            {
                "id": "E",
                "text": "Number of customer service portals used",
                "correct": false
            },
            {
                "id": "F",
                "text": "Number of agents required",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 25,
        "type": "multiple",
        "question": "Upon self-registration through the Consumer Service Portal, a record is created in: (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Contact (customer_contact)",
                "correct": false
            },
            {
                "id": "B",
                "text": "Consumer User (csm_consumer-user)",
                "correct": true
            },
            {
                "id": "C",
                "text": "Consumer (csm_consumer)",
                "correct": true
            },
            {
                "id": "D",
                "text": "CSM User (csm_user)",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 26,
        "type": "multiple",
        "question": "Who can create a customer service case from a community discussion? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Customer service agent (sn_customerservice_agent)",
                "correct": true
            },
            {
                "id": "B",
                "text": "Proxy case creator (sn_customerservice.proxy_case_creator)",
                "correct": true
            },
            {
                "id": "C",
                "text": "Partner (sn_customerservice.partner)",
                "correct": false
            },
            {
                "id": "D",
                "text": "Case Viewer (sn_customerservice.case_viewer)",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 27,
        "type": "multiple",
        "question": "The assignment workbench uses configurable matching criteria to evaluate agents in a selected group and provide an overall ranking. What are the different types of criteria available for the assignment workbench? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Correlation",
                "correct": false
            },
            {
                "id": "B",
                "text": "Availability",
                "correct": false
            },
            {
                "id": "C",
                "text": "Scripted",
                "correct": true
            },
            {
                "id": "D",
                "text": "Simple Match",
                "correct": true
            },
            {
                "id": "E",
                "text": "Aggregate",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 28,
        "type": "multiple",
        "question": "Asset classes are defined to allow for logical grouping of assets. There are five asset classes provided to group assets, each Asset class provides unique functionality for that group of Assets in the platform. Which of the following are the asset classes used? (Choose five.)",
        "options": [
            {
                "id": "A",
                "text": "Hardware assets",
                "correct": true
            },
            {
                "id": "B",
                "text": "Facility assets",
                "correct": true
            },
            {
                "id": "C",
                "text": "Configuration assets",
                "correct": false
            },
            {
                "id": "D",
                "text": "Software licenses assets",
                "correct": true
            },
            {
                "id": "E",
                "text": "Enterprise Software assets",
                "correct": true
            },
            {
                "id": "F",
                "text": "Network assets",
                "correct": false
            },
            {
                "id": "G",
                "text": "Consumables assets",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 29,
        "type": "multiple",
        "question": "What are the types of matching criteria for Customer Service? (Choose four.)",
        "options": [
            {
                "id": "A",
                "text": "Matching Skills",
                "correct": true
            },
            {
                "id": "B",
                "text": "Last Assigned",
                "correct": true
            },
            {
                "id": "C",
                "text": "Certifications",
                "correct": false
            },
            {
                "id": "D",
                "text": "Distance",
                "correct": false
            },
            {
                "id": "E",
                "text": "Assigned Cases",
                "correct": true
            },
            {
                "id": "F",
                "text": "Availability Today",
                "correct": true
            },
            {
                "id": "G",
                "text": "Partner Hours",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 30,
        "type": "multiple",
        "question": "Which ServiceNow applications can be integrated out-of-the-box with CSM? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Service Portfolio Management",
                "correct": true
            },
            {
                "id": "B",
                "text": "Project Management",
                "correct": true
            },
            {
                "id": "C",
                "text": "DevOps",
                "correct": false
            },
            {
                "id": "D",
                "text": "Risk Management",
                "correct": false
            },
            {
                "id": "E",
                "text": "ITOM Event Management",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 31,
        "type": "multiple",
        "question": "Which of the following are benefits that may be gained from using communities? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Reduce support costs",
                "correct": true
            },
            {
                "id": "B",
                "text": "Engagement with Customers",
                "correct": true
            },
            {
                "id": "C",
                "text": "Get product feedback",
                "correct": true
            },
            {
                "id": "D",
                "text": "Reduce cost per sales",
                "correct": false
            },
            {
                "id": "E",
                "text": "Increase marketing effectiveness",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 32,
        "type": "multiple",
        "question": "An Account Relationship is based on a defined account relationship type. Users with the System Administrator role can define two types of relationships: (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Partner-to-customer",
                "correct": false
            },
            {
                "id": "B",
                "text": "Account-to-customer",
                "correct": false
            },
            {
                "id": "C",
                "text": "Account-to-account",
                "correct": true
            },
            {
                "id": "D",
                "text": "Customer-to-Consumer",
                "correct": false
            },
            {
                "id": "E",
                "text": "Partner-to-account",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 33,
        "type": "multiple",
        "question": "When the virtual agent plugin is installed NLU is activated but is not available for use until what two configurations are completed? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Choose the NLU service provider",
                "correct": true
            },
            {
                "id": "B",
                "text": "In the NLU Settings configure the Intent confidence threshold",
                "correct": false
            },
            {
                "id": "C",
                "text": "Enable NLU in Virtual Agent",
                "correct": true
            },
            {
                "id": "D",
                "text": "In the NLU Settings configure the Entity confidence threshold",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 34,
        "type": "multiple",
        "question": "An entitlement defines the types of support a customer receives. Entitlements are based on a number of standard fields such as product and asset. When Proactive Customer Service Operations is implemented which additional fields could be used? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Contact",
                "correct": false
            },
            {
                "id": "B",
                "text": "Configuration Item",
                "correct": false
            },
            {
                "id": "C",
                "text": "Business Service",
                "correct": false
            },
            {
                "id": "D",
                "text": "Install base item",
                "correct": true
            },
            {
                "id": "E",
                "text": "Sold product",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 35,
        "type": "multiple",
        "question": "Advance Work Assignment assigns work to agents based on their availability, capacity, and skills. Agent Affinity enhances the Advanced Work Assignment process by adding additional agent details organized by affinity type. Which of these are these affinity types? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Skill seniority",
                "correct": false
            },
            {
                "id": "B",
                "text": "Account team responsibility",
                "correct": true
            },
            {
                "id": "C",
                "text": "Historical",
                "correct": true
            },
            {
                "id": "D",
                "text": "Related task",
                "correct": true
            },
            {
                "id": "E",
                "text": "Product expertise",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 36,
        "type": "multiple",
        "question": "Proactive Customer Service Operations works Event Management to proactively monitor and fix issues affecting customers. It can also trigger case workflow's and enable organizations to notify customers whose services or products are impacted by an outage or issue. What are the three main components that make up Proactive Customer Service Operations? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Proactive Prevention",
                "correct": false
            },
            {
                "id": "B",
                "text": "Service-Aware Install Base",
                "correct": true
            },
            {
                "id": "C",
                "text": "Service Reporting",
                "correct": false
            },
            {
                "id": "D",
                "text": "Proactive Case",
                "correct": true
            },
            {
                "id": "E",
                "text": "Service-Aware CMDB",
                "correct": false
            },
            {
                "id": "F",
                "text": "Service Monitoring",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 37,
        "type": "multiple",
        "question": "Which roles are considered external? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Consumer Support Agent (sn_customerservice.consumer_agent)",
                "correct": false
            },
            {
                "id": "B",
                "text": "Customer Admin (sn_customerservice.customer_admin)",
                "correct": true
            },
            {
                "id": "C",
                "text": "Partner Admin (sn_customerservice.partner_admin)",
                "correct": true
            },
            {
                "id": "D",
                "text": "Customer Service Agent (sn_customerservice_agent)",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 38,
        "type": "multiple",
        "question": "What are the different resource matching methods on the Matching Rule form? (Choose four.)",
        "options": [
            {
                "id": "A",
                "text": "History",
                "correct": false
            },
            {
                "id": "B",
                "text": "Scripted",
                "correct": true
            },
            {
                "id": "C",
                "text": "Advanced",
                "correct": true
            },
            {
                "id": "D",
                "text": "Simple",
                "correct": true
            },
            {
                "id": "E",
                "text": "Skill",
                "correct": false
            },
            {
                "id": "F",
                "text": "Selection Criteria",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 39,
        "type": "multiple",
        "question": "Which of the following child case states would cause parent - child case synchronization to fail? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Resolved",
                "correct": true
            },
            {
                "id": "B",
                "text": "In Progress",
                "correct": false
            },
            {
                "id": "C",
                "text": "Awaiting Info",
                "correct": false
            },
            {
                "id": "D",
                "text": "New",
                "correct": false
            },
            {
                "id": "E",
                "text": "Closed",
                "correct": true
            },
            {
                "id": "F",
                "text": "Cancelled",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 40,
        "type": "multiple",
        "question": "Playbooks for CSM provide step-by-step guidance for resolving specific types of customer service cases. What are the three out-of-the-box playbooks for CSM? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Case playbook for Onboarding",
                "correct": true
            },
            {
                "id": "B",
                "text": "Case playbook for Services",
                "correct": false
            },
            {
                "id": "C",
                "text": "Case playbook for Product Support",
                "correct": true
            },
            {
                "id": "D",
                "text": "Case playbook for Complaints",
                "correct": true
            },
            {
                "id": "E",
                "text": "Case playbook for Billing",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 41,
        "type": "multiple",
        "question": "Based on which out-of-box attributes can Special handling Notes be applied to cases? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Service Contract",
                "correct": false
            },
            {
                "id": "B",
                "text": "Install Base Item",
                "correct": false
            },
            {
                "id": "C",
                "text": "Product",
                "correct": true
            },
            {
                "id": "D",
                "text": "Account",
                "correct": true
            },
            {
                "id": "E",
                "text": "Contact",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 42,
        "type": "multiple",
        "question": "Application Scoping from a security perspective brings the following benefits: (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Improves instance security by limiting access to other applications on the instance",
                "correct": true
            },
            {
                "id": "B",
                "text": "Scoped applications prevent versioning for complex instances",
                "correct": false
            },
            {
                "id": "C",
                "text": "Scoping hold the records and acts as a container for the desired CSM applications",
                "correct": true
            },
            {
                "id": "D",
                "text": "Scoped applications limits autonomy and control of all aspects of the CSM application",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 43,
        "type": "multiple",
        "question": "What types of escalation templates can be created? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Case",
                "correct": true
            },
            {
                "id": "B",
                "text": "Sold Product",
                "correct": false
            },
            {
                "id": "C",
                "text": "Consumer",
                "correct": false
            },
            {
                "id": "D",
                "text": "Account",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 44,
        "type": "multiple",
        "question": "What are the recommended good practices when running implementation workshops? (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Give the customers the data they need so they can make an informed decision",
                "correct": true
            },
            {
                "id": "B",
                "text": "Any financial implication of a decision should be handled by the delivery and sales team",
                "correct": false
            },
            {
                "id": "C",
                "text": "Enforce customers to adapt their processes towards the baseline processes",
                "correct": false
            },
            {
                "id": "D",
                "text": "Engage with customers to gain deep understanding of their organization",
                "correct": true
            },
            {
                "id": "E",
                "text": "Guide the customer toward industry best practices",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 45,
        "type": "multiple",
        "question": "Which of the following are benefits of customer access management? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "It defaults the responsibility for access management to the customer service agent.",
                "correct": false
            },
            {
                "id": "B",
                "text": "It increases security by automatically providing access to case information based on account hierarchy",
                "correct": false
            },
            {
                "id": "C",
                "text": "It increases automation by automatically granting access to cases based on access to sold product",
                "correct": true
            },
            {
                "id": "D",
                "text": "It improves the customer experience by enabling related parties to track and collaborate on cases.",
                "correct": true
            },
            {
                "id": "E",
                "text": "It defaults the responsibility for access management to the customer",
                "correct": false
            }
        ],
        "explanation": ""
    },
    {
        "id": 46,
        "type": "multiple",
        "question": "What are the advantages of leading indicators over lagging indicators? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Hard to influence",
                "correct": false
            },
            {
                "id": "B",
                "text": "Prospective",
                "correct": true
            },
            {
                "id": "C",
                "text": "Retrospective",
                "correct": false
            },
            {
                "id": "D",
                "text": "Easy to influence",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 47,
        "type": "multiple",
        "question": "Which of the following roles have permission to create a relationship between a contact and an account? (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "sn_customerservice_agent",
                "correct": false
            },
            {
                "id": "B",
                "text": "sn_customerservice.customer_admm",
                "correct": false
            },
            {
                "id": "C",
                "text": "sn_customerservice.partner_admin",
                "correct": false
            },
            {
                "id": "D",
                "text": "sn_customerservice_manager",
                "correct": true
            },
            {
                "id": "E",
                "text": "admin",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 48,
        "type": "multiple",
        "question": "When creating or importing assets for CSM, model categories are used to: (Choose three.)",
        "options": [
            {
                "id": "A",
                "text": "Define whether a Configuration Item (CI) is created when an Asset record is created or vice versa",
                "correct": true
            },
            {
                "id": "B",
                "text": "Group assets together",
                "correct": true
            },
            {
                "id": "C",
                "text": "Build a classification structure for product models",
                "correct": false
            },
            {
                "id": "D",
                "text": "Model the configuration options for each product model being sold to customers",
                "correct": false
            },
            {
                "id": "E",
                "text": "Define a link between Asset classes and Configuration Item (CI) classes",
                "correct": true
            }
        ],
        "explanation": ""
    },
    {
        "id": 49,
        "type": "multiple",
        "question": "Viewing a customer's install base in the CSM Workspaces enables customer service agents to: (Choose two.)",
        "options": [
            {
                "id": "A",
                "text": "Close an upsell of related products and services not yet purchased by a customer",
                "correct": true
            },
            {
                "id": "B",
                "text": "See the detailed configurations of the products and services deployed for a customer to determine the action needed",
                "correct": true
            },
            {
                "id": "C",
                "text": "Trace Information provided in a case to the right product or service to which it relates",
                "correct": false
            },
            {
                "id": "D",
                "text": "Monitor related operational services and configuration items that affect service health",
                "correct": false
            }
        ],
        "explanation": ""
    }
];

function normalizeType(t){ return t === 'multiple' ? 'multi' : t; }
const QUESTIONS_BANK = QUESTIONS_BANK_RAW.map(q => ({ ...q, type: normalizeType(q.type) }));

/* ==============================
 * ESTADO / PERSISTÃŠNCIA
 * ============================== */
const QUIZ_SESSION_KEY = 'quizActiveSession_v3';
let quizState = {
  startTime: null,
  endTime: null,
  currentIndex: 0,
  sequence: [],
  answers: {}, // single/multi: { selected:Set }, matching: { pairs:{} }
  locked: {},
  reviewMode: false
};
const appRoot = document.getElementById("appRoot");

/* PersistÃªncia */
function saveSession() {
  if (quizState.endTime) return;
  try {
    const serializable = {
      startTime: quizState.startTime,
      currentIndex: quizState.currentIndex,
      sequence: quizState.sequence,
      answers: Object.fromEntries(
        Object.entries(quizState.answers).map(([qid, val]) => {
          if (val.selected instanceof Set) return [qid, { selected: Array.from(val.selected) }];
          return [qid, { pairs: val.pairs || {} }];
        })
      ),
      locked: quizState.locked
    };
    localStorage.setItem(QUIZ_SESSION_KEY, JSON.stringify(serializable));
  } catch(e){ console.warn("Falha salvar sessÃ£o", e); }
}
function restoreSessionIfAny() {
  try {
    const raw = localStorage.getItem(QUIZ_SESSION_KEY);
    if(!raw) return false;
    const data = JSON.parse(raw);
    if(!Array.isArray(data.sequence)) return false;
    quizState.startTime = data.startTime || Date.now();
    quizState.currentIndex = data.currentIndex || 0;
    quizState.sequence = data.sequence;
    quizState.answers = {};
    if (data.answers) {
      Object.entries(data.answers).forEach(([qid,val])=>{
        if(val.selected) quizState.answers[qid]={selected:new Set(val.selected)};
        else if(val.pairs) quizState.answers[qid]={pairs:{...val.pairs}};
      });
    }
    quizState.locked = data.locked || {};
    return true;
  } catch(e){ console.warn("Falha restaurar sessÃ£o", e); return false; }
}
function clearSession(){ localStorage.removeItem(QUIZ_SESSION_KEY); }

/* Utilidades */
function shuffle(a){ const arr=a.slice(); for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
function formatDuration(ms){ const s=Math.floor(ms/1000); const m=Math.floor(s/60); const r=s%60; return `${m}m ${r.toString().padStart(2,'0')}s`; }
function getCurrentQuestion(){ return quizState.sequence[quizState.currentIndex]; }

function initQuiz(){
  clearSession();
  quizState.startTime = Date.now();
  quizState.endTime = null;
  quizState.currentIndex = 0;
  quizState.answers = {};
  quizState.locked = {};
  quizState.reviewMode = false;
  quizState.sequence = shuffle(QUESTIONS_BANK.map(q=>{
    if(q.type==='matching'){
      return {
        ...q,
        left: shuffle(q.left.map(l=>({...l}))),
        right: shuffle(q.right.map(r=>({...r})))
      };
    }
    return { ...q, options: shuffle(q.options.map(o=>({...o}))) };
  }));
  renderLayout();
  renderQuestion();
  saveSession();
}

function countStats(){
  let correct=0, incorrect=0, skipped=0;
  quizState.sequence.forEach(q=>{
    const ans=quizState.answers[q.id];
    if(!ans || !quizState.locked[q.id]) { skipped++; return; }
    let isCorrect=false;
    if(q.type==='matching'){
      const pairs = ans.pairs || {};
      isCorrect = q.left.every(l=> pairs[l.id] === q.answerMap[l.id]);
    } else {
      const selected=ans.selected;
      const correctSet=new Set(q.options.filter(o=>o.correct).map(o=>o.id));
      isCorrect = selected.size===correctSet.size && Array.from(selected).every(id=>correctSet.has(id));
    }
    if(isCorrect) correct++; else incorrect++;
  });
  return {correct, incorrect, skipped, total:quizState.sequence.length};
}

/* Layout / Timer */
let timerInterval=null;
function renderLayout(){
  appRoot.innerHTML=`
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Servicenow CIS-CSM Exam 6</h5>
      <div>
  <a href="./home.html" class="btn btn-sm btn-outline-primary me-2">Home</a>
  <button class="btn btn-sm btn-outline-danger me-2" onclick="finishQuiz()">Finalizar Teste</button>
        <span class="small text-muted" id="timerSpan">00:00</span>
      </div>
    </div>
    <div class="progress mb-3">
      <div class="progress-bar" id="progressBar" style="width:0%"></div>
    </div>
    <div id="questionContainer"></div>
  `;
  startTimer();
}
function startTimer(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(quizState.endTime){ clearInterval(timerInterval); return; }
    const diff=Date.now()-quizState.startTime;
    const s=Math.floor(diff/1000);
    const m=Math.floor(s/60);
    const r=s%60;
    const el=document.getElementById('timerSpan');
    if(el) el.textContent=`${m.toString().padStart(2,'0')}:${r.toString().padStart(2,'0')}`;
  },1000);
}

/* Render questÃ£o */
function renderQuestion(){
  const q=getCurrentQuestion();
  const container=document.getElementById("questionContainer");
  if(!q || !container) return;
  const idx=quizState.currentIndex+1;
  const total=quizState.sequence.length;
  const isLocked=!!quizState.locked[q.id];
  const progressBar=document.getElementById("progressBar");
  if(progressBar) progressBar.style.width = `${((idx-1)/total)*100}%`;

  let answeredSet, pairs;
  if(q.type==='matching'){
    pairs = quizState.answers[q.id]?.pairs || {};
  } else {
    answeredSet = quizState.answers[q.id]?.selected || new Set();
  }

  // status geral
  let statusAlertHTML='';
  if(isLocked){
    let isCorrect=false;
    if(q.type==='matching'){
      isCorrect = q.left.every(l=> (pairs||{})[l.id] === q.answerMap[l.id]);
    } else {
      const correctSet=new Set(q.options.filter(o=>o.correct).map(o=>o.id));
      isCorrect = answeredSet.size===correctSet.size && Array.from(answeredSet).every(id=>correctSet.has(id));
    }
    statusAlertHTML = `
      <div class="mb-3">
        <div class="alert ${isCorrect?'alert-success':'alert-danger'} question-status-alert mb-0 py-2 px-3">
          <strong>${isCorrect?'Correta':'Incorreta'}:</strong>
          ${isCorrect?'VocÃª acertou esta questÃ£o.':'Esta questÃ£o foi respondida incorretamente.'}
        </div>
      </div>
    `;
  }

  let bodyHTML='';
  if(q.type==='matching'){
    bodyHTML = `
      <h6 class="mb-3">${q.question}</h6>
      ${statusAlertHTML}
      ${renderMatchingQuestion(q, pairs, isLocked)}
    `;
  } else {
    const correctNeeded = q.type==='multi' ? q.options.filter(o=>o.correct).length : 1;
    bodyHTML = `
      <h6 class="mb-3">${q.question} ${q.type==='multi'?`<span class="text-muted small">(Escolha ${correctNeeded})</span>`:''}</h6>
      ${statusAlertHTML}
      <div id="optionsWrapper">
        ${q.options.map(opt=>{
          const selected=answeredSet.has(opt.id);
            const classes=["p-3","mb-2","border","rounded","option-card","d-flex","align-items-start"];
            if(selected) classes.push("selected");
            if(isLocked){
              if(selected && opt.correct) classes.push("correct-user");
              else if(!selected && opt.correct) classes.push("correct");
              else if(selected && !opt.correct) classes.push("incorrect-user");
            }
            return `
              <div class="${classes.join(' ')}" onclick="toggleSelect('${q.id}','${opt.id}')">
                <div class="me-3 mt-1">
                  ${q.type==='single'
                    ? `<input type="radio" name="q_${q.id}" ${selected?'checked':''} ${isLocked?'disabled':''}/>`
                    : `<input type="checkbox" ${selected?'checked':''} ${isLocked?'disabled':''}/>`}
                </div>
                <div class="flex-grow-1">
                  <div class="fw-semibold">${HIDE_OPTION_IDS ? opt.text : `${opt.id}. ${opt.text}`}</div>
                  ${isLocked ? renderOptionBadge(q,opt,selected):''}
                </div>
              </div>
            `;
        }).join('')}
      </div>
    `;
  }

  container.innerHTML = `
    <div class="mb-2 question-header-mini">QuestÃ£o ${idx} de ${total}</div>
    ${bodyHTML}
    <div id="feedbackZone"></div>
    <div class="mt-3 d-flex justify-content-end gap-2 flex-wrap">
      ${!isLocked
        ? `${idx>1?'<button class="btn btn-outline-secondary" onclick="goPrev()">Voltar</button>':''}
           <button class="btn btn-success" id="submitBtn" disabled onclick="evaluateCurrent()">Confirmar Resposta</button>`
        : `${idx>1?'<button class="btn btn-outline-secondary" onclick="goPrev()">Voltar</button>':''}
           <button class="btn btn-primary" onclick="goNextAfterLocked()">${idx===total?'Resultados':'PrÃ³xima >'}</button>`
      }
    </div>
  `;

  if(isLocked && q.explanation){
    document.getElementById('feedbackZone').innerHTML = `
      <div class="feedback-area mt-3 small text-muted">
        <strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}
      </div>
    `;
  }

  updateSubmitButtonState();
}

/* Matching render */
function renderMatchingQuestion(q, pairs, isLocked){
  return `
    <div class="mb-2 small text-muted">Associe cada definiÃ§Ã£o ao papel correto.</div>
    <div id="matchingWrapper">
      ${q.left.map(l=>{
        const chosen = pairs[l.id] || '';
        let rowClass='matching-row';
        let badgeHTML='';
        if(isLocked){
          const correctId=q.answerMap[l.id];
          const isCorrect = chosen === correctId;
          rowClass += isCorrect ? ' correct' : ' incorrect';
          badgeHTML = `<span class="badge ${isCorrect?'bg-success-subtle text-success border border-success':'bg-danger-subtle text-danger border border-danger'} matching-badge ms-2">
            ${isCorrect?'Correto':'Incorreto'}${!isCorrect ? ' (Correto: '+ rightTextById(q, correctId) +')':''}
          </span>`;
        }
        return `
          <div class="${rowClass}" data-left="${l.id}">
            <div class="matching-left-text">${l.text}</div>
            <div>
              <select class="form-select form-select-sm" ${isLocked?'disabled':''}
                onchange="setMatchPair('${q.id}','${l.id}', this.value)">
                <option value="">-- Selecione --</option>
                ${q.right.map(r=>{
                  const selected = r.id === chosen ? 'selected':'';
                  let disable = '';
                  if(!isLocked && chosen !== r.id && Object.values(pairs).includes(r.id)) disable='disabled';
                  return `<option value="${r.id}" ${selected} ${disable}>${HIDE_OPTION_IDS ? r.text : (r.id + ' - ' + r.text)}</option>`;
                }).join('')}
              </select>
              ${badgeHTML}
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

/* Badges single/multi */
function renderOptionBadge(q,opt,userSelected){
  if(q.type==='multi'){
    if(userSelected && opt.correct) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Sua seleÃ§Ã£o estÃ¡ correta</span>`;
    if(!userSelected && opt.correct) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">SeleÃ§Ã£o correta</span>`;
    if(userSelected && !opt.correct) return `<span class="badge bg-danger-subtle text-danger border border-danger badge-label mt-1">Sua seleÃ§Ã£o estÃ¡ incorreta</span>`;
    return '';
  } else {
    if(opt.correct && userSelected) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Resposta correta</span>`;
    if(opt.correct && !userSelected) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Resposta correta</span>`;
    if(userSelected && !opt.correct) return `<span class="badge bg-danger-subtle text-danger border border-danger badge-label mt-1">Incorreta</span>`;
    return '';
  }
}

/* Estado botÃ£o confirmar */
function updateSubmitButtonState(){
  const q=getCurrentQuestion();
  const btn=document.getElementById("submitBtn");
  if(!btn) return;
  if(q.type==='matching'){
    const ans=quizState.answers[q.id];
    const filled = ans && ans.pairs ? Object.values(ans.pairs).filter(v=>v).length : 0;
    btn.disabled = filled !== q.left.length;
  } else {
    const ans=quizState.answers[q.id];
    btn.disabled = !(ans && ans.selected.size>0);
  }
}

/* InteraÃ§Ã£o single/multi */
function toggleSelect(qid, optId){
  const q=quizState.sequence.find(q=>q.id==qid);
  if(!q || q.type==='matching' || quizState.locked[q.id]) return;
  if(!quizState.answers[q.id]) quizState.answers[q.id]={selected:new Set()};
  const sel=quizState.answers[q.id].selected;
  if(q.type==='single'){ sel.clear(); sel.add(optId); }
  else {
    if(sel.has(optId)) sel.delete(optId); else sel.add(optId);
  }
  renderQuestion(); saveSession();
}

/* InteraÃ§Ã£o matching */
function setMatchPair(qid,leftId,rightId){
  const q=quizState.sequence.find(q=>q.id==qid);
  if(!q || q.type!=='matching' || quizState.locked[q.id]) return;
  if(!quizState.answers[q.id]) quizState.answers[q.id]={pairs:{}};
  const pairs=quizState.answers[q.id].pairs;
  if(rightId==='') delete pairs[leftId];
  else {
    Object.entries(pairs).forEach(([l,r])=>{
      if(r===rightId && l!==leftId) delete pairs[l];
    });
    pairs[leftId]=rightId;
  }
  renderQuestion(); saveSession();
}

/* Avaliar */
function evaluateCurrent(){
  const q=getCurrentQuestion();
  if(q.type==='matching'){
    const ans=quizState.answers[q.id];
    if(!ans || Object.keys(ans.pairs).length < q.left.length) return;
    quizState.locked[q.id]=true;
  } else {
    const ans=quizState.answers[q.id];
    if(!ans || ans.selected.size===0) return;
    quizState.locked[q.id]=true;
  }
  if(q.explanation){
    document.getElementById("feedbackZone").innerHTML=`
      <div class="feedback-area mt-3 small text-muted">
        <strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}
      </div>
    `;
  }
  renderQuestion(); saveSession();
}

function goNextAfterLocked(){
  if(quizState.currentIndex === quizState.sequence.length-1) finishQuiz();
  else { quizState.currentIndex++; renderQuestion(); saveSession(); }
}
function goPrev(){
  if(quizState.currentIndex===0) return;
  quizState.currentIndex--; renderQuestion(); saveSession();
}

/* Resultados */
function finishQuiz(){
  quizState.endTime=Date.now();
  const stats=countStats();
  const duration=formatDuration(quizState.endTime-quizState.startTime);
  clearSession();
  const attemptsKey='quizAttempts';
  let attempts=parseInt(localStorage.getItem(attemptsKey)||'0',10);
  attempts++; localStorage.setItem(attemptsKey,attempts);
  const percent = stats.total? Math.round((stats.correct/stats.total)*100) : 0;

  appRoot.innerHTML=`
    <div class="mb-4">
      <h4 class="mb-0">Resultados do Quiz</h4>
      <div class="text-muted small">Tentativa ${attempts} â€¢ ${new Date().toLocaleString('pt-BR')}</div>
    </div>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-body d-flex flex-column justify-content-center">
            <div class="donut-wrapper mb-3">
              <canvas id="resultDonut" width="160" height="160"></canvas>
              <div class="donut-center">${percent}%</div>
            </div>
            <div class="text-center small">
              <span class="me-2"><span class="badge bg-success">&nbsp;</span> Corretas: ${stats.correct}</span>
              <span class="me-2"><span class="badge bg-danger">&nbsp;</span> Incorretas: ${stats.incorrect}</span>
              <span><span class="badge bg-secondary">&nbsp;</span> Puladas: ${stats.skipped}</span>
            </div>
          </div>
          <div class="card-footer text-center">
            <strong>${stats.correct}/${stats.total}</strong> corretas<br/>Tempo: ${duration}
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card h-100">
          <div class="card-body">
            <p class="mb-3">VocÃª concluiu o quiz. Revise ou refaÃ§a para praticar novamente.</p>
            <ul class="list-group mb-3 small">
              <li class="list-group-item d-flex justify-content-between"><span>Total de questÃµes</span><strong>${stats.total}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Corretas</span><strong class="text-success">${stats.correct}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Incorretas</span><strong class="text-danger">${stats.incorrect}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Puladas</span><strong class="text-secondary">${stats.skipped}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Percentual</span><strong>${percent}%</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>DuraÃ§Ã£o</span><strong>${duration}</strong></li>
            </ul>
            <div class="d-flex flex-wrap gap-2">
              <a href="./home.html" class="btn btn-outline-primary">Home</a>
              <button class="btn btn-primary" onclick="reviewQuestions()">Rever Questes</button>
              <button class="btn btn-success" onclick="initQuiz()">Refazer (Randomizar)</button>
              <button class="btn btn-outline-secondary" onclick="toggleTheme()">Alternar Tema</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
  drawDonut(stats.correct, stats.incorrect, stats.skipped);
}

/* Donut */
function drawDonut(correct, incorrect, skipped){
  const canvas=document.getElementById("resultDonut");
  if(!canvas) return;
  const ctx=canvas.getContext('2d');
  const total=correct+incorrect+skipped||1;
  const data=[
    {value:correct,color:'#198754'},
    {value:incorrect,color:'#dc3545'},
    {value:skipped,color:'#6c757d'}
  ].filter(d=>d.value>0);
  let start=-Math.PI/2;
  data.forEach(d=>{
    const slice=(d.value/total)*Math.PI*2;
    ctx.beginPath();
    ctx.moveTo(80,80);
    ctx.arc(80,80,80,start,start+slice);
    ctx.closePath();
    ctx.fillStyle=d.color;
    ctx.fill();
    start+=slice;
  });
  ctx.globalCompositeOperation='destination-out';
  ctx.beginPath(); ctx.arc(80,80,48,0,Math.PI*2); ctx.fill();
  ctx.globalCompositeOperation='source-over';
}

/* RevisÃ£o */
function reviewQuestions(){
  const stats=countStats();
  const blocks=quizState.sequence.map((q,i)=>{
    const ans=quizState.answers[q.id];
    let userCorrect=false;

    if(q.type==='matching'){
      const pairs = ans ? ans.pairs || {} : {};
      userCorrect = ans && q.left.every(l=> pairs[l.id] === q.answerMap[l.id]);
      return `
        <div class="card mb-3">
          <div class="card-header d-flex justify-content-between">
            <span><strong>QuestÃ£o ${i+1}:</strong> (Matching)</span>
            <span class="badge ${userCorrect?'bg-success':'bg-danger'}">${userCorrect?'Correta':'Incorreta'}</span>
          </div>
          <div class="card-body">
            <p class="mb-3">${q.question}</p>
            ${q.left.map(l=>{
              const chosen = (ans && ans.pairs)? ans.pairs[l.id] : '';
              const correctId = q.answerMap[l.id];
              const isRowCorrect = chosen === correctId;
              return `
                <div class="matching-row ${isRowCorrect?'correct':'incorrect'}">
                  <div class="matching-left-text">${l.text}</div>
                  <div class="small">
                    <div><strong>Selecionado:</strong> ${chosen ? rightTextById(q, chosen) : '(vazio)'}</div>
                    <div><strong>Correto:</strong> ${rightTextById(q, correctId)}</div>
                  </div>
                </div>
              `;
            }).join('')}
            ${q.explanation?`<div class="small text-muted"><strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}</div>`:''}
          </div>
        </div>
      `;
    } else {
      const selected=ans ? ans.selected : new Set();
      const correctSet=new Set(q.options.filter(o=>o.correct).map(o=>o.id));
      userCorrect = ans && selected.size===correctSet.size && Array.from(selected).every(id=>correctSet.has(id));
      return `
        <div class="card mb-3">
          <div class="card-header d-flex justify-content-between">
            <span><strong>QuestÃ£o ${i+1}:</strong> ${q.type==='multi'?'(Multi)':'(Ãšnica)'}</span>
            <span class="badge ${userCorrect?'bg-success':'bg-danger'}">${userCorrect?'Correta':'Incorreta'}</span>
          </div>
          <div class="card-body">
            <p class="mb-3">${q.question}</p>
            ${q.options.map(o=>{
              let classes="p-2 px-3 mb-2 border rounded small";
              let badge='';
              const userSel=selected.has(o.id);
              if(o.correct && userSel){ classes+=" border-success bg-success-subtle"; badge='<span class="badge bg-success-subtle text-success border border-success badge-label">Sua seleÃ§Ã£o correta</span>'; }
              else if(o.correct && !userSel){ classes+=" border-success bg-success-subtle"; badge='<span class="badge bg-success-subtle text-success border border-success badge-label">Resposta correta</span>'; }
              else if(!o.correct && userSel){ classes+=" border-danger bg-danger-subtle"; badge='<span class="badge bg-danger-subtle text-danger border border-danger badge-label">Selecionada (Incorreta)</span>'; }
              else { classes+=" border-light"; }
              return `<div class="${classes}">${HIDE_OPTION_IDS?o.text:`<strong>${o.id}.</strong> ${o.text}`}<br/>${badge}</div>`;
            }).join('')}
            ${q.explanation?`<div class="small text-muted"><strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}</div>`:''}
          </div>
        </div>
      `;
    }
  }).join('');

  appRoot.innerHTML=`
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0">RevisÃ£o das QuestÃµes</h4>
      <div class="d-flex gap-2">
        <button class="btn btn-success btn-sm" onclick="initQuiz()">Refazer</button>
        <button class="btn btn-outline-secondary btn-sm" onclick="finishQuiz()">Voltar aos Resultados</button>
      </div>
    </div>
    <div class="mb-3 small">
      <span class="me-3"><span class="badge bg-success">&nbsp;</span> Corretas: ${stats.correct}</span>
      <span class="me-3"><span class="badge bg-danger">&nbsp;</span> Incorretas: ${stats.incorrect}</span>
      <span><span class="badge bg-secondary">&nbsp;</span> Puladas: ${stats.skipped}</span>
    </div>
    ${blocks}
  `;
}

/* Helpers right text */
function rightTextById(q, id){ const it=(q.right||[]).find(r=>r.id===id); return it?it.text:''; }

/* Tema */
const themeBtn=document.getElementById("themeBtn");
function toggleTheme(){
  const html=document.documentElement;
  const cur=html.getAttribute('data-bs-theme')||'light';
  const next=cur==='light'?'dark':'light';
  html.setAttribute('data-bs-theme',next);
  localStorage.setItem('quizTheme',next);
}
themeBtn.addEventListener('click',toggleTheme);
(function(){ const saved=localStorage.getItem('quizTheme'); if(saved) document.documentElement.setAttribute('data-bs-theme',saved); })();

/* NavegaÃ§Ã£o & exposiÃ§Ã£o */
function goNextAfterLocked(){ if(quizState.currentIndex===quizState.sequence.length-1) finishQuiz(); else {quizState.currentIndex++; renderQuestion(); saveSession();} }
function goPrev(){ if(quizState.currentIndex===0) return; quizState.currentIndex--; renderQuestion(); saveSession(); }

window.toggleSelect=toggleSelect;
window.evaluateCurrent=evaluateCurrent;
window.finishQuiz=finishQuiz;
window.reviewQuestions=reviewQuestions;
window.goNextAfterLocked=goNextAfterLocked;
window.goPrev=goPrev;
window.toggleTheme=toggleTheme;
window.initQuiz=initQuiz;
window.setMatchPair=setMatchPair;

/* Start */
(function start(){
  if(restoreSessionIfAny()){ renderLayout(); renderQuestion(); startTimer(); }
  else initQuiz();
})();
</script>
</body>
</html>