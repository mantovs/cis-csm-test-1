<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="light">
<head>
<meta charset="UTF-8" />
<title>CIS-CSM Exam 4</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
  body { background:#fff; }
  .option-card { cursor:pointer; transition:.15s; }
  .option-card:not(.disabled):hover { border-color:#6f42c1; box-shadow:0 0 0 .15rem rgba(111,66,193,.15); }
  .option-card.selected { border-width:2px; border-color:#6f42c1; background:#f9f5ff; }
  .option-card.correct-user, .option-card.correct { border-color:#198754!important; background:#d1e7dd; }
  .option-card.incorrect-user { border-color:#dc3545!important; background:#f8d7da; }
  .badge-label { font-size:.65rem; letter-spacing:.5px; text-transform:uppercase; font-weight:600; }
  .feedback-area { animation:fadeIn .35s; }
  @keyframes fadeIn { from {opacity:0;transform:translateY(4px)} to {opacity:1;transform:translateY(0)} }
  .donut-wrapper { position:relative; width:160px; height:160px; margin:auto; }
  .donut-wrapper canvas { width:100%; height:100%; }
  .donut-center { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:1.3rem; }
  .question-header-mini { font-size:.8rem; color:#6c757d; text-transform:uppercase; letter-spacing:.5px; }
  .toggle-theme { position:fixed; bottom:1rem; right:1rem; z-index:1000; }
  .question-status-alert { font-size:.8rem; }

  /* Matching */
  .matching-row {
    display:flex;
    gap:1rem;
    align-items:flex-start;
    padding:.75rem .9rem;
    border:1px solid #dee2e6;
    border-radius:.5rem;
    margin-bottom:.6rem;
    background:#fff;
  }
  .matching-row select { min-width:150px; }
  .matching-row.correct { border-color:#198754; background:#d1e7dd; }
  .matching-row.incorrect { border-color:#dc3545; background:#f8d7da; }
  .matching-left-text { flex:1; }
  .matching-badge {
    font-size:.6rem;
    letter-spacing:.5px;
    font-weight:600;
    text-transform:uppercase;
  }
  @media (max-width: 576px){
    .matching-row { flex-direction:column; }
    .matching-row select { width:100%; }
  }

  #themeBtn{
    display: none;
  }
</style>
</head>
<body>
<div class="container py-4" id="appRoot"></div>
<button class="btn btn-outline-secondary btn-sm toggle-theme" id="themeBtn" title="Alternar Tema">ðŸŒ“</button>

<script>
/* ==============================
 * CONFIG
 * ============================== */
const HIDE_OPTION_IDS = true; // Se quiser voltar a mostrar IDs (A., B., 1-, etc.) mude para false.

/* ==============================
 * QUESTÃ•ES (JSON BASE) - exemplo incluindo matching
 * ============================== */
const QUESTIONS_BANK_RAW = [
  {
    "id": 1,
    "type": "multiple",
    "question": "Service-aware Install Base consists of which entities? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Installed Products",
        "correct": true
      },
      {
        "id": "B",
        "text": "Install Base Items",
        "correct": true
      },
      {
        "id": "C",
        "text": "Assets",
        "correct": false
      },
      {
        "id": "D",
        "text": "Sold Products",
        "correct": true
      },
      {
        "id": "E",
        "text": "Configuration Items",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 2,
    "type": "single",
    "question": "What is the primary output from the Requirements Gathering workshop?",
    "options": [
      {
        "id": "A",
        "text": "Schedules",
        "correct": false
      },
      {
        "id": "B",
        "text": "Use Cases",
        "correct": false
      },
      {
        "id": "C",
        "text": "Stories",
        "correct": true
      },
      {
        "id": "D",
        "text": "Personas",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 3,
    "type": "single",
    "question": "What is a limitation regarding synchronization between a case and its associated work order?",
    "options": [
      {
        "id": "A",
        "text": "If information changes on the Case form it is not updated on the Work Order form",
        "correct": true
      },
      {
        "id": "B",
        "text": "Updates on a case or work order will only synchronize after the work order is approved",
        "correct": false
      },
      {
        "id": "C",
        "text": "When creating a work order from a case only the Account field on the work order form is filed in but not the Company field",
        "correct": false
      },
      {
        "id": "D",
        "text": "The data copied over to the Work Order form when creating a work order from a case cannot be configured or customized",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 4,
    "type": "multiple",
    "question": "Which roles can propose a case as a Major Case candidate? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Proxy contact (sn_customerservice.proxy_contact)",
        "correct": false
      },
      {
        "id": "B",
        "text": "Customer case manager (sn_customerservice.customer_case_manager)",
        "correct": false
      },
      {
        "id": "C",
        "text": "Customer service manager (sn_customerservice_manager)",
        "correct": true
      },
      {
        "id": "D",
        "text": "Customer service agent (sn_customerservice_agent)",
        "correct": true
      },
      {
        "id": "E",
        "text": "Major issue manager (sn_majorissue_mgt.major_issue_manager)",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 5,
    "type": "single",
    "question": "Which of the following is a required field in the Resolution Information tab in order to close a case?",
    "options": [
      {
        "id": "A",
        "text": "Cause",
        "correct": false
      },
      {
        "id": "B",
        "text": "Closed",
        "correct": false
      },
      {
        "id": "C",
        "text": "Resolution notes",
        "correct": true
      },
      {
        "id": "D",
        "text": "Closed by",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 6,
    "type": "single",
    "question": "Access to a Knowledge base or Article can be restricted based on a customer's assets and the product models using which of the following?",
    "options": [
      {
        "id": "A",
        "text": "Knowledge Product Entitlements",
        "correct": true
      },
      {
        "id": "B",
        "text": "Data Policy",
        "correct": false
      },
      {
        "id": "C",
        "text": "ACL",
        "correct": false
      },
      {
        "id": "D",
        "text": "User Criteria",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 7,
    "type": "multiple",
    "question": "What benefits does scoping an application bring? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "CSM teams can move at their desired pace, independent of IT",
        "correct": true
      },
      {
        "id": "B",
        "text": "Provides CSM teams autonomy and control",
        "correct": true
      },
      {
        "id": "C",
        "text": "CSM application data and business logic is protected from changes by other applications",
        "correct": true
      },
      {
        "id": "D",
        "text": "Account records can be changed only while in the CSM scope",
        "correct": false
      },
      {
        "id": "E",
        "text": "Changes in different scopes can be addressed in a single update set",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 8,
    "type": "multiple",
    "question": "A customer service agent wants to escalate an account but is unable to use the Escalate Account related link on the Account form. What could be the reasons why the customer service agent is not able to use it? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "No escalation approval flow is configured",
        "correct": false
      },
      {
        "id": "B",
        "text": "The parent account of the account to be escalated is not active",
        "correct": false
      },
      {
        "id": "C",
        "text": "The customer service agent is not assigned with the escalation requester role",
        "correct": true
      },
      {
        "id": "D",
        "text": "The account already has an open escalation record",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 9,
    "type": "single",
    "question": "After installing the Performance Analytics Content Pack for Customer Service, which job must be run to retrieve daily case data from previous months?",
    "options": [
      {
        "id": "A",
        "text": "Customer Service Historic Data Collection",
        "correct": true
      },
      {
        "id": "B",
        "text": "Customer Service Initial Data Collection",
        "correct": false
      },
      {
        "id": "C",
        "text": "Customer Service Daily Data Collection",
        "correct": false
      },
      {
        "id": "D",
        "text": "Customer Service Case Data Collection",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 10,
    "type": "multiple",
    "question": "When working with communication channels, what inbound email flows are available by default? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Create case for product",
        "correct": false
      },
      {
        "id": "B",
        "text": "Create case for asset",
        "correct": false
      },
      {
        "id": "C",
        "text": "Update case from forward email",
        "correct": false
      },
      {
        "id": "D",
        "text": "Create case from email",
        "correct": true
      },
      {
        "id": "E",
        "text": "Update case using reply",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 11,
    "type": "single",
    "question": "What determines how an escalation request is processed?",
    "options": [
      {
        "id": "A",
        "text": "Escalation Rule",
        "correct": false
      },
      {
        "id": "B",
        "text": "Escalation Template",
        "correct": true
      },
      {
        "id": "C",
        "text": "Escalation Severity",
        "correct": false
      },
      {
        "id": "D",
        "text": "Escalation Justification",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 12,
    "type": "single",
    "question": "What allows the implementation of phases and tasks to meet performance goals track progress and measure success?",
    "options": [
      {
        "id": "A",
        "text": "Performance Analytics Spotlight",
        "correct": false
      },
      {
        "id": "B",
        "text": "Scheduled Reporting",
        "correct": false
      },
      {
        "id": "C",
        "text": "Service Level Agreement Tasks",
        "correct": false
      },
      {
        "id": "D",
        "text": "Continual Improvement Management",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 13,
    "type": "single",
    "question": "For security purposes certain roles cannot be assigned to a group or individual at the same time. Which of the following two roles would be restricted?",
    "options": [
      {
        "id": "A",
        "text": "snc_intemai and snc_external",
        "correct": true
      },
      {
        "id": "B",
        "text": "snc_internal and sn_customerservice.consumer_agent",
        "correct": false
      },
      {
        "id": "C",
        "text": "snc_internal and sn_customerservice_agent",
        "correct": false
      },
      {
        "id": "D",
        "text": "snc_external and sn_customerservice.customer",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 14,
    "type": "single",
    "question": "What are Special Handling Notes used for?",
    "options": [
      {
        "id": "A",
        "text": "Bring important information about individual records to an agent's attention",
        "correct": true
      },
      {
        "id": "B",
        "text": "For agents to view articles an attach them to a case",
        "correct": false
      },
      {
        "id": "C",
        "text": "To ensure customers get the service they are entitled to receive",
        "correct": false
      },
      {
        "id": "D",
        "text": "Help agents identify in which time zone a contact is located",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 15,
    "type": "multiple",
    "question": "A customer service manager would like to limit the reading and creation of knowledge articles within a specific Knowledge Base to the Customer Support group only. Which features should be used to accomplish this? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Can Read user criteria",
        "correct": true
      },
      {
        "id": "B",
        "text": "Whitelist all other groups from the Knowledge Base",
        "correct": false
      },
      {
        "id": "C",
        "text": "Hide the Knowledge Base from the Knowledge Base Portal",
        "correct": false
      },
      {
        "id": "D",
        "text": "Cannot Contribute user criteria",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 16,
    "type": "single",
    "question": "In case management, Parent Child Synchronization allows for which of the following:",
    "options": [
      {
        "id": "A",
        "text": "Enabling the Customer Service agent to create cases so that all the children cases can be managed by managing the parent case",
        "correct": true
      },
      {
        "id": "B",
        "text": "Parent cases to automatically generate child cases when all fields are filled out thus synchronized auto-population",
        "correct": false
      },
      {
        "id": "C",
        "text": "Child cases to be separated from Parent cases and will not be synchronized automatically",
        "correct": false
      },
      {
        "id": "D",
        "text": "Synchronization of all child cases as well as children of child cases on all levels",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 17,
    "type": "multiple",
    "question": "Which predefined conversations are available for Customer Service Virtual Agent? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Create Contact",
        "correct": false
      },
      {
        "id": "B",
        "text": "Check Case Status",
        "correct": true
      },
      {
        "id": "C",
        "text": "Close Case",
        "correct": false
      },
      {
        "id": "D",
        "text": "Get Help with an Order",
        "correct": true
      },
      {
        "id": "E",
        "text": "Get Help with an Asset",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 18,
    "type": "single",
    "question": "What will be the state of a case after a customer rejects the solution proposed by an agent?",
    "options": [
      {
        "id": "A",
        "text": "In Progress",
        "correct": false
      },
      {
        "id": "B",
        "text": "Open",
        "correct": true
      },
      {
        "id": "C",
        "text": "New",
        "correct": false
      },
      {
        "id": "D",
        "text": "Solution Rejected",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 19,
    "type": "multiple",
    "question": "Which of the following statements is correct with regards to partners vs. third-parties in ServiceNow's CSM application? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "A partner will own the relationship with their customer",
        "correct": false
      },
      {
        "id": "B",
        "text": "A partner and a third party are the same in ServiceNow's CSM application",
        "correct": false
      },
      {
        "id": "C",
        "text": "A partner does not own the relationship with a customer. This relationship is owned by the organization they are partnering",
        "correct": true
      },
      {
        "id": "D",
        "text": "A partner is an organization that has been contracted to sell products and services they have actually purchased from another organization",
        "correct": false
      },
      {
        "id": "E",
        "text": "A partner does not own any of the products or services provided by their partnering organization, instead they help to sell, deliver and support them on their behalf",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 20,
    "type": "multiple",
    "question": "Advanced Work Assignment (AWA) automatically routes and assigns work items to agents based on which of the following rules? (Choose four.)",
    "options": [
      {
        "id": "A",
        "text": "Experience",
        "correct": false
      },
      {
        "id": "B",
        "text": "Skills",
        "correct": true
      },
      {
        "id": "C",
        "text": "Availability",
        "correct": true
      },
      {
        "id": "D",
        "text": "Shifts",
        "correct": true
      },
      {
        "id": "E",
        "text": "Capacity",
        "correct": true
      },
      {
        "id": "F",
        "text": "Products",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 21,
    "type": "multiple",
    "question": "From which places in ServiceNow can a customer service agent [sn_customerservice_agent] create a case? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Account",
        "correct": true
      },
      {
        "id": "B",
        "text": "Incident",
        "correct": false
      },
      {
        "id": "C",
        "text": "Customer Service Application",
        "correct": true
      },
      {
        "id": "D",
        "text": "Special Handling Note",
        "correct": false
      },
      {
        "id": "E",
        "text": "Chat",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 22,
    "type": "single",
    "question": "Which table must be extended when creating a new case type?",
    "options": [
      {
        "id": "A",
        "text": "Case (sn_customerservice_case)",
        "correct": true
      },
      {
        "id": "B",
        "text": "Case Task (sn_customerservice_case_task)",
        "correct": false
      },
      {
        "id": "C",
        "text": "Task (task)",
        "correct": false
      },
      {
        "id": "D",
        "text": "Case Type (sn_case_type)",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 23,
    "type": "multiple",
    "question": "What are benefits of the Conversation History feature? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Shorter calls for agents by reducing the time to search for information",
        "correct": true
      },
      {
        "id": "B",
        "text": "A customized admin chat toolbar with emojis for agents to use in chat messages",
        "correct": false
      },
      {
        "id": "C",
        "text": "Improved customer satisfaction as agents can respond to and resolve customer issues faster",
        "correct": true
      },
      {
        "id": "D",
        "text": "Better language management by flagging key words and alerting chat managers when agents use one or more of those words",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 24,
    "type": "single",
    "question": "What is the benefit of a phased release approach?",
    "options": [
      {
        "id": "A",
        "text": "Team members schedules are able to synchronize",
        "correct": false
      },
      {
        "id": "B",
        "text": "More time to develop stories",
        "correct": false
      },
      {
        "id": "C",
        "text": "Working across multiple systems of record",
        "correct": false
      },
      {
        "id": "D",
        "text": "Delivery of core functionality quickly",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 25,
    "type": "multiple",
    "question": "On the Customer Service Portal which personas can see work orders from their company hierarchy? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Partner admin",
        "correct": true
      },
      {
        "id": "B",
        "text": "Partner contact",
        "correct": false
      },
      {
        "id": "C",
        "text": "Customer admin",
        "correct": true
      },
      {
        "id": "D",
        "text": "Customer contact",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 26,
    "type": "single",
    "question": "What is the most efficient way to get cases to be closed automatically after a few days?",
    "options": [
      {
        "id": "A",
        "text": "Set the property glide.auto.close.cases resolved to true",
        "correct": false
      },
      {
        "id": "B",
        "text": "Create a workflow associated with cases with a timer that changes the state after a few days",
        "correct": false
      },
      {
        "id": "C",
        "text": "Create a Scheduled job that looks at the resolved_at date",
        "correct": false
      },
      {
        "id": "D",
        "text": "Activate the Auto Close Resolved Cases flow",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 27,
    "type": "multiple",
    "question": "Which roles can specify both skills and mandatory skills for cases and tasks? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Customer service manager (sn_customerservice_manager)",
        "correct": true
      },
      {
        "id": "B",
        "text": "Customer service agent (sn_customerservice_agent)",
        "correct": true
      },
      {
        "id": "C",
        "text": "Customer administrator (sn_customerservice.customer_admin)",
        "correct": false
      },
      {
        "id": "D",
        "text": "Partner (sn_customerservice.partner)",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 28,
    "type": "single",
    "question": "An account is a supported external customer and a contact is a user who is an employee of an account. How many accounts can a contact be associated with?",
    "options": [
      {
        "id": "A",
        "text": "One",
        "correct": true
      },
      {
        "id": "B",
        "text": "Two",
        "correct": false
      },
      {
        "id": "C",
        "text": "Three",
        "correct": false
      },
      {
        "id": "D",
        "text": "Multiple",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 29,
    "type": "multiple",
    "question": "A contact can submit a self-registration request from the customer portal with a registration code. Which of the following roles can approve the request? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Customer service manager (sn_customerservice_manager)",
        "correct": false
      },
      {
        "id": "B",
        "text": "System administrator (admin)",
        "correct": true
      },
      {
        "id": "C",
        "text": "Customer administrator (sn_customerservice.customer_admin)",
        "correct": true
      },
      {
        "id": "D",
        "text": "Partner administrator [sn_customerservice.partner_admon]",
        "correct": true
      },
      {
        "id": "E",
        "text": "Service organization administrator (sn_customerservice.service_organization_admin)",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 30,
    "type": "multiple",
    "question": "What benefits can be gained by integrating CSM with Field Service Management? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Reduces agent workload",
        "correct": false
      },
      {
        "id": "B",
        "text": "Reduces monthly case volume",
        "correct": false
      },
      {
        "id": "C",
        "text": "Work orders can be created from a case",
        "correct": true
      },
      {
        "id": "D",
        "text": "Customer can access work order details and tasks created for their case",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 31,
    "type": "single",
    "question": "Guided decisions is a decision authoring and execution capability that dynamically guides agents to resolve complex cases. Guided decisions consist of decision trees. What is a decision tree?",
    "options": [
      {
        "id": "A",
        "text": "A step-by-step methodology for creating and solving different case types",
        "correct": false
      },
      {
        "id": "B",
        "text": "A detailed check list for customer service teams",
        "correct": false
      },
      {
        "id": "C",
        "text": "A multi-step process consisting of a series of questions answers, and guidance",
        "correct": true
      },
      {
        "id": "D",
        "text": "A set of steps used to define a complex process",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 32,
    "type": "single",
    "question": "In the 'Action Status' column on a case list, what could a blue indicator dot mean?",
    "options": [
      {
        "id": "A",
        "text": "Needs attention",
        "correct": true
      },
      {
        "id": "B",
        "text": "Blocked internally",
        "correct": false
      },
      {
        "id": "C",
        "text": "Blocked externally",
        "correct": false
      },
      {
        "id": "D",
        "text": "Work in progress",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 33,
    "type": "multiple",
    "question": "Customer service personnel who are allocated the customer service agent (sn_customerservice_agent) role are responsible for which of the following tasks? (Choose four.)",
    "options": [
      {
        "id": "A",
        "text": "Assist customers with questions, issues and problems",
        "correct": true
      },
      {
        "id": "B",
        "text": "Create cases",
        "correct": true
      },
      {
        "id": "C",
        "text": "Propose major cases",
        "correct": true
      },
      {
        "id": "D",
        "text": "View, edit, and work on cases",
        "correct": true
      },
      {
        "id": "E",
        "text": "Approve customer contacts",
        "correct": false
      },
      {
        "id": "F",
        "text": "Manage customer entitlements",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 34,
    "type": "single",
    "question": "The ServiceNow add-in for Microsoft Outlook enables you to manage workflows such as creating and updating contacts and cases from within Microsoft Outlook. How could this feature positively affect customer experience?",
    "options": [
      {
        "id": "A",
        "text": "As email is being used fewer agents would be required to create cases so service costs would go down",
        "correct": false
      },
      {
        "id": "B",
        "text": "It is easier to report on data in emails which means managers would be better placed to track performance",
        "correct": false
      },
      {
        "id": "C",
        "text": "It can lead to faster resolution of customer issues and faster response to customer inquiries",
        "correct": true
      },
      {
        "id": "D",
        "text": "It would guarantee less wait time for customers who chose to call the customer service center",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 35,
    "type": "single",
    "question": "In ServiceNow's CSM Application, what is an interaction?",
    "options": [
      {
        "id": "A",
        "text": "Any configuration item that has been made accessible to customers",
        "correct": false
      },
      {
        "id": "B",
        "text": "A record that a Customer Service Agent uses to identify and resolve a question or an issue for an external customer",
        "correct": false
      },
      {
        "id": "C",
        "text": "A binding agreement between two parties",
        "correct": false
      },
      {
        "id": "D",
        "text": "A request for assistance made through a chat, phone call, or walk-up",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 36,
    "type": "multiple",
    "question": "Which services does a Customer (sn_customerservice.customer) have access to? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Can research questions issues, or problems, and create view and edit cases for only their own accounts",
        "correct": true
      },
      {
        "id": "B",
        "text": "Can assign the roles to other contacts in the same account",
        "correct": false
      },
      {
        "id": "C",
        "text": "Can view assets belonging to their account",
        "correct": true
      },
      {
        "id": "D",
        "text": "Can edit information or roles for existing contacts",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 37,
    "type": "multiple",
    "question": "To which recipient types can targeted communications (publications) be sent? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Outsourced Service Providers",
        "correct": false
      },
      {
        "id": "B",
        "text": "Contacts",
        "correct": true
      },
      {
        "id": "C",
        "text": "Internal users",
        "correct": true
      },
      {
        "id": "D",
        "text": "Households",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 38,
    "type": "multiple",
    "question": "What does viewing a customer's install base enable customer service agents to do? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "See the detailed configurations of the products and services deployed for a customer to determine the action needed",
        "correct": true
      },
      {
        "id": "B",
        "text": "Monitor alerts for operational services and configuration items that affect service health",
        "correct": false
      },
      {
        "id": "C",
        "text": "Trace information provided in a case to the right product or service to which it relates",
        "correct": true
      },
      {
        "id": "D",
        "text": "Close an upsell of related products and services not yet purchased by a customer",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 39,
    "type": "single",
    "question": "Which step in Advanced Work Assignment (AWA) would ensure the work was allocated to the appropriate agent?",
    "options": [
      {
        "id": "A",
        "text": "Set the Agent Experience",
        "correct": false
      },
      {
        "id": "B",
        "text": "Define Assignment Rules",
        "correct": true
      },
      {
        "id": "C",
        "text": "Define Work Item Queues",
        "correct": false
      },
      {
        "id": "D",
        "text": "Configure Service Channels",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 40,
    "type": "single",
    "question": "When working with case types, what is the lowest level in the case type hierarchy called?",
    "options": [
      {
        "id": "A",
        "text": "Sub-level",
        "correct": false
      },
      {
        "id": "B",
        "text": "Leaf-level",
        "correct": true
      },
      {
        "id": "C",
        "text": "Decision-level",
        "correct": false
      },
      {
        "id": "D",
        "text": "Base-level",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 41,
    "type": "multiple",
    "question": "Which roles are responsible for maintaining account team membership? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Customer Admin [sn_customerservice.customer.admin]",
        "correct": false
      },
      {
        "id": "B",
        "text": "Customer Case Manager [sn_customerservice.customer_case_manager]",
        "correct": false
      },
      {
        "id": "C",
        "text": "System Administrator [admin]",
        "correct": true
      },
      {
        "id": "D",
        "text": "Customer Service Manager [sn_customerservice_manager]",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 42,
    "type": "multiple",
    "question": "What can a person assigned with the customer role access on the customer service portal by default? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Cases",
        "correct": true
      },
      {
        "id": "B",
        "text": "Related parties",
        "correct": false
      },
      {
        "id": "C",
        "text": "Assets",
        "correct": true
      },
      {
        "id": "D",
        "text": "Social profiles",
        "correct": false
      },
      {
        "id": "E",
        "text": "Sold products",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 43,
    "type": "multiple",
    "question": "Which of the following are benefits of customer access management? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "It increases security by automatically granting access to cases based on access to sold product.",
        "correct": true
      },
      {
        "id": "B",
        "text": "It defaults the responsibility for access management to the customer.",
        "correct": false
      },
      {
        "id": "C",
        "text": "It defaults the responsibility for access management to the customer service agent.",
        "correct": false
      },
      {
        "id": "D",
        "text": "It improves the customer experience by enabling related parties to track and collaborate on cases.",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 44,
    "type": "multiple",
    "question": "Which ServiceNow products can be integrated out-of-the-box with CSM? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "ITOM Event Management",
        "correct": true
      },
      {
        "id": "B",
        "text": "Risk Management",
        "correct": false
      },
      {
        "id": "C",
        "text": "Strategic Portfolio Management",
        "correct": true
      },
      {
        "id": "D",
        "text": "DevOps",
        "correct": false
      },
      {
        "id": "E",
        "text": "Financial Management",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 45,
    "type": "single",
    "question": "When activating the Customer Service Management Demo Data plugin, which case type is available besides product case?",
    "options": [
      {
        "id": "A",
        "text": "Order",
        "correct": true
      },
      {
        "id": "B",
        "text": "Offer",
        "correct": false
      },
      {
        "id": "C",
        "text": "Monitoring",
        "correct": false
      },
      {
        "id": "D",
        "text": "FAQ",
        "correct": false
      },
      {
        "id": "E",
        "text": "Request",
        "correct": false
      },
      {
        "id": "F",
        "text": "Contract",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 46,
    "type": "multiple",
    "question": "What are the different resource matching methods on the Matching Rule form? (Choose four.)",
    "options": [
      {
        "id": "A",
        "text": "Simple",
        "correct": true
      },
      {
        "id": "B",
        "text": "Advanced",
        "correct": true
      },
      {
        "id": "C",
        "text": "Selection Criteria",
        "correct": true
      },
      {
        "id": "D",
        "text": "Skill",
        "correct": false
      },
      {
        "id": "E",
        "text": "Affinity",
        "correct": false
      },
      {
        "id": "F",
        "text": "Scripted",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 47,
    "type": "single",
    "question": "What is the purpose of the Guided Decisions capability?",
    "options": [
      {
        "id": "A",
        "text": "Provide agents with an escalation guide",
        "correct": false
      },
      {
        "id": "B",
        "text": "Dynamically assist agents through account management",
        "correct": false
      },
      {
        "id": "C",
        "text": "Dynamically help agents to resolve complex cases",
        "correct": true
      },
      {
        "id": "D",
        "text": "Provide agents with a knowledge guide",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 48,
    "type": "single",
    "question": "Which feature enables employees to request support for themselves and for external customers?",
    "options": [
      {
        "id": "A",
        "text": "Contributor Users",
        "correct": true
      },
      {
        "id": "B",
        "text": "Business Locations",
        "correct": false
      },
      {
        "id": "C",
        "text": "Responsibility Definitions",
        "correct": false
      },
      {
        "id": "D",
        "text": "Account Management",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 49,
    "type": "single",
    "question": "What functionality is required to automatically close resolved cases if customers do not respond within a specified time?",
    "options": [
      {
        "id": "A",
        "text": "Auto Close Resolved Cases Business Rule",
        "correct": false
      },
      {
        "id": "B",
        "text": "Auto Close Resolved Cases Scheduled Job",
        "correct": false
      },
      {
        "id": "C",
        "text": "Auto Close Resolved Cases Flow Designer Flow",
        "correct": true
      },
      {
        "id": "D",
        "text": "Auto Close Resolved Cases Workflow",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 50,
    "type": "multiple",
    "question": "What are the ways the Customer Portal Locale feature can be used? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Restrict access to a customer service portal based on where a user is physically located",
        "correct": false
      },
      {
        "id": "B",
        "text": "Ensure only authenticated users can choose a language/locale on a customer service portal",
        "correct": false
      },
      {
        "id": "C",
        "text": "Allow authenticated and guest users to choose a language/locale on a customer service portal",
        "correct": true
      },
      {
        "id": "D",
        "text": "Forward authenticated and guest users to a translated customer service portal",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 51,
    "type": "multiple",
    "question": "Advanced Work Assignment (AWA) automatically routes and assigns work items to agents based on which of the following rules? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "Experience",
        "correct": false
      },
      {
        "id": "B",
        "text": "Skills",
        "correct": true
      },
      {
        "id": "C",
        "text": "Products",
        "correct": false
      },
      {
        "id": "D",
        "text": "Schedule",
        "correct": true
      },
      {
        "id": "E",
        "text": "Workload",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 52,
    "type": "single",
    "question": "Which feature provides easy-to-configure integrations between the Now Platform and third party Customer Relationship Management (CRM) and Enterprise Resource Planning (ERP) tools or platforms?",
    "options": [
      {
        "id": "A",
        "text": "Import sets",
        "correct": false
      },
      {
        "id": "B",
        "text": "Active Directory",
        "correct": false
      },
      {
        "id": "C",
        "text": "Web Services",
        "correct": false
      },
      {
        "id": "D",
        "text": "Integration Hub",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 53,
    "type": "single",
    "question": "Which table does the Account (customer_account) table extend?",
    "options": [
      {
        "id": "A",
        "text": "Customer (sn_customer_service_customer)",
        "correct": false
      },
      {
        "id": "B",
        "text": "Business Location (sn_csm_business_location)",
        "correct": false
      },
      {
        "id": "C",
        "text": "Company (core_company)",
        "correct": true
      },
      {
        "id": "D",
        "text": "Service Organization (sn_customer_service_organization)",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 54,
    "type": "single",
    "question": "Which combination of roles is restricted for security purposes?",
    "options": [
      {
        "id": "A",
        "text": "snc_internal and sn_customerservice_agent",
        "correct": false
      },
      {
        "id": "B",
        "text": "snc_internal and sn_customerservice.partner_admin",
        "correct": true
      },
      {
        "id": "C",
        "text": "snc_internal and sn_customerservice.consumer_agent",
        "correct": false
      },
      {
        "id": "D",
        "text": "snc_external and sn_customerservice.customer",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 55,
    "type": "single",
    "question": "What must a system administrator configure to define a different approval workflow for an escalation request?",
    "options": [
      {
        "id": "A",
        "text": "Escalation Decision",
        "correct": false
      },
      {
        "id": "B",
        "text": "Escalation Rule",
        "correct": false
      },
      {
        "id": "C",
        "text": "Escalation Template",
        "correct": true
      },
      {
        "id": "D",
        "text": "Escalation Reason",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 56,
    "type": "single",
    "question": "Which entity represents specific versions of products being sold to and supported for customers?",
    "options": [
      {
        "id": "A",
        "text": "Sold Products",
        "correct": false
      },
      {
        "id": "B",
        "text": "Product Categories",
        "correct": false
      },
      {
        "id": "C",
        "text": "Product Models",
        "correct": true
      },
      {
        "id": "D",
        "text": "Portfolio Products",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 57,
    "type": "single",
    "question": "After an assignment group is chosen, which mandatory step in Advanced Work Assignment (AWA) ensures the work is allocated to the appropriate agent?",
    "options": [
      {
        "id": "A",
        "text": "Configure Work Item Queues",
        "correct": false
      },
      {
        "id": "B",
        "text": "Set the Agent Experience",
        "correct": false
      },
      {
        "id": "C",
        "text": "Set up Skills for Agents",
        "correct": false
      },
      {
        "id": "D",
        "text": "Define Assignment Rules",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 58,
    "type": "multiple",
    "question": "Which decisions does Predictive Intelligence support? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Case Escalation",
        "correct": false
      },
      {
        "id": "B",
        "text": "Case Prioritization",
        "correct": true
      },
      {
        "id": "C",
        "text": "Case Categorization",
        "correct": true
      },
      {
        "id": "D",
        "text": "Case Resolution",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 59,
    "type": "single",
    "question": "What is the term for a formal agreement between a service provider and a customer that provides the customer with an expectation of service within a known timescale?",
    "options": [
      {
        "id": "A",
        "text": "Service Level Agreement",
        "correct": true
      },
      {
        "id": "B",
        "text": "Service Entitlement Agreement",
        "correct": false
      },
      {
        "id": "C",
        "text": "Contractual Service Agreement",
        "correct": false
      },
      {
        "id": "D",
        "text": "Operational Service Agreement",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 60,
    "type": "single",
    "question": "Which Service-Aware Install Base entity defines configuration items accessible to customers?",
    "options": [
      {
        "id": "A",
        "text": "Model",
        "correct": false
      },
      {
        "id": "B",
        "text": "Install Base Item",
        "correct": true
      },
      {
        "id": "C",
        "text": "Sold Product",
        "correct": false
      },
      {
        "id": "D",
        "text": "Asset",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 61,
    "type": "single",
    "question": "Installing the Customer Service Management plugin activates:",
    "options": [
      {
        "id": "A",
        "text": "Only one other plugin - Field Service Management Plugin",
        "correct": false
      },
      {
        "id": "B",
        "text": "No other Plugins",
        "correct": false
      },
      {
        "id": "C",
        "text": "Only two other plugins - Portal and Case Management",
        "correct": false
      },
      {
        "id": "D",
        "text": "Many other plugins at the same time",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 62,
    "type": "multiple",
    "question": "What benefits can be gained by integrating CSM with Field Service Management? (Choose two.)",
    "options": [
      {
        "id": "A",
        "text": "Reduces agent workload",
        "correct": false
      },
      {
        "id": "B",
        "text": "Reduces monthly case volume",
        "correct": false
      },
      {
        "id": "C",
        "text": "Work orders can be created from a case",
        "correct": true
      },
      {
        "id": "D",
        "text": "Customer can access work order details and tasks created for their case",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 63,
    "type": "single",
    "question": "What functionality is required to automatically close resolved cases if customers do not respond within a specified time?",
    "options": [
      {
        "id": "A",
        "text": "Auto Close Resolved Cases Business Rule",
        "correct": false
      },
      {
        "id": "B",
        "text": "Auto Close Resolved Cases Scheduled Job",
        "correct": false
      },
      {
        "id": "C",
        "text": "Auto Close Resolved Cases Flow Designer Flow",
        "correct": true
      },
      {
        "id": "D",
        "text": "Auto Close Resolved Cases Workflow",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 64,
    "type": "single",
    "question": "Which feature provides easy-to-configure integrations between the Now Platform and third-party CRM/ERP tools?",
    "options": [
      {
        "id": "A",
        "text": "Import sets",
        "correct": false
      },
      {
        "id": "B",
        "text": "Active Directory",
        "correct": false
      },
      {
        "id": "C",
        "text": "Web Services",
        "correct": false
      },
      {
        "id": "D",
        "text": "Integration Hub",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 65,
    "type": "single",
    "question": "Which combination of roles is restricted for security purposes?",
    "options": [
      {
        "id": "A",
        "text": "snc_internal and sn_customerservice_agent",
        "correct": false
      },
      {
        "id": "B",
        "text": "snc_internal and sn_customerservice.partner_admin",
        "correct": true
      },
      {
        "id": "C",
        "text": "snc_internal and sn_customerservice.consumer_agent",
        "correct": false
      },
      {
        "id": "D",
        "text": "snc_external and sn_customerservice.customer",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 66,
    "type": "single",
    "question": "Which entity represents specific versions of products being sold to and supported for customers?",
    "options": [
      {
        "id": "A",
        "text": "Sold Products",
        "correct": false
      },
      {
        "id": "B",
        "text": "Product Categories",
        "correct": false
      },
      {
        "id": "C",
        "text": "Product Models",
        "correct": true
      },
      {
        "id": "D",
        "text": "Portfolio Products",
        "correct": false
      }
    ],
    "explanation": ""
  },
  {
    "id": 67,
    "type": "multiple",
    "question": "What are three security modules often used by the System Administrator? (Choose three.)",
    "options": [
      {
        "id": "A",
        "text": "System Properties > Security",
        "correct": true
      },
      {
        "id": "B",
        "text": "Utilities > Migrate Security",
        "correct": false
      },
      {
        "id": "C",
        "text": "System Security > Security",
        "correct": false
      },
      {
        "id": "D",
        "text": "Self-Service > My Access",
        "correct": false
      },
      {
        "id": "E",
        "text": "System Security > Access Control (ACL)",
        "correct": true
      },
      {
        "id": "F",
        "text": "Password Management > Security Questions",
        "correct": false
      },
      {
        "id": "G",
        "text": "System Security > High Security Settings",
        "correct": true
      }
    ],
    "explanation": ""
  },
  {
    "id": 68,
    "type": "single",
    "question": "Which table stores consumer addresses?",
    "options": [
      {
        "id": "A",
        "text": "cmn_location",
        "correct": false
      },
      {
        "id": "B",
        "text": "csm_consumer_user",
        "correct": true
      },
      {
        "id": "C",
        "text": "csm_consumer_address",
        "correct": false
      },
      {
        "id": "D",
        "text": "cmn_location_type",
        "correct": false
      }
    ],
    "explanation": ""
  }
];

function normalizeType(t){ return t === 'multiple' ? 'multi' : t; }
const QUESTIONS_BANK = QUESTIONS_BANK_RAW.map(q => ({ ...q, type: normalizeType(q.type) }));

/* ==============================
 * ESTADO / PERSISTÃŠNCIA
 * ============================== */
const QUIZ_SESSION_KEY = 'quizActiveSession_v3';
let quizState = {
  startTime: null,
  endTime: null,
  currentIndex: 0,
  sequence: [],
  answers: {}, // single/multi: { selected:Set }, matching: { pairs:{} }
  locked: {},
  reviewMode: false
};
const appRoot = document.getElementById("appRoot");

/* PersistÃªncia */
function saveSession() {
  if (quizState.endTime) return;
  try {
    const serializable = {
      startTime: quizState.startTime,
      currentIndex: quizState.currentIndex,
      sequence: quizState.sequence,
      answers: Object.fromEntries(
        Object.entries(quizState.answers).map(([qid, val]) => {
          if (val.selected instanceof Set) return [qid, { selected: Array.from(val.selected) }];
          return [qid, { pairs: val.pairs || {} }];
        })
      ),
      locked: quizState.locked
    };
    localStorage.setItem(QUIZ_SESSION_KEY, JSON.stringify(serializable));
  } catch(e){ console.warn("Falha salvar sessÃ£o", e); }
}
function restoreSessionIfAny() {
  try {
    const raw = localStorage.getItem(QUIZ_SESSION_KEY);
    if(!raw) return false;
    const data = JSON.parse(raw);
    if(!Array.isArray(data.sequence)) return false;
    quizState.startTime = data.startTime || Date.now();
    quizState.currentIndex = data.currentIndex || 0;
    quizState.sequence = data.sequence;
    quizState.answers = {};
    if (data.answers) {
      Object.entries(data.answers).forEach(([qid,val])=>{
        if(val.selected) quizState.answers[qid]={selected:new Set(val.selected)};
        else if(val.pairs) quizState.answers[qid]={pairs:{...val.pairs}};
      });
    }
    quizState.locked = data.locked || {};
    return true;
  } catch(e){ console.warn("Falha restaurar sessÃ£o", e); return false; }
}
function clearSession(){ localStorage.removeItem(QUIZ_SESSION_KEY); }

/* Utilidades */
function shuffle(a){ const arr=a.slice(); for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
function formatDuration(ms){ const s=Math.floor(ms/1000); const m=Math.floor(s/60); const r=s%60; return `${m}m ${r.toString().padStart(2,'0')}s`; }
function getCurrentQuestion(){ return quizState.sequence[quizState.currentIndex]; }

function initQuiz(){
  clearSession();
  quizState.startTime = Date.now();
  quizState.endTime = null;
  quizState.currentIndex = 0;
  quizState.answers = {};
  quizState.locked = {};
  quizState.reviewMode = false;
  quizState.sequence = shuffle(QUESTIONS_BANK.map(q=>{
    if(q.type==='matching'){
      return {
        ...q,
        left: shuffle(q.left.map(l=>({...l}))),
        right: shuffle(q.right.map(r=>({...r})))
      };
    }
    return { ...q, options: shuffle(q.options.map(o=>({...o}))) };
  }));
  renderLayout();
  renderQuestion();
  saveSession();
}

function countStats(){
  let correct=0, incorrect=0, skipped=0;
  quizState.sequence.forEach(q=>{
    const ans=quizState.answers[q.id];
    if(!ans || !quizState.locked[q.id]) { skipped++; return; }
    let isCorrect=false;
    if(q.type==='matching'){
      const pairs = ans.pairs || {};
      isCorrect = q.left.every(l=> pairs[l.id] === q.answerMap[l.id]);
    } else {
      const selected=ans.selected;
      const correctSet=new Set(q.options.filter(o=>o.correct).map(o=>o.id));
      isCorrect = selected.size===correctSet.size && Array.from(selected).every(id=>correctSet.has(id));
    }
    if(isCorrect) correct++; else incorrect++;
  });
  return {correct, incorrect, skipped, total:quizState.sequence.length};
}

/* Layout / Timer */
let timerInterval=null;
function renderLayout(){
  appRoot.innerHTML=`
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Servicenow CIS-CSM Exam 4</h5>
      <div>
  <a href="./home.html" class="btn btn-sm btn-outline-primary me-2">Home</a>
  <button class="btn btn-sm btn-outline-danger me-2" onclick="finishQuiz()">Finalizar Teste</button>
        <span class="small text-muted" id="timerSpan">00:00</span>
      </div>
    </div>
    <div class="progress mb-3">
      <div class="progress-bar" id="progressBar" style="width:0%"></div>
    </div>
    <div id="questionContainer"></div>
  `;
  startTimer();
}
function startTimer(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    if(quizState.endTime){ clearInterval(timerInterval); return; }
    const diff=Date.now()-quizState.startTime;
    const s=Math.floor(diff/1000);
    const m=Math.floor(s/60);
    const r=s%60;
    const el=document.getElementById('timerSpan');
    if(el) el.textContent=`${m.toString().padStart(2,'0')}:${r.toString().padStart(2,'0')}`;
  },1000);
}

/* Render questÃ£o */
function renderQuestion(){
  const q=getCurrentQuestion();
  const container=document.getElementById("questionContainer");
  if(!q || !container) return;
  const idx=quizState.currentIndex+1;
  const total=quizState.sequence.length;
  const isLocked=!!quizState.locked[q.id];
  const progressBar=document.getElementById("progressBar");
  if(progressBar) progressBar.style.width = `${((idx-1)/total)*100}%`;

  let answeredSet, pairs;
  if(q.type==='matching'){
    pairs = quizState.answers[q.id]?.pairs || {};
  } else {
    answeredSet = quizState.answers[q.id]?.selected || new Set();
  }

  // status geral
  let statusAlertHTML='';
  if(isLocked){
    let isCorrect=false;
    if(q.type==='matching'){
      isCorrect = q.left.every(l=> (pairs||{})[l.id] === q.answerMap[l.id]);
    } else {
      const correctSet=new Set(q.options.filter(o=>o.correct).map(o=>o.id));
      isCorrect = answeredSet.size===correctSet.size && Array.from(answeredSet).every(id=>correctSet.has(id));
    }
    statusAlertHTML = `
      <div class="mb-3">
        <div class="alert ${isCorrect?'alert-success':'alert-danger'} question-status-alert mb-0 py-2 px-3">
          <strong>${isCorrect?'Correta':'Incorreta'}:</strong>
          ${isCorrect?'VocÃª acertou esta questÃ£o.':'Esta questÃ£o foi respondida incorretamente.'}
        </div>
      </div>
    `;
  }

  let bodyHTML='';
  if(q.type==='matching'){
    bodyHTML = `
      <h6 class="mb-3">${q.question}</h6>
      ${statusAlertHTML}
      ${renderMatchingQuestion(q, pairs, isLocked)}
    `;
  } else {
    const correctNeeded = q.type==='multi' ? q.options.filter(o=>o.correct).length : 1;
    bodyHTML = `
      <h6 class="mb-3">${q.question} ${q.type==='multi'?`<span class="text-muted small">(Escolha ${correctNeeded})</span>`:''}</h6>
      ${statusAlertHTML}
      <div id="optionsWrapper">
        ${q.options.map(opt=>{
          const selected=answeredSet.has(opt.id);
            const classes=["p-3","mb-2","border","rounded","option-card","d-flex","align-items-start"];
            if(selected) classes.push("selected");
            if(isLocked){
              if(selected && opt.correct) classes.push("correct-user");
              else if(!selected && opt.correct) classes.push("correct");
              else if(selected && !opt.correct) classes.push("incorrect-user");
            }
            return `
              <div class="${classes.join(' ')}" onclick="toggleSelect('${q.id}','${opt.id}')">
                <div class="me-3 mt-1">
                  ${q.type==='single'
                    ? `<input type="radio" name="q_${q.id}" ${selected?'checked':''} ${isLocked?'disabled':''}/>`
                    : `<input type="checkbox" ${selected?'checked':''} ${isLocked?'disabled':''}/>`}
                </div>
                <div class="flex-grow-1">
                  <div class="fw-semibold">${HIDE_OPTION_IDS ? opt.text : `${opt.id}. ${opt.text}`}</div>
                  ${isLocked ? renderOptionBadge(q,opt,selected):''}
                </div>
              </div>
            `;
        }).join('')}
      </div>
    `;
  }

  container.innerHTML = `
    <div class="mb-2 question-header-mini">QuestÃ£o ${idx} de ${total}</div>
    ${bodyHTML}
    <div id="feedbackZone"></div>
    <div class="mt-3 d-flex justify-content-end gap-2 flex-wrap">
      ${!isLocked
        ? `${idx>1?'<button class="btn btn-outline-secondary" onclick="goPrev()">Voltar</button>':''}
           <button class="btn btn-success" id="submitBtn" disabled onclick="evaluateCurrent()">Confirmar Resposta</button>`
        : `${idx>1?'<button class="btn btn-outline-secondary" onclick="goPrev()">Voltar</button>':''}
           <button class="btn btn-primary" onclick="goNextAfterLocked()">${idx===total?'Resultados':'PrÃ³xima >'}</button>`
      }
    </div>
  `;

  if(isLocked && q.explanation){
    document.getElementById('feedbackZone').innerHTML = `
      <div class="feedback-area mt-3 small text-muted">
        <strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}
      </div>
    `;
  }

  updateSubmitButtonState();
}

/* Matching render */
function renderMatchingQuestion(q, pairs, isLocked){
  return `
    <div class="mb-2 small text-muted">Associe cada definiÃ§Ã£o ao papel correto.</div>
    <div id="matchingWrapper">
      ${q.left.map(l=>{
        const chosen = pairs[l.id] || '';
        let rowClass='matching-row';
        let badgeHTML='';
        if(isLocked){
          const correctId=q.answerMap[l.id];
          const isCorrect = chosen === correctId;
          rowClass += isCorrect ? ' correct' : ' incorrect';
          badgeHTML = `<span class="badge ${isCorrect?'bg-success-subtle text-success border border-success':'bg-danger-subtle text-danger border border-danger'} matching-badge ms-2">
            ${isCorrect?'Correto':'Incorreto'}${!isCorrect ? ' (Correto: '+ rightTextById(q, correctId) +')':''}
          </span>`;
        }
        return `
          <div class="${rowClass}" data-left="${l.id}">
            <div class="matching-left-text">${l.text}</div>
            <div>
              <select class="form-select form-select-sm" ${isLocked?'disabled':''}
                onchange="setMatchPair('${q.id}','${l.id}', this.value)">
                <option value="">-- Selecione --</option>
                ${q.right.map(r=>{
                  const selected = r.id === chosen ? 'selected':'';
                  let disable = '';
                  if(!isLocked && chosen !== r.id && Object.values(pairs).includes(r.id)) disable='disabled';
                  return `<option value="${r.id}" ${selected} ${disable}>${HIDE_OPTION_IDS ? r.text : (r.id + ' - ' + r.text)}</option>`;
                }).join('')}
              </select>
              ${badgeHTML}
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;
}

/* Badges single/multi */
function renderOptionBadge(q,opt,userSelected){
  if(q.type==='multi'){
    if(userSelected && opt.correct) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Sua seleÃ§Ã£o estÃ¡ correta</span>`;
    if(!userSelected && opt.correct) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">SeleÃ§Ã£o correta</span>`;
    if(userSelected && !opt.correct) return `<span class="badge bg-danger-subtle text-danger border border-danger badge-label mt-1">Sua seleÃ§Ã£o estÃ¡ incorreta</span>`;
    return '';
  } else {
    if(opt.correct && userSelected) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Resposta correta</span>`;
    if(opt.correct && !userSelected) return `<span class="badge bg-success-subtle text-success border border-success badge-label mt-1">Resposta correta</span>`;
    if(userSelected && !opt.correct) return `<span class="badge bg-danger-subtle text-danger border border-danger badge-label mt-1">Incorreta</span>`;
    return '';
  }
}

/* Estado botÃ£o confirmar */
function updateSubmitButtonState(){
  const q=getCurrentQuestion();
  const btn=document.getElementById("submitBtn");
  if(!btn) return;
  if(q.type==='matching'){
    const ans=quizState.answers[q.id];
    const filled = ans && ans.pairs ? Object.values(ans.pairs).filter(v=>v).length : 0;
    btn.disabled = filled !== q.left.length;
  } else {
    const ans=quizState.answers[q.id];
    btn.disabled = !(ans && ans.selected.size>0);
  }
}

/* InteraÃ§Ã£o single/multi */
function toggleSelect(qid, optId){
  const q=quizState.sequence.find(q=>q.id==qid);
  if(!q || q.type==='matching' || quizState.locked[q.id]) return;
  if(!quizState.answers[q.id]) quizState.answers[q.id]={selected:new Set()};
  const sel=quizState.answers[q.id].selected;
  if(q.type==='single'){ sel.clear(); sel.add(optId); }
  else {
    if(sel.has(optId)) sel.delete(optId); else sel.add(optId);
  }
  renderQuestion(); saveSession();
}

/* InteraÃ§Ã£o matching */
function setMatchPair(qid,leftId,rightId){
  const q=quizState.sequence.find(q=>q.id==qid);
  if(!q || q.type!=='matching' || quizState.locked[q.id]) return;
  if(!quizState.answers[q.id]) quizState.answers[q.id]={pairs:{}};
  const pairs=quizState.answers[q.id].pairs;
  if(rightId==='') delete pairs[leftId];
  else {
    Object.entries(pairs).forEach(([l,r])=>{
      if(r===rightId && l!==leftId) delete pairs[l];
    });
    pairs[leftId]=rightId;
  }
  renderQuestion(); saveSession();
}

/* Avaliar */
function evaluateCurrent(){
  const q=getCurrentQuestion();
  if(q.type==='matching'){
    const ans=quizState.answers[q.id];
    if(!ans || Object.keys(ans.pairs).length < q.left.length) return;
    quizState.locked[q.id]=true;
  } else {
    const ans=quizState.answers[q.id];
    if(!ans || ans.selected.size===0) return;
    quizState.locked[q.id]=true;
  }
  if(q.explanation){
    document.getElementById("feedbackZone").innerHTML=`
      <div class="feedback-area mt-3 small text-muted">
        <strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}
      </div>
    `;
  }
  renderQuestion(); saveSession();
}

function goNextAfterLocked(){
  if(quizState.currentIndex === quizState.sequence.length-1) finishQuiz();
  else { quizState.currentIndex++; renderQuestion(); saveSession(); }
}
function goPrev(){
  if(quizState.currentIndex===0) return;
  quizState.currentIndex--; renderQuestion(); saveSession();
}

/* Resultados */
function finishQuiz(){
  quizState.endTime=Date.now();
  const stats=countStats();
  const duration=formatDuration(quizState.endTime-quizState.startTime);
  clearSession();
  const attemptsKey='quizAttempts';
  let attempts=parseInt(localStorage.getItem(attemptsKey)||'0',10);
  attempts++; localStorage.setItem(attemptsKey,attempts);
  const percent = stats.total? Math.round((stats.correct/stats.total)*100) : 0;

  appRoot.innerHTML=`
    <div class="mb-4">
      <h4 class="mb-0">Resultados do Quiz</h4>
      <div class="text-muted small">Tentativa ${attempts} â€¢ ${new Date().toLocaleString('pt-BR')}</div>
    </div>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card h-100">
          <div class="card-body d-flex flex-column justify-content-center">
            <div class="donut-wrapper mb-3">
              <canvas id="resultDonut" width="160" height="160"></canvas>
              <div class="donut-center">${percent}%</div>
            </div>
            <div class="text-center small">
              <span class="me-2"><span class="badge bg-success">&nbsp;</span> Corretas: ${stats.correct}</span>
              <span class="me-2"><span class="badge bg-danger">&nbsp;</span> Incorretas: ${stats.incorrect}</span>
              <span><span class="badge bg-secondary">&nbsp;</span> Puladas: ${stats.skipped}</span>
            </div>
          </div>
          <div class="card-footer text-center">
            <strong>${stats.correct}/${stats.total}</strong> corretas<br/>Tempo: ${duration}
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card h-100">
          <div class="card-body">
            <p class="mb-3">VocÃª concluiu o quiz. Revise ou refaÃ§a para praticar novamente.</p>
            <ul class="list-group mb-3 small">
              <li class="list-group-item d-flex justify-content-between"><span>Total de questÃµes</span><strong>${stats.total}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Corretas</span><strong class="text-success">${stats.correct}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Incorretas</span><strong class="text-danger">${stats.incorrect}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Puladas</span><strong class="text-secondary">${stats.skipped}</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>Percentual</span><strong>${percent}%</strong></li>
              <li class="list-group-item d-flex justify-content-between"><span>DuraÃ§Ã£o</span><strong>${duration}</strong></li>
            </ul>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-primary" onclick="reviewQuestions()">Rever QuestÃµes</button>
              <button class="btn btn-success" onclick="initQuiz()">Refazer (Randomizar)</button>
              <button class="btn btn-outline-secondary" onclick="toggleTheme()">Alternar Tema</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
  drawDonut(stats.correct, stats.incorrect, stats.skipped);
}

/* Donut */
function drawDonut(correct, incorrect, skipped){
  const canvas=document.getElementById("resultDonut");
  if(!canvas) return;
  const ctx=canvas.getContext('2d');
  const total=correct+incorrect+skipped||1;
  const data=[
    {value:correct,color:'#198754'},
    {value:incorrect,color:'#dc3545'},
    {value:skipped,color:'#6c757d'}
  ].filter(d=>d.value>0);
  let start=-Math.PI/2;
  data.forEach(d=>{
    const slice=(d.value/total)*Math.PI*2;
    ctx.beginPath();
    ctx.moveTo(80,80);
    ctx.arc(80,80,80,start,start+slice);
    ctx.closePath();
    ctx.fillStyle=d.color;
    ctx.fill();
    start+=slice;
  });
  ctx.globalCompositeOperation='destination-out';
  ctx.beginPath(); ctx.arc(80,80,48,0,Math.PI*2); ctx.fill();
  ctx.globalCompositeOperation='source-over';
}

/* RevisÃ£o */
function reviewQuestions(){
  const stats=countStats();
  const blocks=quizState.sequence.map((q,i)=>{
    const ans=quizState.answers[q.id];
    let userCorrect=false;

    if(q.type==='matching'){
      const pairs = ans ? ans.pairs || {} : {};
      userCorrect = ans && q.left.every(l=> pairs[l.id] === q.answerMap[l.id]);
      return `
        <div class="card mb-3">
          <div class="card-header d-flex justify-content-between">
            <span><strong>QuestÃ£o ${i+1}:</strong> (Matching)</span>
            <span class="badge ${userCorrect?'bg-success':'bg-danger'}">${userCorrect?'Correta':'Incorreta'}</span>
          </div>
          <div class="card-body">
            <p class="mb-3">${q.question}</p>
            ${q.left.map(l=>{
              const chosen = (ans && ans.pairs)? ans.pairs[l.id] : '';
              const correctId = q.answerMap[l.id];
              const isRowCorrect = chosen === correctId;
              return `
                <div class="matching-row ${isRowCorrect?'correct':'incorrect'}">
                  <div class="matching-left-text">${l.text}</div>
                  <div class="small">
                    <div><strong>Selecionado:</strong> ${chosen ? rightTextById(q, chosen) : '(vazio)'}</div>
                    <div><strong>Correto:</strong> ${rightTextById(q, correctId)}</div>
                  </div>
                </div>
              `;
            }).join('')}
            ${q.explanation?`<div class="small text-muted"><strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}</div>`:''}
          </div>
        </div>
      `;
    } else {
      const selected=ans ? ans.selected : new Set();
      const correctSet=new Set(q.options.filter(o=>o.correct).map(o=>o.id));
      userCorrect = ans && selected.size===correctSet.size && Array.from(selected).every(id=>correctSet.has(id));
      return `
        <div class="card mb-3">
          <div class="card-header d-flex justify-content-between">
            <span><strong>QuestÃ£o ${i+1}:</strong> ${q.type==='multi'?'(Multi)':'(Ãšnica)'}</span>
            <span class="badge ${userCorrect?'bg-success':'bg-danger'}">${userCorrect?'Correta':'Incorreta'}</span>
          </div>
          <div class="card-body">
            <p class="mb-3">${q.question}</p>
            ${q.options.map(o=>{
              let classes="p-2 px-3 mb-2 border rounded small";
              let badge='';
              const userSel=selected.has(o.id);
              if(o.correct && userSel){ classes+=" border-success bg-success-subtle"; badge='<span class="badge bg-success-subtle text-success border border-success badge-label">Sua seleÃ§Ã£o correta</span>'; }
              else if(o.correct && !userSel){ classes+=" border-success bg-success-subtle"; badge='<span class="badge bg-success-subtle text-success border border-success badge-label">Resposta correta</span>'; }
              else if(!o.correct && userSel){ classes+=" border-danger bg-danger-subtle"; badge='<span class="badge bg-danger-subtle text-danger border border-danger badge-label">Selecionada (Incorreta)</span>'; }
              else { classes+=" border-light"; }
              return `<div class="${classes}">${HIDE_OPTION_IDS?o.text:`<strong>${o.id}.</strong> ${o.text}`}<br/>${badge}</div>`;
            }).join('')}
            ${q.explanation?`<div class="small text-muted"><strong>ExplicaÃ§Ã£o:</strong> ${q.explanation}</div>`:''}
          </div>
        </div>
      `;
    }
  }).join('');

  appRoot.innerHTML=`
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="mb-0">RevisÃ£o das QuestÃµes</h4>
      <div class="d-flex gap-2">
        <button class="btn btn-success btn-sm" onclick="initQuiz()">Refazer</button>
        <button class="btn btn-outline-secondary btn-sm" onclick="finishQuiz()">Voltar aos Resultados</button>
      </div>
    </div>
    <div class="mb-3 small">
      <span class="me-3"><span class="badge bg-success">&nbsp;</span> Corretas: ${stats.correct}</span>
      <span class="me-3"><span class="badge bg-danger">&nbsp;</span> Incorretas: ${stats.incorrect}</span>
      <span><span class="badge bg-secondary">&nbsp;</span> Puladas: ${stats.skipped}</span>
    </div>
    ${blocks}
  `;
}

/* Helpers right text */
function rightTextById(q, id){ const it=(q.right||[]).find(r=>r.id===id); return it?it.text:''; }

/* Tema */
const themeBtn=document.getElementById("themeBtn");
function toggleTheme(){
  const html=document.documentElement;
  const cur=html.getAttribute('data-bs-theme')||'light';
  const next=cur==='light'?'dark':'light';
  html.setAttribute('data-bs-theme',next);
  localStorage.setItem('quizTheme',next);
}
themeBtn.addEventListener('click',toggleTheme);
(function(){ const saved=localStorage.getItem('quizTheme'); if(saved) document.documentElement.setAttribute('data-bs-theme',saved); })();

/* NavegaÃ§Ã£o & exposiÃ§Ã£o */
function goNextAfterLocked(){ if(quizState.currentIndex===quizState.sequence.length-1) finishQuiz(); else {quizState.currentIndex++; renderQuestion(); saveSession();} }
function goPrev(){ if(quizState.currentIndex===0) return; quizState.currentIndex--; renderQuestion(); saveSession(); }

window.toggleSelect=toggleSelect;
window.evaluateCurrent=evaluateCurrent;
window.finishQuiz=finishQuiz;
window.reviewQuestions=reviewQuestions;
window.goNextAfterLocked=goNextAfterLocked;
window.goPrev=goPrev;
window.toggleTheme=toggleTheme;
window.initQuiz=initQuiz;
window.setMatchPair=setMatchPair;

/* Start */
(function start(){
  if(restoreSessionIfAny()){ renderLayout(); renderQuestion(); startTimer(); }
  else initQuiz();
})();
</script>
</body>
</html>